<!DOCTYPE HTML>
<html lang="en" class="ayu sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Fadhil Journal &amp; Notes</title>
        <meta name="robots" content="noindex">


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="highlight-css" href="highlight.css">
        <link rel="stylesheet" id="tomorrow-night-css" href="tomorrow-night.css">
        <link rel="stylesheet" id="ayu-highlight-css" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->

        <!-- MathJax -->
        <script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "";
            const default_light_theme = "ayu";
            const default_dark_theme = "ayu";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="toc.js"></script>
    </head>
    <body>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('ayu')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Fadhil Journal &amp; Notes</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/fadhil-riyanto" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="introduction"><a class="header" href="#introduction">Introduction</a></h1>
<p>Let me introduce my self, Who is Fadhil? Fadhil Riyanto (real-name), is a self-taught system programmer (also backend programmer) which live in Indonesian, This is some short &amp; dirty tutorial about computer science and litte about math.</p>
<p>mirrors: <a href="https://blog.fadhils.eu.org">blog.fadhils.eu.org</a></p>
<h1 id="contributing"><a class="header" href="#contributing">Contributing</a></h1>
<p>Found a mistake? You can freely DM me on <a href="https://t.me/fadhil_riyanto">telegram</a> or just email me on</p>
<ul>
<li><a href="mailto:me@fadev.org">me@fadev.org</a> (primary, fast respond)</li>
<li><a href="mailto:fadhilriyanto@duck.com">fadhilriyanto@duck.com</a> (gmail mirror)</li>
<li><a href="mailto:fadhil.riyanto@gnuweeb.org">fadhil.riyanto@gnuweeb.org</a> (alternative-1)</li>
<li><a href="mailto:xor@3xploit.dev">xor@3xploit.dev</a> (alternative-2)</li>
</ul>
<h1 id="other-intresting-site"><a class="header" href="#other-intresting-site">other intresting site</a></h1>
<ul>
<li><a href="https://x86.fadev.org/">x86_64 Instruction Set Reference</a></li>
<li><a href="https://libs.fadev.org/">some nice book collection (WIP)</a></li>
<li><a href="https://libs.fadev.org/">git.fadev.org (WIP)</a></li>
</ul>
<h1 id="language"><a class="header" href="#language">Language</a></h1>
<p>Because I'm indonesian, some part of this website may written in indonesian. But I will try to translating it into english language.</p>
<div class="warning">
<p>Note</p>
<p>[EN] If you found a mistake, let me know. BIG thanks!  <br>
[ID] Jika kamu menemukan sesuatu yang sepertinya itu salah, bisa langsung kasih kabar ke saya. Terimakasih.</p>
</div><div style="break-before: page; page-break-before: always;"></div><h1 id="todo"><a class="header" href="#todo">todo</a></h1>
<ul>
<li>MAKE: <code>./server/php-fpm-config.md</code> book</li>
<li>COMPLETION: <code>./database/postgresql_system_table</code></li>
<li>COMPLETION: <code>./database/postgresql_functions</code></li>
<li>MAKE: <code>./crypto/ca-certificates</code></li>
<li>MAKE: "freeRADIUS deploy"</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="system-programming"><a class="header" href="#system-programming">System programming</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="how-data-movement-changes-a-destination-register"><a class="header" href="#how-data-movement-changes-a-destination-register">How data movement changes a destination register</a></h1>
<p>This snippets is from "Computer Systems A Programmer’s Perspective, by Randal E. Bryant and David R. O’Hallaron"</p>
<p>As described, there are two different conventions regarding whether and how data movement instruc-
tions modify the upper bytes of a destination register. This distinction is illustrated by the following
code sequence:</p>
<pre><code class="language-txt">1 movabsq $0x0011223344556677, %rax %rax = 0011223344556677
2 movb $-1, %al %rax = 00112233445566FF
3 movw $-1, %ax %rax = 001122334455FFFF
4 movl $-1, %eax %rax = 00000000FFFFFFFF
5 movq $-1, %rax %rax = FFFFFFFFFFFFFFFF
</code></pre>
<p>In the following discussion, we use hexadecimal notation. In the example, the instruction on line 1
initializes register %rax to the pattern 0011223344556677. The remaining instructions have immediate
value −1 as their source values. Recall that the hexadecimal representation of −1 is of the form FF. . .F,
where the number of F’s is twice the number of bytes in the representation. The movb instruction (line 2)
therefore sets the low-order byte of %rax to FF, while the movw instruction (line 3) sets the low-order
2 bytes to FFFF, with the remaining bytes unchanged. The movl instruction (line 4) sets the low-order
4 bytes to FFFFFFFF, but it also sets the high-order 4 bytes to 00000000. Finally, the movq instruction
(line 5) sets the complete register to FFFFFFFFFFFFFFFF.</p>
<p>some useful links</p>
<ul>
<li><a href="https://stackoverflow.com/questions/52434073/whats-the-difference-between-the-x86-64-att-instructions-movq-and-movabsq">https://stackoverflow.com/questions/52434073/whats-the-difference-between-the-x86-64-att-instructions-movq-and-movabsq</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="general-embedded-asm-linked-in-c"><a class="header" href="#general-embedded-asm-linked-in-c">General embedded ASM linked in C</a></h1>
<p>this is program is succesfully compiled with <code>as</code>, but failed to run due to SIGSEGV.</p>
<p>this is will fail</p>
<pre><code class="language-asm">.data
val:
    .byte 0xF6
    .byte 0xF6
    .byte 0xF6
    .byte 0xF6
    

.globl do_asm

do_asm:
    # movl 0x12345678, %eax
    # movl 0xAABBCCDD, %edx 

    # # move edx 8 bit high into al (eax)
    # movb %dh, %al

    
    movq $9, %rax
    ret

</code></pre>
<p>this is will compile</p>
<pre><code class="language-asm">.data
val:
    .byte 0xF6
    .byte 0xF6
    .byte 0xF6
    .byte 0xF6
    

.globl do_asm

.text
do_asm:
    # movl 0x12345678, %eax
    # movl 0xAABBCCDD, %edx 

    # # move edx 8 bit high into al (eax)
    # movb %dh, %al

    
    movq $9, %rax
    ret

</code></pre>
<p>the difference only in <code>.text</code> section</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="move-sign--zero-extends-a-single-byte"><a class="header" href="#move-sign--zero-extends-a-single-byte">Move sign &amp; zero-extends a single byte</a></h1>
<p>Disini saya akan membahas apa itu instruksi MOVSBL dan MOVZBL. pertama tama silahkan baca dulu disini</p>
<ul>
<li><a href="https://stackoverflow.com/questions/7861095/what-does-movsbl-instruction-do">https://stackoverflow.com/questions/7861095/what-does-movsbl-instruction-do</a></li>
</ul>
<pre><code class="language-txt">MOVSBL and MOVZBL
* MOVSBL sign-extends a single byte, and copies it into a
  double-word destination
* MOVZBL expands a single byte to 32 bits with 24 leading
  zeros, and copies it into a double-word destination
</code></pre>
<p>pertama tama, lihat kode asm ini.</p>
<pre><code class="language-asm">
.section .data
val:
    .byte 0xF6
    .byte 0xF6
    .byte 0xF6
    .byte 0xF6
    

.globl do_asm

.text
do_asm:
    movl $0x12345678, %eax
    movl $0xAABBCCDD, %edx 

    # move edx 8 bit high into al (eax)
    movb %dh, %al

    # reset
    movl $0x12345678, %eax
    movl $0xAABBCCDD, %edx 

    MOVSBL %dh, %eax

    # reset
    movl $0x12345678, %eax
    movl $0xAABBCCDD, %edx 

    MOVZBL %dh, %eax

    
    movq $9, %rax
    ret

</code></pre>
<p>dan ini hasilnya, movb biasa (tanpa hapus bagian atas data, bagian atas tetep utuh)
<img src="sysprog//assets/movsbl-1.png" alt="gambar" /></p>
<p>ini hasil signed bagian atas
<img src="sysprog//assets/movsbl-2.png" alt="gambar" /></p>
<p>ini hasil ketika bagian atas kita zerokan
<img src="sysprog//assets/movzbl-3.png" alt="gambar" /></p>
<p>catatan
<code>movb %dh, %al</code> memindahkan rdx bagian high ke rax bagian bawah.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="movabsq"><a class="header" href="#movabsq">movabsq</a></h1>
<p>simplenya, ini kepanjangan dari move absolute quad word (64 bit)
contoh kecil</p>
<p><img src="sysprog//assets/eb8833cdb401abff39e22474d9ff5b2eb3f2540eba9687d889d6f9a4e435b8fabe993f5b8213122bd7fd7dac70efd0f5c9f62c1d9cb8f3995c340d26.png" alt="image" /></p>
<p>itu contoh initial moveabsq int 64 bit, lalu</p>
<p><img src="sysprog//assets/ee8e49f3fcdca5ab81c260f0de3a64d672c609ab252dcab094e5840a7d7bfefcaf2a8be83085daf33dbb8e45fb4626e2a25f0ddfa68a9fecc12ef848.png" alt="image" />
contoh move 1 bytes</p>
<p><img src="sysprog//assets/d05c2e568339a6f4c057091bb8578450d38dd00b154b141d530e2c0694852fb3c07829028af8ee233f33996ebfcc2ea29ca7a11d3b0eabe9c1ca8880.png" alt="image" />
move 16 bit, 2 bytes word</p>
<p><img src="sysprog//assets/6c223330945fca3f1f45e07fa66de88bbd9281187602069790b89fe9e7be6f94f1d2545734445512951ae4a3e674e498163b742ddc877572e7b21741.png" alt="image" />
move 32 bit, 4 bytes, tapi disini keformat sebagai int32 wkwk</p>
<p><img src="sysprog//assets/7dfc4195b63c65217c9b7e4162ee957287f352e5cc2070e73bc081e9b453aa2ee24cea30fe9af644e15f49a3c17eaaa2382a5daf28d98528e508c3f2.png" alt="image" />
full 64 bit move</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="x86_64-register-fiks-technical-grade"><a class="header" href="#x86_64-register-fiks-technical-grade">x86_64 register (fiks technical grade)</a></h1>
<p><img src="sysprog//assets/calling_convention_page-0001.jpg" alt="gambar" /></p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="analisis-kenapa-pakai-movabsq-daripada-movq"><a class="header" href="#analisis-kenapa-pakai-movabsq-daripada-movq">analisis kenapa pakai movabsq, daripada movq</a></h1>
<p>movq hanya bisa accept integer</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="analisis-patch-movq-pakai-0xffffffff"><a class="header" href="#analisis-patch-movq-pakai-0xffffffff">analisis patch movq pakai 0xffffffff</a></h1>
<p>ada asm</p>
<p><img src="sysprog//assets/396baa16bda2bcebbef7d1403edf680c8f5c58d1e5d13e396d9187a7e106a69d95b21a892095d794cf8d80e03fba5ee8faa3d61e3eab21d78d2fb9b1.png" alt="image" /></p>
<p>kita akan memaksa dari 0x7fffffff menjadi 0xffffffff untuk membuktikan bahwa harusnya movq error, dan digantikan oleh movabsq</p>
<p>initial dulu
<img src="sysprog//assets/46453cea0bda238960726005cf23bc143f51ffe55f0b632fec36ca3b4846d7dee3ad43e7ab4841b29e64d1a9344ee30bbb3ea46e8812f2b3f9f64a24.png" alt="image" /></p>
<p>lalu, next replace address 0x555555555119 dengan</p>
<pre><code class="language-txt">set {unsigned char[8]}0x555555555119 = {0x48, 0xc7, 0xc0, 0xff, 0xff, 0xff, 0xff, 0x90}
</code></pre>
<p>confirmed berubah jadi 0xffffffff disini
<img src="sysprog//assets/183193f1ed20460acef3b46f25d34f4362c97d685aa27c440ecf464d0036cddab2a92fad306c6018a9911aa10b27b1ab130a443ca9c0edcbe6f61a68.png" alt="image" /></p>
<p>saatnya kita lanjutkan, apakah error
<img src="sysprog//assets/c160ad95471ba78693869c17396b2ce78d2dd142abfb1232dfd08532438a3823f5746823e3061b802421b731067d432ee3dc7df6dd1980159bfd4d10.png" alt="image" /></p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="ext4-unknown-ro-compact-features"><a class="header" href="#ext4-unknown-ro-compact-features">ext4 unknown RO compact features</a></h1>
<p>this error come from linux kernel</p>
<pre><code class="language-c">	/* Check that feature set is OK for a read-write mount */
	if (ext4_has_unknown_ext4_ro_compat_features(sb)) {
		ext4_msg(sb, KERN_ERR, "couldn't mount RDWR because of "
			 "unsupported optional features (%x)",
			 (le32_to_cpu(EXT4_SB(sb)-&gt;s_es-&gt;s_feature_ro_compat) &amp;
				~EXT4_FEATURE_RO_COMPAT_SUPP));
		return 0;
	}
</code></pre>
<p>which EXT4_FEATURE_RO_COMPAT_SUPP</p>
<pre><code class="language-c">#define EXT4_FEATURE_RO_COMPAT_SUPP	(EXT4_FEATURE_RO_COMPAT_SPARSE_SUPER| \
					 EXT4_FEATURE_RO_COMPAT_LARGE_FILE| \
					 EXT4_FEATURE_RO_COMPAT_GDT_CSUM| \
					 EXT4_FEATURE_RO_COMPAT_DIR_NLINK | \
					 EXT4_FEATURE_RO_COMPAT_EXTRA_ISIZE | \
					 EXT4_FEATURE_RO_COMPAT_BTREE_DIR |\
					 EXT4_FEATURE_RO_COMPAT_HUGE_FILE |\
					 EXT4_FEATURE_RO_COMPAT_BIGALLOC |\
					 EXT4_FEATURE_RO_COMPAT_METADATA_CSUM|\
					 EXT4_FEATURE_RO_COMPAT_QUOTA |\
					 EXT4_FEATURE_RO_COMPAT_PROJECT |\
					 EXT4_FEATURE_RO_COMPAT_VERITY |\
					 EXT4_FEATURE_RO_COMPAT_ORPHAN_PRESENT)
</code></pre>
<pre><code class="language-c">#define EXT4_FEATURE_RO_COMPAT_GDT_CSUM		0x0010
</code></pre>
<p><a href="https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/tree/fs/ext4/ext4.h#n2188">https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/tree/fs/ext4/ext4.h#n2188</a></p>
<p><a href="https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/tree/fs/ext4/ext4.h#n2024">https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/tree/fs/ext4/ext4.h#n2024</a></p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="qemu-custom-cpio-hda"><a class="header" href="#qemu-custom-cpio-hda">qemu custom cpio HDA</a></h1>
<p>skrip init custom linux</p>
<pre><code class="language-sh">qemu-system-x86_64 \-kernel ./vmlinux \
                                                 -nographic \
                                                 --append "console=tty0 console=ttyS0 panic=1 root=/dev/sda rootfstype=ext2" \
                                                 -hda root.img \
                                                 -m 1024 \
                                                 -vga none \
                                                 -display none \
                                                 -serial mon:stdio \
                                                 -no-reboot \
                                                 -initrd vfs/root.cpio.gz
</code></pre>
<p>generate cpio</p>
<pre><code class="language-sh">find . | cpio -o -H newc | gzip &gt; root.cpio.gz
``</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="step-tcp"><a class="header" href="#step-tcp">step TCP</a></h1>
<p>TCP steps</p>
<ul>
<li>isi dulu sockaddr_storage, isi pakai inet_pton(); .so_family = AF_INET; sin_port = htons(port)</li>
<li>syscall socket(AF_INET, SOCK_STREAM, 0);</li>
<li>setsocksopt(fd, SO_REUSEADDR = 1)</li>
<li>bind(fd, ss_addr (cast dulu ke sockaddr_in), len nya)</li>
<li>listen()</li>
</ul>
<p>penjelasan ttg kenapa pakai sockaddr_storage dipakai
https://stackoverflow.com/questions/19528820/difference-between-sockaddr-and-sockaddr-storage</p>
<p>kenapa harus setsocksopt SO_REUSEADDR? karna jika tidak, TCP Masuk ke timewait state.</p>
<p>sekiranya itu aja sih step TCP ini. untuk UDP pakai aja dgram.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="gdb-attach"><a class="header" href="#gdb-attach">GDB attach</a></h1>
<p>jadi ceritanya, ada bug yg kala di run di terminal, ia buggy, pas di run di gdb, dia gak error sama sekali</p>
<p>gw bingung dah, nah disini. ternyata ada trick nya</p>
<ul>
<li>
<p>jalanin dulu programnya kek biasa di terminal, dah running kan</p>
</li>
<li>
<p>ambil pid nya pakai ps aux | grep xyz</p>
</li>
<li>
<p>setelah dapet pid nya, jalankan gdb dengan mode attach pid</p>
</li>
</ul>
<p>pakai <code>sudo gdb -p 12345</code></p>
<ul>
<li>program akan freeze sejenak, pencet <code>c</code>, <code>enter</code></li>
</ul>
<p>nah, lakukan cara yg dipake buat reproduce bug nya, misal pakai nc buat nyepam tcp ke program. ok dapet bug nya</p>
<p>ni kalau kata orang internet, beberapa bug kek app multi thread agak susah di caught. pakai valgrind pun perlu flags2 khusus buat inspect sampai thread nya</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="hasil-oprek-socket-programming-case-socks5-server"><a class="header" href="#hasil-oprek-socket-programming-case-socks5-server">hasil oprek socket programming, case socks5 server</a></h1>
<p>bagian IETF SOCKS5 section 6</p>
<p><a href="https://datatracker.ietf.org/doc/html/rfc1928#section-6">https://datatracker.ietf.org/doc/html/rfc1928#section-6</a></p>
<p>BND.ADDR haruslah berupa IPV4/IPV6 address, bukan domain :)</p>
<p>secara general, bentuk packet yg akan dikirim untuk versi IPV4 seperti ini</p>
<pre><code class="language-txt">[0] [VER] =&gt; 0x5
[1] [REP] =&gt; 0x0
[2] [RSV] =&gt; 0x0
[3] [ATYP] =&gt; 0x1 atau 0x4
[4] [BND.ADDR] 0xac
[5] [BND.ADDR] 0x43
[6] [BND.ADDR] 0x93
[7] [BND.ADDR] 0x39
[8] [BND.PORT] 0x50 
[9] [BND.PORT] 0x50
</code></pre>
<p>maka perhitungannya memory awal + 4 (karna 4 field dah dipakai), start dari sini, insert 4 oktet lagi ipv4 address, lalu insert 2 oktet uint8 sebagai port.</p>
<p>bagian BND.PORT itu unsigned int 16 bit. jadi harus digabung bitnya + diubah dari network order ke host order</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="fix-ncurses-kernel-build"><a class="header" href="#fix-ncurses-kernel-build">fix ncurses kernel build</a></h1>
<p>suppose</p>
<pre><code class="language-txt">*** Unable to find the ncurses libraries or the
 *** required header files.
 *** 'make menuconfig' requires the ncurses libraries.
 *** 
 *** Install ncurses (ncurses-devel) and try again.
 *** 
make[2]: *** [/home/fadhil_riyanto/linux-kernel/busybox-1.37.0/scripts/kconfig/lxdialog/Makefile:15: scripts/kconfig/lxdialog/dochecklxdialog] Error 1
make[1]: *** [/home/fadhil_riyanto/linux-kernel/busybox-1.37.0/scripts/kconfig/Makefile:14: menuconfig] Error 2
make: *** [Makefile:444: menuconfig] Error 2
</code></pre>
<p>maka solusi
<code>nano scripts/kconfig/lxdialog/Makefile</code></p>
<p>ubah</p>
<pre><code class="language-txt">always         := $(hostprogs-y) dochecklxdialog
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="php-src-variadic-params"><a class="header" href="#php-src-variadic-params">PHP-SRC variadic params</a></h1>
<p>the source code: <a href="https://github.com/php/php-src/blob/ba6c00505d4218ff9fe4feb060f636524acfb125/ext/standard/array.c#L1204">https://github.com/php/php-src/blob/ba6c00505d4218ff9fe4feb060f636524acfb125/ext/standard/array.c#L1204</a></p>
<p>mayan ngebantu jg gw ngepahami variadic params di php.
ref: <a href="https://www.zend.com/resources/php-extensions/basic-php-structures">https://www.zend.com/resources/php-extensions/basic-php-structures</a></p>
<p>selfnote :</p>
<p>ZEND_PARSE_PARAMETERS_START(num_required_args, num_max_args)
Z_PARAM_VARIADIC('*' or '+', destptr, argc);</p>
<p>catatan:</p>
<ul>
<li>* nol atau lebih parameter</li>
<li>+ satu atau lebih parameter</li>
</ul>
<p>nb: akan diupdate berkala</p>
<p>ref: https://wiki.php.net/rfc/fast_zpp</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="php-src-minit"><a class="header" href="#php-src-minit">PHP-SRC minit()</a></h1>
<p><a href="https://github.com/php/php-src/blob/3704947696fe0ee93e025fa85621d297ac7a1e4d/main/main.c#L2009">https://github.com/php/php-src/blob/3704947696fe0ee93e025fa85621d297ac7a1e4d/main/main.c#L2009</a></p>
<p>Ketika module PHP diload ke zend engine, yang dipanggil adalah MINIT(), di step ini yg terjadi cuman memory alokasi di ZendMM, dan disini engga ada process atau thread yg dijalan, pure cuman initialisasi data</p>
<p>nah, yang mentrigger MINIT() adalah zend_startup_modules(), trus secara beurutan, ia jg manggil RINIT() via PHP_RINIT_FUNCTION()</p>
<p>struct nya
<img src="sysprog//assets/71ee438d7728f41eb71942cc4e8b9693efcc03aa4ffd227e6c035b6aa383863ef79c48eb122af41f7ef3ec4eb4623a48560272461dc5ba20f83fd296.png" alt="image" /> zend_result (*request_startup_func)(INIT_FUNC_ARGS);</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="gcc-compiler-visibility"><a class="header" href="#gcc-compiler-visibility">gcc compiler visibility</a></h1>
<p>intresting buat diulik</p>
<pre><code class="language-cc">class rectangle {
        int width, height;

        public:
                void set_value(int, int);
                int area();
};

void rectangle::set_value(int x, int y) 
{
        width = x;
        height = y;
}


int rectangle::area()
{
        return width * height;
}

</code></pre>
<p>compile pakai</p>
<ul>
<li><code>g++ -Wall -c -fPIC abc.cc</code></li>
<li><code>g++ -o librec.so --shared abc.o</code></li>
<li><code>nm -C librec.so</code></li>
</ul>
<p>akan ada</p>
<pre><code class="language-txt">000000000000110e T rectangle::area()
00000000000010ea T rectangle::set_value(int, int)
</code></pre>
<p>nah, disitu kalau di compile pakai <code>-fvisibility=hidden</code>
ntar pas di cek pakai
<code>nm -CD librec.so </code></p>
<p>bakalan gak ada. nah ini ada kaitannya sama
<code>__attribute__ ((visibility ("hidden")))</code></p>
<p>tambahan: <a href="https://groups.google.com/g/ode-users/c/T3qiy-4dviQ">https://groups.google.com/g/ode-users/c/T3qiy-4dviQ</a></p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="load-effective-address"><a class="header" href="#load-effective-address">load effective address</a></h1>
<p>computes a memory address using the same arithmetic that a MOV instruction uses. But unlike the MOV instruction, the LEA instruction just stores the computed address in its target register, instead of loading the contents of that address and storing it.</p>
<p>Consider your first LEA instruction:</p>
<p>tldr nya: mov bisa mengkalkulasi operasi aritmetika dari alamat memori, trus ngambil isinya
kalau lea, ia cuman mengkalkulasi alamatnya, hasil itung2an nya disimpan ke operand2</p>
<pre><code class="language-asm">lea -0x18(%ebp), %ebx
</code></pre>
<p>tambahan catatan</p>
<p>mov (op1, op2, op3), dest</p>
<p>equal (pseudo):
mov op1 + op2 * op3, dest</p>
<p>and
lea op1(op2), dest</p>
<p>equal
lea op2 + op1, dest (address of op2 + op1, store result into dest)</p>
<p>bahasan tentang rip
<a href="https://stackoverflow.com/questions/54745872/how-do-rip-relative-variable-references-like-rip-a-in-x86-64-gas-intel-sy">https://stackoverflow.com/questions/54745872/how-do-rip-relative-variable-references-like-rip-a-in-x86-64-gas-intel-sy</a></p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="att-asm-prelude"><a class="header" href="#att-asm-prelude">AT&amp;T asm prelude</a></h1>
<p>push eax
equal with:
mov [esp], eax
sub esp, 4</p>
<p>pop eax
get values out of stack
equal with</p>
<p>add rsp, 4
mov eax, [esp]</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="printf-format-specifier"><a class="header" href="#printf-format-specifier">printf format specifier</a></h1>
<p>general</p>
<pre><code class="language-txt">%[flags][width][.precision][length]specifier
</code></pre>
<h2 id="flag"><a class="header" href="#flag">flag</a></h2>
<div class="table-wrapper"><table><thead><tr><th style="text-align: left">Flag</th><th style="text-align: left">Description</th></tr></thead><tbody>
<tr><td style="text-align: left"><code>-</code></td><td style="text-align: left"><strong>Left-justify</strong>: The result is left-aligned within the specified field width. By default, it is right-aligned.</td></tr>
<tr><td style="text-align: left"><code>+</code></td><td style="text-align: left"><strong>Sign</strong>: The result of a signed conversion will always begin with a sign (<code>+</code> or <code>-</code>). By default, only negative values have a sign.</td></tr>
<tr><td style="text-align: left"><code> </code> (space)</td><td style="text-align: left"><strong>Space</strong>: If the first character of a signed conversion is not a sign, a space is prepended. This is ignored if the <code>+</code> flag is present.</td></tr>
<tr><td style="text-align: left"><code>#</code></td><td style="text-align: left"><strong>Alternate Form</strong>: For <code>o</code>, the output is prefixed with <code>0</code>. For <code>x</code> and <code>X</code>, it's prefixed with <code>0x</code> and <code>0X</code> respectively. For <code>a</code>, <code>A</code>, <code>e</code>, <code>E</code>, <code>f</code>, <code>F</code>, <code>g</code>, and <code>G</code>, the output will always contain a decimal point.</td></tr>
<tr><td style="text-align: left"><code>0</code></td><td style="text-align: left"><strong>Zero-padding</strong>: For numeric types, the output is padded with leading zeros instead of spaces to fill the field width. This is ignored if the <code>-</code> flag is present.</td></tr>
</tbody></table>
</div>
<h2 id="width"><a class="header" href="#width">width</a></h2>
<p>The width sub-specifier sets the minimum number of characters to be printed.</p>
<div class="table-wrapper"><table><thead><tr><th style="text-align: left">Width</th><th style="text-align: left">Description</th></tr></thead><tbody>
<tr><td style="text-align: left"><code>number</code></td><td style="text-align: left">A non-negative integer specifying the minimum number of characters to print. If the printed value is shorter, it is padded with spaces (or zeros if the <code>0</code> flag is used).</td></tr>
<tr><td style="text-align: left"><code>*</code></td><td style="text-align: left">The width is not specified in the format string itself, but as an additional integer argument preceding the argument to be formatted.</td></tr>
</tbody></table>
</div>
<h2 id="precision"><a class="header" href="#precision">precision</a></h2>
<div class="table-wrapper"><table><thead><tr><th style="text-align: left">Precision</th><th style="text-align: left">Description</th></tr></thead><tbody>
<tr><td style="text-align: left"><code>.number</code></td><td style="text-align: left">For integer specifiers (<code>d</code>, <code>i</code>, <code>u</code>, <code>o</code>, <code>x</code>, <code>X</code>), it specifies the minimum number of digits to be written. For <code>e</code>, <code>E</code>, and <code>f</code>, it is the number of digits to appear after the decimal point. For <code>g</code> and <code>G</code>, it's the maximum number of significant digits. For <code>s</code>, it's the maximum number of characters to be printed.</td></tr>
<tr><td style="text-align: left"><code>.*</code></td><td style="text-align: left">The precision is not specified in the format string itself, but as an additional integer argument preceding the argument to be formatted.</td></tr>
</tbody></table>
</div>
<h2 id="length"><a class="header" href="#length">length</a></h2>
<div class="table-wrapper"><table><thead><tr><th style="text-align: left">Modifier</th><th style="text-align: left">For Integer Specifiers (<code>d</code>, <code>i</code>, <code>u</code>, <code>o</code>, <code>x</code>, <code>X</code>)</th><th style="text-align: left">For Floating-Point Specifiers (<code>f</code>, <code>e</code>, <code>g</code>, <code>a</code>)</th></tr></thead><tbody>
<tr><td style="text-align: left"><code>h</code></td><td style="text-align: left"><code>short int</code> or <code>unsigned short int</code></td><td style="text-align: left">-</td></tr>
<tr><td style="text-align: left"><code>hh</code></td><td style="text-align: left"><code>signed char</code> or <code>unsigned char</code></td><td style="text-align: left">-</td></tr>
<tr><td style="text-align: left"><code>l</code></td><td style="text-align: left"><code>long int</code> or <code>unsigned long int</code></td><td style="text-align: left">-</td></tr>
<tr><td style="text-align: left"><code>ll</code></td><td style="text-align: left"><code>long long int</code> or <code>unsigned long long int</code></td><td style="text-align: left">-</td></tr>
<tr><td style="text-align: left"><code>L</code></td><td style="text-align: left">-</td><td style="text-align: left"><code>long double</code></td></tr>
<tr><td style="text-align: left"><code>j</code></td><td style="text-align: left"><code>intmax_t</code> or <code>uintmax_t</code></td><td style="text-align: left">-</td></tr>
<tr><td style="text-align: left"><code>z</code></td><td style="text-align: left"><code>size_t</code> or the corresponding signed type</td><td style="text-align: left">-</td></tr>
<tr><td style="text-align: left"><code>t</code></td><td style="text-align: left"><code>ptrdiff_t</code> or the corresponding unsigned type</td><td style="text-align: left">-</td></tr>
</tbody></table>
</div>
<h2 id="specifier"><a class="header" href="#specifier">specifier</a></h2>
<div class="table-wrapper"><table><thead><tr><th style="text-align: left">Specifier</th><th style="text-align: left">Data Type</th><th style="text-align: left">Output Format</th></tr></thead><tbody>
<tr><td style="text-align: left"><code>%c</code></td><td style="text-align: left"><code>char</code></td><td style="text-align: left">A single character.</td></tr>
<tr><td style="text-align: left"><code>%s</code></td><td style="text-align: left"><code>char*</code></td><td style="text-align: left">A string of characters.</td></tr>
<tr><td style="text-align: left"><code>%d</code> or <code>%i</code></td><td style="text-align: left"><code>int</code></td><td style="text-align: left">Signed decimal integer.</td></tr>
<tr><td style="text-align: left"><code>%u</code></td><td style="text-align: left"><code>unsigned int</code></td><td style="text-align: left">Unsigned decimal integer.</td></tr>
<tr><td style="text-align: left"><code>%o</code></td><td style="text-align: left"><code>unsigned int</code></td><td style="text-align: left">Unsigned octal integer.</td></tr>
<tr><td style="text-align: left"><code>%x</code></td><td style="text-align: left"><code>unsigned int</code></td><td style="text-align: left">Unsigned hexadecimal integer (lowercase letters).</td></tr>
<tr><td style="text-align: left"><code>%X</code></td><td style="text-align: left"><code>unsigned int</code></td><td style="text-align: left">Unsigned hexadecimal integer (uppercase letters).</td></tr>
<tr><td style="text-align: left"><code>%f</code></td><td style="text-align: left"><code>double</code></td><td style="text-align: left">Decimal floating-point number.</td></tr>
<tr><td style="text-align: left"><code>%F</code></td><td style="text-align: left"><code>double</code></td><td style="text-align: left">Decimal floating-point number (uppercase 'INF' and 'NAN').</td></tr>
<tr><td style="text-align: left"><code>%e</code></td><td style="text-align: left"><code>double</code></td><td style="text-align: left">Scientific notation (lowercase 'e').</td></tr>
<tr><td style="text-align: left"><code>%E</code></td><td style="text-align: left"><code>double</code></td><td style="text-align: left">Scientific notation (uppercase 'E').</td></tr>
<tr><td style="text-align: left"><code>%g</code></td><td style="text-align: left"><code>double</code></td><td style="text-align: left">Uses the shorter of <code>%f</code> or <code>%e</code>.</td></tr>
<tr><td style="text-align: left"><code>%G</code></td><td style="text-align: left"><code>double</code></td><td style="text-align: left">Uses the shorter of <code>%F</code> or <code>%E</code>.</td></tr>
<tr><td style="text-align: left"><code>%a</code></td><td style="text-align: left"><code>double</code></td><td style="text-align: left">Hexadecimal floating-point number (lowercase 'p').</td></tr>
<tr><td style="text-align: left"><code>%A</code></td><td style="text-align: left"><code>double</code></td><td style="text-align: left">Hexadecimal floating-point number (uppercase 'P').</td></tr>
<tr><td style="text-align: left"><code>%p</code></td><td style="text-align: left"><code>void*</code></td><td style="text-align: left">Pointer address.</td></tr>
<tr><td style="text-align: left"><code>%n</code></td><td style="text-align: left"><code>int*</code></td><td style="text-align: left">The number of characters written so far is stored in the integer pointed to by the argument. Nothing is printed.</td></tr>
<tr><td style="text-align: left"><code>%%</code></td><td style="text-align: left"><em>None</em></td><td style="text-align: left">A literal '%' character is printed.</td></tr>
</tbody></table>
</div><div style="break-before: page; page-break-before: always;"></div><h1 id="predefined-macros"><a class="header" href="#predefined-macros">predefined macros</a></h1>
<p>links: <a href="https://gcc.gnu.org/onlinedocs/cpp/Standard-Predefined-Macros.html">https://gcc.gnu.org/onlinedocs/cpp/Standard-Predefined-Macros.html</a>
clang spesific: <a href="https://clang.llvm.org/docs/LanguageExtensions.html">https://clang.llvm.org/docs/LanguageExtensions.html</a></p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="vt-hexdump"><a class="header" href="#vt-hexdump">vt-hexdump</a></h1>
<pre><code class="language-c">/* SPDX-License-Identifier: GPL-2.0-only */
/*
 * Copyright (C) Fadhil Riyanto &lt;fadhil.riyanto@gnuweeb.org&gt;
 *
 * this version is inspired by Ammar Faizi's versions
 * ref: https://gist.githubusercontent.com/ammarfaizi2/e88a21171358b5092a3df412eeb80b2f/raw/59141b48f59b70b1e96208716c45b1703c56daa7/vt_hexdump.h
 */

#include &lt;complex.h&gt;
#include &lt;stddef.h&gt;
#include &lt;stdint.h&gt;
#include &lt;stdio.h&gt;
#include &lt;string.h&gt;

#ifndef VT_HEXDUMP_COLOR
#define VT_HEXDUMP_COLOR(fmt, vt_hexdump_hex)                                   \
        char current_hex = (char)vt_hexdump_hex;                                \
                                                                                \
        if (current_hex == 0x7F) {                                              \
                printf("\033[1;31m" fmt "\033[0m", vt_hexdump_hex);             \
        } else if (current_hex == 0xFF) {                                       \
                printf("\033[1;34m" fmt "\033[0m", vt_hexdump_hex);             \
        } else if (current_hex == 0x00) {                                       \
                printf("\033[1;37m" fmt "\033[0m", vt_hexdump_hex);             \
        } else {                                                                \
                printf("\033[1;32m" fmt "\033[0m", vt_hexdump_hex);             \
        }                                                                       \
        
#endif /* VT_HEXDUMP_COLOR */

#define VT_TITLE(PTR, SIZE)                                                     \
        size_t t_ptr_size = SIZE;                                                 \
        unsigned char *t_realptr = (unsigned char*)PTR;                           \
        printf("================= VT_HEXDUMP =================\n");             \
        printf("file\t\t: %s:%d\n", __FILE__, __LINE__);                        \
        printf("func\t\t: %s\n", __FUNCTION__);                                 \
        printf("addr\t\t: 0x%016lx\n", t_realptr);                                \
        printf("dump_size\t: %ld\n\n", t_ptr_size);

#ifndef HEXDUMP
#define HEXDUMP(PTR, SIZE)                                                      \
        size_t ptr_size = SIZE;                                                 \
        unsigned char *realptr = (unsigned char*)PTR;                           \
        unsigned int initial_counter = 0;                                       \
                                                                                \
        int n_loop = (ptr_size / 16) + 1;                                       \
        if (ptr_size % 16 == 0) {                                               \
                n_loop = n_loop - 1;                                            \
        }                                                                       \
                                                                                \
        for (int x = 0; x &lt; 75; x++) {                                          \
                if (x &gt;= 40) {                                                  \
                        printf("16 BYTES WIDE\n");                              \
                        break;                                                  \
                } else {                                                        \
                        printf(" ");                                            \
                }                                                               \
        }                                                                       \
                                                                                \
        for (int x = 0; x &lt; 75; x++) {                                          \
                if (x &gt;= 21 &amp;&amp; x &lt;= 73) {                                       \
                        printf("_");                                            \
                } else {                                                        \
                        printf(" ");                                            \
                }                                                               \
        }                                                                       \
        printf("\n");                                                           \
                                                                                \
        for (int i = 0; i &lt; n_loop; i++) {                                      \
                printf("|0x%016lx|", (uintptr_t)(realptr));                     \
                                                                                \
                for (int i = 0; i &lt; 16; i++) {                                  \
                        if (i % 4 == 0 &amp;&amp; i != 0) {                             \
                                printf("  ");                                   \
                        }                                                       \
                        if (i != 15) {                                          \
                                if (initial_counter &lt;= ptr_size) {              \
                                        VT_HEXDUMP_COLOR(" %02x", realptr[i]);  \
                                }                                               \
                        } else {                                                \
                                printf(" %02x ", realptr[i]);                   \
                        }                                                       \
                }                                                               \
                                                                                \
                printf(" | ");                                                  \
                for (int i = 0; i &lt; 16; i++) {                                  \
                        if (initial_counter &lt;= ptr_size - 1) {                  \
                                if (realptr[i] &gt;= 32 &amp;&amp; realptr[i] &lt;= 126) {    \
                                        printf("%c", realptr[i]);               \
                                } else {                                        \
                                        printf(".", realptr[i]);                \
                                }                                               \
                        } else {                                                \
                                printf(".");                                    \
                        }                                                       \
                        initial_counter = initial_counter + 1;                  \
                }                                                               \
                printf(" | ");                                                  \
                                                                                \
                printf("\n");                                                   \
                realptr = realptr + 16;                                         \
        }
#endif                                     

#ifndef VT_HEXDUMP
#define VT_HEXDUMP(PTR, SIZE)                                                   \
        VT_TITLE(PTR, SIZE);                                                             \
        HEXDUMP(PTR, SIZE);
#endif

</code></pre>
<p><img src="sysprog//assets/0fe67c66a45b1014280ade272e2a9185bf909e385fa794c1c6eab0e5d7858be3b2fa4e253ccca81373dcd60f04b5d11812737117e88d5d99489b23ad.png" alt="image" /></p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="elf64-text-only"><a class="header" href="#elf64-text-only">ELF64 text only</a></h1>
<h2 id="elf-types"><a class="header" href="#elf-types">ELF Types</a></h2>
<p>There are three main types for ELF files.</p>
<ul>
<li>An executable file contains code and data suitable for execution. It specifies the memory layout of the process.</li>
<li>A relocatable file contains code and data suitable for linking with other relocatable and shared object files.</li>
<li>A shared object file (a.k.a. shared library) contains code and data suitable for the link editor ld at link time and the dynamic linker at run time. The dynamic linker may be called ld.so.1, libc.so.1 or ld-linux.so.1, depending on the implementation.</li>
</ul>
<p>The most useful part of ELF lies in its section structure. With the right tools and techniques, programmers can manipulate the execution of executables with great flexibility.</p>
<p>source: <a href="https://ftp.math.utah.edu/u/ma/hohn/linux/misc/elf/node2.html">https://ftp.math.utah.edu/u/ma/hohn/linux/misc/elf/node2.html</a></p>
<p>big fat ELF docs: <a href="https://docs.oracle.com/cd/E19683-01/816-1386/6m7qcoblh/index.html">https://docs.oracle.com/cd/E19683-01/816-1386/6m7qcoblh/index.html</a>, big thanks to oracle!</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="elf64"><a class="header" href="#elf64">ELF64</a></h1>
<p>what is ELF64? ELF64 is Executable and Linkable Format for unix system (mostly), lets look the structure of elf64_hdr</p>
<p>this struct located at beginning of object file, the main usage is locate all other parts of object file. the header (such *.o file contains ELF struct)</p>
<h1 id="preface"><a class="header" href="#preface">preface</a></h1>
<p>this is how ELF file look-like</p>
<p><img src="sysprog//assets/479e744cf1e8b875f5f863c6611810a56dcd72d1fd8ac26ef937f6d33d42d4dbc62a656347a63085647c587c1b9f598a3239849e1198b500758796a4.png" alt="image" /></p>
<pre><code class="language-c">typedef struct elf64_hdr {
  unsigned char	e_ident[EI_NIDENT];	/* ELF "magic number" */
  Elf64_Half e_type;
  Elf64_Half e_machine;
  Elf64_Word e_version;
  Elf64_Addr e_entry;		/* Entry point virtual address */
  Elf64_Off e_phoff;		/* Program header table file offset */
  Elf64_Off e_shoff;		/* Section header table file offset */
  Elf64_Word e_flags;
  Elf64_Half e_ehsize;
  Elf64_Half e_phentsize;
  Elf64_Half e_phnum;
  Elf64_Half e_shentsize;
  Elf64_Half e_shnum;
  Elf64_Half e_shstrndx;
} Elf64_Ehdr;

</code></pre>
<p>code: <a href="https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/tree/include/uapi/linux/elf.h#n234">https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/tree/include/uapi/linux/elf.h#n234</a></p>
<p>the ELF file is always start by this bytes <code>7f 45 4c 46</code>, which <code>DEL E L F</code></p>
<p><img src="sysprog//assets/b89533896a5f2d38cf09f1354e807b4f6276057affaf8fafe54372090ba70e9fae73f4e83a156800ff863c7a4196e99a73b8ffed8a0717b694c00ad3.png" alt="image" /></p>
<p>The first 16 bytes <a href="https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/tree/include/uapi/linux/elf.h#n215">link</a> is a magic number, <code>7f</code> make sure the text editor, this is not a normal file, this is binary, preventing to open the file. <code>45 4c 46</code> is a ELF signature</p>
<h1 id="elfclass"><a class="header" href="#elfclass">ELFCLASS</a></h1>
<p>This footage shown program compiled by normal gcc (my machine is 64 bit), vs compiled by <code>-m32</code></p>
<p><img src="sysprog//assets/587e7d3b9bdafd01ed1a1b4cc59a9a11d6e60d773336d7827385aab80b6e453fb1c4ae17ae0f4f5feadef9a8822d51794a8f07f5f7911975eb319853.png" alt="image" /></p>
<h1 id="elf-file-structure"><a class="header" href="#elf-file-structure">ELF file structure</a></h1>
<ul>
<li><code>elf64_hdr</code>: <a href="sysprog/elf64.html#elf64_hdr">elf header</a></li>
<li><code>elf64_shdr</code>: elf section header</li>
<li><code>elf64_phdr</code>: elf program header</li>
</ul>
<h2 id="elf64_hdr"><a class="header" href="#elf64_hdr">elf64_hdr</a></h2>
<p>the definition</p>
<pre><code class="language-c">typedef struct elf64_hdr {
  unsigned char e_ident[EI_NIDENT]; /* Magic number and other info */
  Elf64_Half    e_type;      /* Object file type */
  Elf64_Half    e_machine;   /* Architecture */
  Elf64_Word    e_version;   /* Object file version */
  Elf64_Addr    e_entry;     /* Entry point virtual address */
  Elf64_Off     e_phoff;     /* Program header table file offset */
  Elf64_Off     e_shoff;     /* Section header table file offset */
  Elf64_Word    e_flags;     /* Processor-specific flags */
  Elf64_Half    e_ehsize;    /* ELF header size in bytes */
  Elf64_Half    e_phentsize; /* Program header table entry size */
  Elf64_Half    e_phnum;     /* Program header table entry count */
  Elf64_Half    e_shentsize; /* Section header table entry size */
  Elf64_Half    e_shnum;     /* Section header table entry count */
  Elf64_Half    e_shstrndx;  /* Section names string table index */
} Elf64_Ehdr;
</code></pre>
<h3 id="link-go-to-the-definition"><a class="header" href="#link-go-to-the-definition">link go to the definition</a></h3>
<ul>
<li><a href="sysprog/elf64.html#e_ident">e_ident</a>: Magic number and other info</li>
<li><a href="sysprog/elf64.html#e_type">e_type</a>: Object file type</li>
<li><a href="sysprog/elf64.html#e_machine">e_machine</a>: Architecture</li>
<li><a href="sysprog/elf64.html#e_version">e_version</a>: Object file version</li>
<li><a href="sysprog/">e_entry</a>: Entry point virtual address</li>
<li><a href="sysprog/">e_phoff</a>: Program header table file offset</li>
<li><a href="sysprog/">e_shoff</a>: Section header table file offset</li>
<li><a href="sysprog/">e_flags</a>: Processor-specific flags</li>
<li><a href="sysprog/">e_ehsize</a>: ELF header size in bytes</li>
<li><a href="sysprog/">e_phentsize</a>: Program header table entry size</li>
<li><a href="sysprog/">e_phnum</a>: Program header table entry count</li>
<li><a href="sysprog/">e_shentsize</a>: Section header table entry size</li>
<li><a href="sysprog/">e_shnum</a>: Section header table entry count</li>
<li><a href="sysprog/">e_shstrndx</a>: Section names string table index</li>
</ul>
<p>the value (enum like)</p>
<h3 id="e_ident"><a class="header" href="#e_ident">e_ident</a></h3>
<ul>
<li>INDEX: <code>[0, 1, 2, 3]</code></li>
</ul>
<pre><code class="language-c">  #define EI_MAG0         0               /* File identification byte 0 index */
  #define ELFMAG0         0x7f            /* Magic number byte 0 */

  #define EI_MAG1         1               /* File identification byte 1 index */
  #define ELFMAG1         'E'             /* Magic number byte 1 */

  #define EI_MAG2         2               /* File identification byte 2 index */
  #define ELFMAG2         'L'             /* Magic number byte 2 */

  #define EI_MAG3         3               /* File identification byte 3 index */
  #define ELFMAG3         'F'             /* Magic number byte 3 */
</code></pre>
<ul>
<li>INDEX: <code>[4]</code></li>
</ul>
<pre><code class="language-C">#define ELFCLASSNONE    0               /* Invalid class */
#define ELFCLASS32      1               /* 32-bit objects */
#define ELFCLASS64      2               /* 64-bit objects */
#define ELFCLASSNUM     3
</code></pre>
<ul>
<li>INDEX: <code>[5]</code></li>
</ul>
<pre><code class="language-C">#define ELFDATANONE     0               /* Invalid data encoding */
#define ELFDATA2LSB     1               /* 2's complement, little endian */
#define ELFDATA2MSB     2               /* 2's complement, big endian */
#define ELFDATANUM      3
</code></pre>
<ul>
<li>INDEX: <code>[6]</code></li>
</ul>
<pre><code class="language-C">#define EI_VERSION      6               /* File version byte index */
                                        /* Value must be EV_CURRENT */
</code></pre>
<ul>
<li>INDEX: <code>[7]</code></li>
</ul>
<pre><code class="language-C">#define ELFOSABI_NONE           0       /* UNIX System V ABI */
#define ELFOSABI_SYSV           0       /* Alias.  */
#define ELFOSABI_HPUX           1       /* HP-UX */
#define ELFOSABI_NETBSD         2       /* NetBSD.  */
#define ELFOSABI_GNU            3       /* Object uses GNU ELF extensions.  */
#define ELFOSABI_LINUX          ELFOSABI_GNU /* Compatibility alias.  */
#define ELFOSABI_SOLARIS        6       /* Sun Solaris.  */
#define ELFOSABI_AIX            7       /* IBM AIX.  */
#define ELFOSABI_IRIX           8       /* SGI Irix.  */
#define ELFOSABI_FREEBSD        9       /* FreeBSD.  */
#define ELFOSABI_TRU64          10      /* Compaq TRU64 UNIX.  */
#define ELFOSABI_MODESTO        11      /* Novell Modesto.  */
#define ELFOSABI_OPENBSD        12      /* OpenBSD.  */
#define ELFOSABI_ARM_AEABI      64      /* ARM EABI */
#define ELFOSABI_ARM            97      /* ARM */
#define ELFOSABI_STANDALONE     255     /* Standalone (embedded) application */
</code></pre>
<ul>
<li>INDEX: <code>[8]</code></li>
</ul>
<pre><code class="language-C">#define EI_ABIVERSION   8               /* ABI version */
</code></pre>
<ul>
<li>INDEX: <code>[9]</code></li>
</ul>
<pre><code class="language-c">#define EI_PAD          9               /* Byte index of padding bytes */
</code></pre>
<p><a href="sysprog/elf64.html#link-go-to-the-definition">back</a></p>
<h3 id="e_type"><a class="header" href="#e_type">e_type</a></h3>
<pre><code class="language-c">#define ET_NONE         0               /* No file type */
#define ET_REL          1               /* Relocatable file */
#define ET_EXEC         2               /* Executable file */
#define ET_DYN          3               /* Shared object file */
#define ET_CORE         4               /* Core file */
#define ET_NUM          5               /* Number of defined types */
#define ET_LOOS         0xfe00          /* OS-specific range start */
#define ET_HIOS         0xfeff          /* OS-specific range end */
#define ET_LOPROC       0xff00          /* Processor-specific range start */
#define ET_HIPROC       0xffff          /* Processor-specific range end */
</code></pre>
<p><a href="sysprog/elf64.html#link-go-to-the-definition">back</a></p>
<h3 id="e_machine"><a class="header" href="#e_machine">e_machine</a></h3>
<pre><code class="language-c">#define EM_NONE    0  /* No machine */
#define EM_M32     1  /* AT&amp;T WE 32100 */
#define EM_SPARC   2  /* SUN SPARC */
#define EM_386     3  /* Intel 80386 */
#define EM_68K     4  /* Motorola m68k family */
#define EM_88K     5  /* Motorola m88k family */
#define EM_IAMCU   6  /* Intel MCU */
#define EM_860     7  /* Intel 80860 */
#define EM_MIPS    8  /* MIPS R3000 big-endian */
#define EM_S370    9  /* IBM System/370 */
#define EM_MIPS_RS3_LE  10  /* MIPS R3000 little-endian */
        /* reserved 11-14 */
#define EM_PARISC 15  /* HPPA */
        /* reserved 16 */
#define EM_VPP500 17  /* Fujitsu VPP500 */
#define EM_SPARC32PLUS  18  /* Sun's "v8plus" */
#define EM_960    19  /* Intel 80960 */
#define EM_PPC    20  /* PowerPC */
#define EM_PPC64  21  /* PowerPC 64-bit */
#define EM_S390   22  /* IBM S390 */
#define EM_SPU    23  /* IBM SPU/SPC */
        /* reserved 24-35 */
#define EM_V800   36  /* NEC V800 series */
#define EM_FR20   37  /* Fujitsu FR20 */
#define EM_RH32   38  /* TRW RH-32 */
#define EM_RCE    39  /* Motorola RCE */
#define EM_ARM    40  /* ARM */
#define EM_FAKE_ALPHA 41  /* Digital Alpha */
#define EM_SH   42  /* Hitachi SH */
#define EM_SPARCV9  43  /* SPARC v9 64-bit */
#define EM_TRICORE  44  /* Siemens Tricore */
#define EM_ARC    45  /* Argonaut RISC Core */
#define EM_H8_300 46  /* Hitachi H8/300 */
#define EM_H8_300H  47  /* Hitachi H8/300H */
#define EM_H8S    48  /* Hitachi H8S */
#define EM_H8_500 49  /* Hitachi H8/500 */
#define EM_IA_64  50  /* Intel Merced */
#define EM_MIPS_X 51  /* Stanford MIPS-X */
#define EM_COLDFIRE 52  /* Motorola Coldfire */
#define EM_68HC12 53  /* Motorola M68HC12 */
#define EM_MMA    54  /* Fujitsu MMA Multimedia Accelerator */
#define EM_PCP    55  /* Siemens PCP */
#define EM_NCPU   56  /* Sony nCPU embedded RISC */
#define EM_NDR1   57  /* Denso NDR1 microprocessor */
#define EM_STARCORE 58  /* Motorola Start*Core processor */
#define EM_ME16   59  /* Toyota ME16 processor */
#define EM_ST100  60  /* STMicroelectronic ST100 processor */
#define EM_TINYJ  61  /* Advanced Logic Corp. Tinyj emb.fam */
#define EM_X86_64 62  /* AMD x86-64 architecture */
#define EM_PDSP   63  /* Sony DSP Processor */
#define EM_PDP10  64  /* Digital PDP-10 */
#define EM_PDP11  65  /* Digital PDP-11 */
#define EM_FX66   66  /* Siemens FX66 microcontroller */
#define EM_ST9PLUS  67  /* STMicroelectronics ST9+ 8/16 mc */
#define EM_ST7    68  /* STmicroelectronics ST7 8 bit mc */
#define EM_68HC16 69  /* Motorola MC68HC16 microcontroller */
#define EM_68HC11 70  /* Motorola MC68HC11 microcontroller */
#define EM_68HC08 71  /* Motorola MC68HC08 microcontroller */
#define EM_68HC05 72  /* Motorola MC68HC05 microcontroller */
#define EM_SVX    73  /* Silicon Graphics SVx */
#define EM_ST19   74  /* STMicroelectronics ST19 8 bit mc */
#define EM_VAX    75  /* Digital VAX */
#define EM_CRIS   76  /* Axis Communications 32-bit emb.proc */
#define EM_JAVELIN  77  /* Infineon Technologies 32-bit emb.proc */
#define EM_FIREPATH 78  /* Element 14 64-bit DSP Processor */
#define EM_ZSP    79  /* LSI Logic 16-bit DSP Processor */
#define EM_MMIX   80  /* Donald Knuth's educational 64-bit proc */
#define EM_HUANY  81  /* Harvard University machine-independent object files */
#define EM_PRISM  82  /* SiTera Prism */
#define EM_AVR    83  /* Atmel AVR 8-bit microcontroller */
#define EM_FR30   84  /* Fujitsu FR30 */
#define EM_D10V   85  /* Mitsubishi D10V */
#define EM_D30V   86  /* Mitsubishi D30V */
#define EM_V850   87  /* NEC v850 */
#define EM_M32R   88  /* Mitsubishi M32R */
#define EM_MN10300  89  /* Matsushita MN10300 */
#define EM_MN10200  90  /* Matsushita MN10200 */
#define EM_PJ   91  /* picoJava */
#define EM_OPENRISC 92  /* OpenRISC 32-bit embedded processor */
#define EM_ARC_COMPACT  93  /* ARC International ARCompact */
#define EM_XTENSA 94  /* Tensilica Xtensa Architecture */
#define EM_VIDEOCORE  95  /* Alphamosaic VideoCore */
#define EM_TMM_GPP  96  /* Thompson Multimedia General Purpose Proc */
#define EM_NS32K  97  /* National Semi. 32000 */
#define EM_TPC    98  /* Tenor Network TPC */
#define EM_SNP1K  99  /* Trebia SNP 1000 */
#define EM_ST200  100 /* STMicroelectronics ST200 */
#define EM_IP2K   101 /* Ubicom IP2xxx */
#define EM_MAX    102 /* MAX processor */
#define EM_CR   103 /* National Semi. CompactRISC */
#define EM_F2MC16 104 /* Fujitsu F2MC16 */
#define EM_MSP430 105 /* Texas Instruments msp430 */
#define EM_BLACKFIN 106 /* Analog Devices Blackfin DSP */
#define EM_SE_C33 107 /* Seiko Epson S1C33 family */
#define EM_SEP    108 /* Sharp embedded microprocessor */
#define EM_ARCA   109 /* Arca RISC */
#define EM_UNICORE  110 /* PKU-Unity &amp; MPRC Peking Uni. mc series */
#define EM_EXCESS 111 /* eXcess configurable cpu */
#define EM_DXP    112 /* Icera Semi. Deep Execution Processor */
#define EM_ALTERA_NIOS2 113 /* Altera Nios II */
#define EM_CRX    114 /* National Semi. CompactRISC CRX */
#define EM_XGATE  115 /* Motorola XGATE */
#define EM_C166   116 /* Infineon C16x/XC16x */
#define EM_M16C   117 /* Renesas M16C */
#define EM_DSPIC30F 118 /* Microchip Technology dsPIC30F */
#define EM_CE   119 /* Freescale Communication Engine RISC */
#define EM_M32C   120 /* Renesas M32C */
        /* reserved 121-130 */
#define EM_TSK3000  131 /* Altium TSK3000 */
#define EM_RS08   132 /* Freescale RS08 */
#define EM_SHARC  133 /* Analog Devices SHARC family */
#define EM_ECOG2  134 /* Cyan Technology eCOG2 */
#define EM_SCORE7 135 /* Sunplus S+core7 RISC */
#define EM_DSP24  136 /* New Japan Radio (NJR) 24-bit DSP */
#define EM_VIDEOCORE3 137 /* Broadcom VideoCore III */
#define EM_LATTICEMICO32 138  /* RISC for Lattice FPGA */
#define EM_SE_C17 139 /* Seiko Epson C17 */
#define EM_TI_C6000 140 /* Texas Instruments TMS320C6000 DSP */
#define EM_TI_C2000 141 /* Texas Instruments TMS320C2000 DSP */
#define EM_TI_C5500 142 /* Texas Instruments TMS320C55x DSP */
#define EM_TI_ARP32 143 /* Texas Instruments App. Specific RISC */
#define EM_TI_PRU 144 /* Texas Instruments Prog. Realtime Unit */
        /* reserved 145-159 */
#define EM_MMDSP_PLUS 160 /* STMicroelectronics 64bit VLIW DSP */
#define EM_CYPRESS_M8C  161 /* Cypress M8C */
#define EM_R32C   162 /* Renesas R32C */
#define EM_TRIMEDIA 163 /* NXP Semi. TriMedia */
#define EM_QDSP6  164 /* QUALCOMM DSP6 */
#define EM_8051   165 /* Intel 8051 and variants */
#define EM_STXP7X 166 /* STMicroelectronics STxP7x */
#define EM_NDS32  167 /* Andes Tech. compact code emb. RISC */
#define EM_ECOG1X 168 /* Cyan Technology eCOG1X */
#define EM_MAXQ30 169 /* Dallas Semi. MAXQ30 mc */
#define EM_XIMO16 170 /* New Japan Radio (NJR) 16-bit DSP */
#define EM_MANIK  171 /* M2000 Reconfigurable RISC */
#define EM_CRAYNV2  172 /* Cray NV2 vector architecture */
#define EM_RX   173 /* Renesas RX */
#define EM_METAG  174 /* Imagination Tech. META */
#define EM_MCST_ELBRUS  175 /* MCST Elbrus */
#define EM_ECOG16 176 /* Cyan Technology eCOG16 */
#define EM_CR16   177 /* National Semi. CompactRISC CR16 */
#define EM_ETPU   178 /* Freescale Extended Time Processing Unit */
#define EM_SLE9X  179 /* Infineon Tech. SLE9X */
#define EM_L10M   180 /* Intel L10M */
#define EM_K10M   181 /* Intel K10M */
        /* reserved 182 */
#define EM_AARCH64  183 /* ARM AARCH64 */
        /* reserved 184 */
#define EM_AVR32  185 /* Amtel 32-bit microprocessor */
#define EM_STM8   186 /* STMicroelectronics STM8 */
#define EM_TILE64 187 /* Tilera TILE64 */
#define EM_TILEPRO  188 /* Tilera TILEPro */
#define EM_MICROBLAZE 189 /* Xilinx MicroBlaze */
#define EM_CUDA   190 /* NVIDIA CUDA */
#define EM_TILEGX 191 /* Tilera TILE-Gx */
#define EM_CLOUDSHIELD  192 /* CloudShield */
#define EM_COREA_1ST  193 /* KIPO-KAIST Core-A 1st gen. */
#define EM_COREA_2ND  194 /* KIPO-KAIST Core-A 2nd gen. */
#define EM_ARCV2  195 /* Synopsys ARCv2 ISA.  */
#define EM_OPEN8  196 /* Open8 RISC */
#define EM_RL78   197 /* Renesas RL78 */
#define EM_VIDEOCORE5 198 /* Broadcom VideoCore V */
#define EM_78KOR  199 /* Renesas 78KOR */
#define EM_56800EX  200 /* Freescale 56800EX DSC */
#define EM_BA1    201 /* Beyond BA1 */
#define EM_BA2    202 /* Beyond BA2 */
#define EM_XCORE  203 /* XMOS xCORE */
#define EM_MCHP_PIC 204 /* Microchip 8-bit PIC(r) */
#define EM_INTELGT  205 /* Intel Graphics Technology */
        /* reserved 206-209 */
#define EM_KM32   210 /* KM211 KM32 */
#define EM_KMX32  211 /* KM211 KMX32 */
#define EM_EMX16  212 /* KM211 KMX16 */
#define EM_EMX8   213 /* KM211 KMX8 */
#define EM_KVARC  214 /* KM211 KVARC */
#define EM_CDP    215 /* Paneve CDP */
#define EM_COGE   216 /* Cognitive Smart Memory Processor */
#define EM_COOL   217 /* Bluechip CoolEngine */
#define EM_NORC   218 /* Nanoradio Optimized RISC */
#define EM_CSR_KALIMBA  219 /* CSR Kalimba */
#define EM_Z80    220 /* Zilog Z80 */
#define EM_VISIUM 221 /* Controls and Data Services VISIUMcore */
#define EM_FT32   222 /* FTDI Chip FT32 */
#define EM_MOXIE  223 /* Moxie processor */
#define EM_AMDGPU 224 /* AMD GPU */
        /* reserved 225-242 */
#define EM_RISCV  243 /* RISC-V */

#define EM_BPF    247 /* Linux BPF -- in-kernel virtual machine */
#define EM_CSKY   252     /* C-SKY */
#define EM_LOONGARCH  258 /* LoongArch */

#define EM_NUM    259

/* Old spellings/synonyms.  */

#define EM_ARC_A5 EM_ARC_COMPACT

/* If it is necessary to assign new unofficial EM_* values, please
   pick large random numbers (0x8523, 0xa7f2, etc.) to minimize the
   chances of collision with official or non-GNU unofficial values.  */

#define EM_ALPHA  0x9026
</code></pre>
<p><a href="sysprog/elf64.html#link-go-to-the-definition">back</a></p>
<h3 id="e_version"><a class="header" href="#e_version">e_version</a></h3>
<pre><code class="language-c">#define EV_NONE         0               /* Invalid ELF version */
#define EV_CURRENT      1               /* Current version */
#define EV_NUM          2
</code></pre>
<p><a href="sysprog/elf64.html#link-go-to-the-definition">back</a></p>
<h2 id="elf64_shdr"><a class="header" href="#elf64_shdr">elf64_shdr</a></h2>
<p>All data stores in a sections in an Elf object file. Sections identified by index in the section header table.</p>
<pre><code class="language-c">typedef struct
{
  Elf64_Word    sh_name;                /* Section name (string tbl index) */
  Elf64_Word    sh_type;                /* Section type */
  Elf64_Xword   sh_flags;               /* Section flags */
  Elf64_Addr    sh_addr;                /* Section virtual addr at execution */
  Elf64_Off     sh_offset;              /* Section file offset */
  Elf64_Xword   sh_size;                /* Section size in bytes */
  Elf64_Word    sh_link;                /* Link to another section */
  Elf64_Word    sh_info;                /* Additional section information */
  Elf64_Xword   sh_addralign;           /* Section alignment */
  Elf64_Xword   sh_entsize;             /* Entry size if section holds table */
} Elf64_Shdr;
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="posix-getopt_long"><a class="header" href="#posix-getopt_long">POSIX getopt_long</a></h1>
<p>optarg</p>
<ul>
<li>
<p><code>:</code> for required arguments, for example</p>
<ul>
<li><code>f:</code> expands to <code>-f abc</code></li>
<li>no <code>:</code> treated only as args, example <code>-v</code></li>
</ul>
</li>
<li>
<p><code>::</code> treated as optional args</p>
</li>
</ul>
<h2 id="usage"><a class="header" href="#usage">usage</a></h2>
<p>read <code>man 3 getopt</code></p>
<p>tldr</p>
<h2 id="lets-construct-array-of-option-struct"><a class="header" href="#lets-construct-array-of-option-struct">lets construct array of option struct</a></h2>
<p>definition:</p>
<pre><code class="language-c">struct option {
	const char *name;				// param name
	int         has_arg;			// set 1 or 0 (no)
	int        *flag;				// always 0
	int         val;				// whatever, 1 byte, used for switch block identification in future
};
</code></pre>
<p>example:</p>
<pre><code class="language-c">static struct option long_options[] = {
    {"file", 1, 0, 'f'},
    {"elf", 1, 0, 'e'},
    NULL
};
</code></pre>
<h2 id="example"><a class="header" href="#example">example</a></h2>
<pre><code class="language-c">static int parse_options(int argc, char *argv[], struct gwdown_ctx *ctx)
{
	int ret = 0;

	while (1) {
		int c;

		c = getopt_long(argc, argv, "hvo:t:rVM", long_options, NULL);
		if (c == -1)
			break;

		switch (c) {
		case 'h':
			help(argv[0]);
			ret = 255;
			goto out;
		case 'v':
			printf("gwdown 0.1\n");
			ret = 255;
			goto out;
		case 'o':
			ctx-&gt;output = optarg;
			break;
		case 't':
			ctx-&gt;num_threads = (uint16_t)atoi(optarg);
			break;
		case 'r':
			ctx-&gt;resume = true;
			break;
		case 'V':
			ctx-&gt;verbose = true;
			break;
		case 'M':
			ctx-&gt;use_mmap = true;
			break;
		default:
			printf("Error: Unknown option '%s'\n\n", argv[optind]);
			help(argv[0]);
			ret = -EINVAL;
			goto out;
		}
	}

	if (ctx-&gt;num_threads &gt; 512) {
		printf("Error: Too many threads, max allowed thread is 512\n\n");
		ret = -EINVAL;
		goto out;
	}

	if (optind &lt; argc) {
		ctx-&gt;url = strdup(argv[optind]);
		if (!ctx-&gt;url)
			ret = -ENOMEM;
	} else {
		printf("Error: Missing url argument\n\n");
		help(argv[0]);
		ret = -EINVAL;
	}

	if (ctx-&gt;resume) {
		printf("Error: The resume feature is currently not supproted\n");
		printf("       It's still just a draft feature\n\n");
		ret = -EOPNOTSUPP;
	}

out:
	return ret;
}
</code></pre>
<p>as you can see, optarg is magically return current character based on switch case cond</p>
<h1 id="posix-getopt-only"><a class="header" href="#posix-getopt-only">POSIX getopt (only)</a></h1>
<p>its parse command line like this</p>
<h3 id="no-args-params"><a class="header" href="#no-args-params">no args params</a></h3>
<p>this option did not receive any arguments, so the optarg value is will be null
<code>./prog -v</code>, use optstring something like this <code>v</code></p>
<p><img src="sysprog//assets/9eac7b897acc6be415fa552aa839ddffd1211ab703f63a4357c9979cd29d97083d16453b9763bba1a0026989f6beefe7c4c88d768bb011588864ca63.png" alt="image" /></p>
<h3 id="optional-params"><a class="header" href="#optional-params">optional params</a></h3>
<p><code>./prog -p=8000 -l=127.0.0.1</code>, use optsting <code>p::l::</code></p>
<p>this is wrong example
<img src="sysprog//assets/c20aec4c2f351e63fc14bb0afc6ae79e8b17216de4505eeeadb82dfb7703468fcbd6ecdd1213bfce627cb1a353a8cf448c42862e1fb016d9f26ed05e.png" alt="image" /></p>
<p>this is good example
<img src="sysprog//assets/c5fb359b67e4b223d8a8bc1d738e163e391f5acee7d03d608369451b340bf1e10d79c2b8dd6a9cbcf29950be36dd45fbaabeffc35774edc461c838f8.png" alt="image" /></p>
<h2 id="required-params"><a class="header" href="#required-params">required params</a></h2>
<p><code>./prog -p 8000 -l 0.0.0.0</code> use optstring <code>p:l:</code></p>
<p><img src="sysprog//assets/c5fb359b67e4b223d8a8bc1d738e163e391f5acee7d03d608369451b340bf1e10d79c2b8dd6a9cbcf29950be36dd45fbaabeffc35774edc461c838f8.png" alt="image" /></p>
<h1 id="unknown-option-handling"><a class="header" href="#unknown-option-handling">unknown option handling</a></h1>
<p>the handling is very easy, <code>getopt()</code> return <code>?</code> when undefined rule is provided, then you can use <code>optopt</code> as a handler</p>
<h1 id="useful-links"><a class="header" href="#useful-links">useful links</a></h1>
<ul>
<li><a href="https://www.gnu.org/software/libc/manual/html_node/Example-of-Getopt.html">https://www.gnu.org/software/libc/manual/html_node/Example-of-Getopt.html</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="linux-virtual-memory-map"><a class="header" href="#linux-virtual-memory-map">linux virtual memory map</a></h1>
<p>Documentation/x86/x86_64/mm.txt</p>
<pre><code class="language-txt">
&lt;previous description obsolete, deleted&gt;

Virtual memory map with 4 level page tables:

0000000000000000 - 00007fffffffffff (=47 bits) user space, different per mm
hole caused by [47:63] sign extension
ffff800000000000 - ffff87ffffffffff (=43 bits) guard hole, reserved for hypervisor
ffff880000000000 - ffffc7ffffffffff (=64 TB) direct mapping of all phys. memory
ffffc80000000000 - ffffc8ffffffffff (=40 bits) hole
ffffc90000000000 - ffffe8ffffffffff (=45 bits) vmalloc/ioremap space
ffffe90000000000 - ffffe9ffffffffff (=40 bits) hole
ffffea0000000000 - ffffeaffffffffff (=40 bits) virtual memory map (1TB)
... unused hole ...
ffffec0000000000 - fffffbffffffffff (=44 bits) kasan shadow memory (16TB)
... unused hole ...
ffffff0000000000 - ffffff7fffffffff (=39 bits) %esp fixup stacks
... unused hole ...
ffffffef00000000 - fffffffeffffffff (=64 GB) EFI region mapping space
... unused hole ...
ffffffff80000000 - ffffffff9fffffff (=512 MB)  kernel text mapping, from phys 0
ffffffffa0000000 - ffffffffff5fffff (=1526 MB) module mapping space (variable)
ffffffffff600000 - ffffffffffdfffff (=8 MB) vsyscalls
ffffffffffe00000 - ffffffffffffffff (=2 MB) unused hole

Virtual memory map with 5 level page tables:

0000000000000000 - 00ffffffffffffff (=56 bits) user space, different per mm
hole caused by [56:63] sign extension
ff00000000000000 - ff0fffffffffffff (=52 bits) guard hole, reserved for hypervisor
ff10000000000000 - ff8fffffffffffff (=55 bits) direct mapping of all phys. memory
ff90000000000000 - ff91ffffffffffff (=49 bits) hole
ff92000000000000 - ffd1ffffffffffff (=54 bits) vmalloc/ioremap space
ffd2000000000000 - ffd3ffffffffffff (=49 bits) hole
ffd4000000000000 - ffd5ffffffffffff (=49 bits) virtual memory map (512TB)
... unused hole ...
ffd8000000000000 - fff7ffffffffffff (=53 bits) kasan shadow memory (8PB)
... unused hole ...
ffffff0000000000 - ffffff7fffffffff (=39 bits) %esp fixup stacks
... unused hole ...
ffffffef00000000 - fffffffeffffffff (=64 GB) EFI region mapping space
... unused hole ...
ffffffff80000000 - ffffffff9fffffff (=512 MB)  kernel text mapping, from phys 0
ffffffffa0000000 - ffffffffff5fffff (=1526 MB) module mapping space
ffffffffff600000 - ffffffffffdfffff (=8 MB) vsyscalls
ffffffffffe00000 - ffffffffffffffff (=2 MB) unused hole

Architecture defines a 64-bit virtual address. Implementations can support
less. Currently supported are 48- and 57-bit virtual addresses. Bits 63
through to the most-significant implemented bit are set to either all ones
or all zero. This causes hole between user space and kernel addresses.

The direct mapping covers all memory in the system up to the highest
memory address (this means in some cases it can also include PCI memory
holes).

vmalloc space is lazily synchronized into the different PML4/PML5 pages of
the processes using the page fault handler, with init_top_pgt as
reference.

Current X86-64 implementations support up to 46 bits of address space (64 TB),
which is our current limit. This expands into MBZ space in the page tables.

We map EFI runtime services in the 'efi_pgd' PGD in a 64Gb large virtual
memory window (this size is arbitrary, it can be raised later if needed).
The mappings are not part of any other kernel PGD and are only available
during EFI runtime calls.

The module mapping space size changes based on the CONFIG requirements for the
following fixmap section.

Note that if CONFIG_RANDOMIZE_MEMORY is enabled, the direct mapping of all
physical memory, vmalloc/ioremap space and virtual memory map are randomized.
Their order is preserved but their base will be offset early at boot time.

-Andi Kleen, Jul 2004</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="linux-x86_64-memory-map"><a class="header" href="#linux-x86_64-memory-map">linux x86_64 memory map</a></h1>
<pre><code class="language-txt">========================================================================================================================
    Start addr    |   Offset   |     End addr     |  Size   | VM area description
========================================================================================================================
                  |            |                  |         |
 0000000000000000 |    0       | 00fffffffffff000 |  ~64 PB | user-space virtual memory, different per mm
 00fffffffffff000 |  ~64    PB | 00ffffffffffffff |    4 kB | ... guard hole
__________________|____________|__________________|_________|___________________________________________________________
                  |            |                  |         |
 0100000000000000 |  +64    PB | 7fffffffffffffff |   ~8 EB | ... huge, almost 63 bits wide hole of non-canonical
                  |            |                  |         |     virtual memory addresses up to the -8EB TB
                  |            |                  |         |     starting offset of kernel mappings.
                  |            |                  |         |
                  |            |                  |         | LAM relaxes canonicallity check allowing to create aliases
                  |            |                  |         | for userspace memory here.
__________________|____________|__________________|_________|___________________________________________________________
                                                            |
                                                            | Kernel-space virtual memory, shared between all processes:
____________________________________________________________|___________________________________________________________
 8000000000000000 |   -8    EB | feffffffffffffff |   ~8 EB | ... huge, almost 63 bits wide hole of non-canonical
                  |            |                  |         |     virtual memory addresses up to the -64 PB
                  |            |                  |         |     starting offset of kernel mappings.
                  |            |                  |         |
                  |            |                  |         | LAM_SUP relaxes canonicallity check allowing to create
                  |            |                  |         | aliases for kernel memory here.
____________________________________________________________|___________________________________________________________
                  |            |                  |         |
 ff00000000000000 |  -64    PB | ff0fffffffffffff |    4 PB | ... guard hole, also reserved for hypervisor
 ff10000000000000 |  -60    PB | ff10ffffffffffff | 0.25 PB | LDT remap for PTI
 ff11000000000000 |  -59.75 PB | ff90ffffffffffff |   32 PB | direct mapping of all physical memory (page_offset_base)
 ff91000000000000 |  -27.75 PB | ff9fffffffffffff | 3.75 PB | ... unused hole
 ffa0000000000000 |  -24    PB | ffd1ffffffffffff | 12.5 PB | vmalloc/ioremap space (vmalloc_base)
 ffd2000000000000 |  -11.5  PB | ffd3ffffffffffff |  0.5 PB | ... unused hole
 ffd4000000000000 |  -11    PB | ffd5ffffffffffff |  0.5 PB | virtual memory map (vmemmap_base)
 ffd6000000000000 |  -10.5  PB | ffdeffffffffffff | 2.25 PB | ... unused hole
 ffdf000000000000 |   -8.25 PB | fffffbffffffffff |   ~8 PB | KASAN shadow memory
__________________|____________|__________________|_________|____________________________________________________________
                                                            |
                                                            | Identical layout to the 47-bit one from here on:
____________________________________________________________|____________________________________________________________
                  |            |                  |         |
 fffffc0000000000 |   -4    TB | fffffdffffffffff |    2 TB | ... unused hole
                  |            |                  |         | vaddr_end for KASLR
 fffffe0000000000 |   -2    TB | fffffe7fffffffff |  0.5 TB | cpu_entry_area mapping
 fffffe8000000000 |   -1.5  TB | fffffeffffffffff |  0.5 TB | ... unused hole
 ffffff0000000000 |   -1    TB | ffffff7fffffffff |  0.5 TB | %esp fixup stacks
 ffffff8000000000 | -512    GB | ffffffeeffffffff |  444 GB | ... unused hole
 ffffffef00000000 |  -68    GB | fffffffeffffffff |   64 GB | EFI region mapping space
 ffffffff00000000 |   -4    GB | ffffffff7fffffff |    2 GB | ... unused hole
 ffffffff80000000 |   -2    GB | ffffffff9fffffff |  512 MB | kernel text mapping, mapped to physical address 0
 ffffffff80000000 |-2048    MB |                  |         |
 ffffffffa0000000 |-1536    MB | fffffffffeffffff | 1520 MB | module mapping space
 ffffffffff000000 |  -16    MB |                  |         |
    FIXADDR_START | ~-11    MB | ffffffffff5fffff | ~0.5 MB | kernel-internal fixmap range, variable size and offset
 ffffffffff600000 |  -10    MB | ffffffffff600fff |    4 kB | legacy vsyscall ABI
 ffffffffffe00000 |   -2    MB | ffffffffffffffff |    2 MB | ... unused hole
__________________|____________|__________________|_________|___________________________________________________________
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="machine-dependent-type"><a class="header" href="#machine-dependent-type">machine dependent type</a></h1>
<p>this is why dangerous use default C type</p>
<p><img src="sysprog//assets/ab2fe93379a3a12a1f8c1bbf3d825092e88a5890ad2dffc12826ef5953bf82b5c028c0539985a2eb08fb222e33fb46bf9c96fa3e014d498f77c976c1.png" alt="image" /></p>
<p><code>unsigned long</code> is 8 byte wide (on x64), but 32 bit wide (on x86 arch).</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="io-format-of-integer-types"><a class="header" href="#io-format-of-integer-types">I/O format of integer types</a></h1>
<p>The following macros are defined in <code>inttypes.h</code>. Each expands to a character string literal containing a conversion specifier which can be modified by a length modifier that can be used in the format argument of a formatted input/output function when converting the corresponding integer type. These macros have the general form of PRI (character string literals for the <code>fprintf()</code> and <code>fwprintf()</code> family of functions) or SCN (character string literals for the fscanf() and fwscanf() family of functions), followed by the conversion specifier, followed by a name corresponding to a similar type name in <code>&lt;inttypes.h&gt;</code>. In these names, the suffix number represents the width of the type. For example, <code>PRIdFAST32</code> can be used in a format string to print the value of an integer of type <code>int_fast32_t</code>.</p>
<h1 id="decimal-notation"><a class="header" href="#decimal-notation">Decimal notation</a></h1>
<div class="table-wrapper"><table><thead><tr><th style="text-align: left">PRId8</th><th style="text-align: left">PRId16</th><th style="text-align: left">PRId32</th><th style="text-align: left">PRId64</th></tr></thead><tbody>
<tr><td style="text-align: left">PRIdLEAST8</td><td style="text-align: left">PRIdLEAST16</td><td style="text-align: left">PRIdLEAST32</td><td style="text-align: left">PRIdLEAST64</td></tr>
<tr><td style="text-align: left">PRIdFAST8</td><td style="text-align: left">PRIdFAST16</td><td style="text-align: left">PRIdFAST32</td><td style="text-align: left">PRIdFAST64</td></tr>
<tr><td style="text-align: left">PRIdMAX</td><td style="text-align: left"></td><td style="text-align: left"></td><td style="text-align: left"></td></tr>
<tr><td style="text-align: left">PRIdPTR</td><td style="text-align: left"></td><td style="text-align: left"></td><td style="text-align: left"></td></tr>
<tr><td style="text-align: left">PRIi8</td><td style="text-align: left">PRIi16</td><td style="text-align: left">PRIi32</td><td style="text-align: left">PRIi64</td></tr>
<tr><td style="text-align: left">PRIiLEAST8</td><td style="text-align: left">PRIiLEAST16</td><td style="text-align: left">PRIiLEAST32</td><td style="text-align: left">PRIiLEAST64</td></tr>
<tr><td style="text-align: left">PRIiFAST8</td><td style="text-align: left">PRIiFAST16</td><td style="text-align: left">PRIiFAST32</td><td style="text-align: left">PRIiFAST64</td></tr>
<tr><td style="text-align: left">PRIiMAX</td><td style="text-align: left"></td><td style="text-align: left"></td><td style="text-align: left"></td></tr>
<tr><td style="text-align: left">PRIiPTR</td><td style="text-align: left"></td><td style="text-align: left"></td><td style="text-align: left"></td></tr>
</tbody></table>
</div>
<p>example:</p>
<pre><code class="language-c">#define _ISOC99_SOURCE
#include &lt;inttypes.h&gt;      
#include &lt;stdio.h&gt; 
int main(void)                                             
{                                                          

int8_t i =  40; 
printf("Demonstrating the use of the following macros:\n");
printf("Using PRId8, the printed value of 40 "                  
"is  %" PRId8"\n", i);                                    
printf("Using PRIiFAST8, the printed value of 40 "               
"is  %" PRIiFAST8"\n", i);                                 
printf("Using PRIoLEAST8, the printed value of 40 "              
"is  %" PRIoLEAST8 "\n", i);                               
return 0;                                                  
}                          


Output:

Demonstrating the use of the following macros:  
Using PRId8, the printed value of 40 is  40     
Using PRIiFAST8, the printed value of 40 is  40 
Using PRIoLEAST8, the printed value of 40 is  50
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="types-war"><a class="header" href="#types-war">types war</a></h1>
<p>recently, I face a spesific issue in order choosing best types for my program. my goal is choose best need for my C datatype</p>
<p>there has some header exists</p>
<ul>
<li><code>stdint.h</code></li>
<li><code>sys/types.h</code></li>
</ul>
<p>difference from location presefective</p>
<ul>
<li><code>/usr/lib/clang/20/include/stdint.h</code></li>
<li><code>/usr/include/sys/types.h</code></li>
</ul>
<p>see? <code>stdint.h</code> is more compiler oriented, and <code>sys/types.h</code> is more system oriented, that right, <code>sys/types.h</code> is POSIX. It's fundamentally about defining types used by system calls and other OS-level interfaces.</p>
<h1 id="systypesh"><a class="header" href="#systypesh"><code>sys/types.h</code></a></h1>
<p>Purpose: To define data types used in system-level programming. These types are often opaque and their actual size can vary between different systems (e.g., a 32-bit vs. a 64-bit system), but they provide a portable way to interface with the OS kernel.</p>
<p>Origin: System V and BSD systems, later standardized by POSIX.</p>
<p>Use sys/types.h when you are writing code that makes POSIX-compliant system calls (open, read, fork, stat, etc.).</p>
<div class="warning">
<p>Note</p>
<p>there is no format specifier header.</p>
</div>
<h1 id="stdinth"><a class="header" href="#stdinth"><code>stdint.h</code></a></h1>
<p>This header is part of the ISO C99 standard and later. It is focused on providing programmers with explicit control over the size of integer data types.</p>
<p>Purpose: To define integer types of a specific, fixed width and to provide macros for printing and scanning these types with the printf and scanf family of functions.</p>
<div class="warning">
<p>Note</p>
<p>use <code>inttypes.h</code> for formatting, see spesific topic about it <a href="sysprog//sysprog/inttypes.html">here</a></p>
</div>
<h1 id="conlusion"><a class="header" href="#conlusion">conlusion</a></h1>
<p>Default to <code>&lt;stdint.h&gt;</code> for all your data definitions. Only use types from <code>&lt;sys/types.h&gt;</code> when you are calling an OS/POSIX function that requires them.</p>
<p>normal struct? use stdint.h</p>
<p>interacting with os APIs, such read(), return pid, etc. use <code>&lt;sys/types.h&gt;</code></p>
<h1 id="another-types-wars"><a class="header" href="#another-types-wars">another types wars</a></h1>
<ul>
<li><code>uint_least8_t</code> vs <code>uint8_t</code>, imagine, you on very old board, where 8 bit int is not available, this <code>uint_least8_t</code> will be taken as 16 bit int. meanwhile, <code>uint8_t</code> give you exactly 8 bit wide variable.</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="bits-data-models"><a class="header" href="#bits-data-models">bits data models</a></h1>
<p>this section will talk about data models.</p>
<p><img src="sysprog//assets/49ca87fe9c4f571a24bb33cdb4e0345559bca935f4e3e6401897f8516f9f55a23b9f7517138bedb84c4354529e14ac2cc97471c67338f96512458472.png" alt="image" /></p>
<p>that footage, show us what <code>__ILP32__</code> is, also what is ILP32?</p>
<p>There has some nice websites</p>
<ul>
<li><a href="https://duetorun.com/blog/20211008/data-model/#concept">https://duetorun.com/blog/20211008/data-model/#concept</a></li>
<li><a href="https://gcc.gnu.org/onlinedocs/gccint/Effective-Target-Keywords.html#Data-type-sizes">https://gcc.gnu.org/onlinedocs/gccint/Effective-Target-Keywords.html#Data-type-sizes</a></li>
</ul>
<p><img src="sysprog//assets/dd5c48b5d5ce4dad3f26ac9d50a73238005154b08f1951a96eb6cb7e1256f4d63cc44d21f104adb9f47e8f553780f701248b6e183316a3277a3b65df.png" alt="image" /></p>
<p>for example, most linux system uses LP64, which long int, and pointer are 64 bit wide. the other example is ILP32, which used by <code>arm64ilp32</code>, but its deprecated <a href="https://gcc.gnu.org/pipermail/gcc-patches/2025-January/673207.html">https://gcc.gnu.org/pipermail/gcc-patches/2025-January/673207.html</a></p>
<p>LP64 and ILP32 refer to the data model used by the language. "I" is an abbreviation that represents int type, "L" represents long type, and "P" represents the pointer type. 64 and 32 refer to the size of the data types. When the ILP32 option is used, int, long and pointers are 32-bit in size. When LP64 is used, long and pointer are 64-bit in size; int remains 32-bit. The addressing mode used by LP64 is AMODE 64, and by ILP32 is AMODE 31. In the latter case, only 31 bits within the pointer are taken to form the address. For the sake of conciseness, the terms 31-bit mode and ILP32, will be used interchangeably in this document when there is no ambiguity. The same applies to 64-bit mode and LP64. <a href="https://www.ibm.com/docs/en/zos/2.4.0?topic=options-lp64-ilp32#d41843e90">see here</a></p>
<h1 id="common-data-models"><a class="header" href="#common-data-models">Common data models</a></h1>
<div class="table-wrapper"><table><thead><tr><th>Model</th><th><code>int</code></th><th><code>long</code></th><th><code>pointer</code></th><th>Common in</th></tr></thead><tbody>
<tr><td><strong>ILP32</strong></td><td>32-bit</td><td>32-bit</td><td>32-bit</td><td>x86 (32-bit), ARM32, MIPS32</td></tr>
<tr><td><strong>LP64</strong></td><td>32-bit</td><td>64-bit</td><td>64-bit</td><td>x86_64 (Linux, macOS), AArch64</td></tr>
<tr><td><strong>LLP64</strong></td><td>32-bit</td><td>32-bit</td><td>64-bit</td><td>Windows x64 (MSVC), long long is 64 bit</td></tr>
<tr><td><strong>ILP64</strong></td><td>64-bit</td><td>64-bit</td><td>64-bit</td><td>Rare: Cray supercomputers, some HPC</td></tr>
<tr><td><strong>SILP64</strong></td><td>16-bit</td><td>64-bit</td><td>64-bit</td><td>Very rare, some historic systems</td></tr>
<tr><td><strong>LP32</strong></td><td>16-bit</td><td>32-bit</td><td>32-bit</td><td>Some embedded systems</td></tr>
</tbody></table>
</div>
<h1 id="check"><a class="header" href="#check">check</a></h1>
<pre><code class="language-c">#include &lt;stdio.h&gt;

int main() {
    printf("sizeof(int): %zu\n", sizeof(int));
    printf("sizeof(long): %zu\n", sizeof(long));
    printf("sizeof(void *): %zu\n", sizeof(void *));
}
</code></pre>
<p>intresting topics</p>
<ul>
<li>https://www.ibm.com/docs/en/zos/2.4.0?topic=options-lp64-ilp32#d41843e90</li>
<li>LP64 also predefined, see https://gcc.gnu.org/onlinedocs/cpp/Common-Predefined-Macros.html</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="elf-struct-datatype"><a class="header" href="#elf-struct-datatype">ELF struct datatype</a></h1>
<p><img src="sysprog//assets/226c75ba603c0f75c0e287cb7cf1502cd4e7857fd7ceba8ef1d60013d08fd225da41b2432866136e0dfbe0152981a49dc106553e664968dade76f92b.png" alt="image" /></p>
<p>recently, I had confusion about ELF datatype. let's look into elf.h</p>
<p><img src="sysprog//assets/6fd29d1b194c2d80f6924f6326b6876cb023450367b66064c6debcfaffb38c05a83aa30637373852cc25a630d962542c0f47021636c205cf965ad4e6.png" alt="image" /></p>
<p>see it?</p>
<pre><code class="language-c">// 32 bit elf
typedef __u32	Elf32_Word;

// 64 bit elf
typedef __u32	Elf64_Word;
</code></pre>
<p>why word? even in assembly says</p>
<ul>
<li>8 bit -&gt; byte</li>
<li>16 bit -&gt; word</li>
<li>32 bit -&gt; dword</li>
<li>64 -&gt; qword</li>
</ul>
<p>why word (that is 16 bit), its uses u32 instead u16?</p>
<h1 id="answer"><a class="header" href="#answer">answer</a></h1>
<p>the key is portability. lets look at elf64 and elf32</p>
<pre><code class="language-c">typedef __u32	Elf32_Word;
typedef __u32	Elf64_Word;
</code></pre>
<p>keep in mind that word (in ELF) is 32 bit int. so we use this convention</p>
<ul>
<li>half -&gt; unsigned 16 bit</li>
<li>word -&gt; unsigned 32 bit</li>
<li>Xword -&gt; unsigned 64 bit</li>
</ul>
<p>also works for</p>
<ul>
<li>Shalf -&gt; signed 16 bit</li>
<li>Sword -&gt; signed 32 bit</li>
<li>Sxword -&gt; signed 64 bit</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="finding-shstrtab-section"><a class="header" href="#finding-shstrtab-section">finding .shstrtab section</a></h1>
<p>first, we need to look at some struct in order to find shstrtab on ELF file</p>
<p><img src="sysprog//assets/Ai9OqOB.png" alt="gambar" /></p>
<p>this is ELF header</p>
<pre><code class="language-c">typedef struct
{
  unsigned char	e_ident[EI_NIDENT];	/* Magic number and other info */
  Elf64_Half	e_type;			/* Object file type */
  Elf64_Half	e_machine;		/* Architecture */
  Elf64_Word	e_version;		/* Object file version */
  Elf64_Addr	e_entry;		/* Entry point virtual address */
  Elf64_Off	e_phoff;		/* Program header table file offset */
  Elf64_Off	e_shoff;		/* Section header table file offset */
  Elf64_Word	e_flags;		/* Processor-specific flags */
  Elf64_Half	e_ehsize;		/* ELF header size in bytes */
  Elf64_Half	e_phentsize;		/* Program header table entry size */
  Elf64_Half	e_phnum;		/* Program header table entry count */
  Elf64_Half	e_shentsize;		/* Section header table entry size */
  Elf64_Half	e_shnum;		/* Section header table entry count */
  Elf64_Half	e_shstrndx;		/* Section header string table index */
} Elf64_Ehdr;
</code></pre>
<p>this is section header</p>
<pre><code class="language-c">typedef struct
{
  Elf64_Word	sh_name;		/* Section name (string tbl index) */
  Elf64_Word	sh_type;		/* Section type */
  Elf64_Xword	sh_flags;		/* Section flags */
  Elf64_Addr	sh_addr;		/* Section virtual addr at execution */
  Elf64_Off	sh_offset;		/* Section file offset */
  Elf64_Xword	sh_size;		/* Section size in bytes */
  Elf64_Word	sh_link;		/* Link to another section */
  Elf64_Word	sh_info;		/* Additional section information */
  Elf64_Xword	sh_addralign;		/* Section alignment */
  Elf64_Xword	sh_entsize;		/* Entry size if section holds table */
} Elf64_Shdr;
</code></pre>
<h1 id="finding-it"><a class="header" href="#finding-it">finding it</a></h1>
<p>first, we need obtain how much we need to walk, to enter the start of <code>section header</code>, this is can be done by</p>
<p><img src="sysprog//assets/2fc55efb4f13ecf2b520cff13c74658508b6f5b06c2244bf48e46720c40a8f945266fb626d4d7afbb540079996bbd3ff04fe4842f1579ff2d12ccfe8.png" alt="image" /></p>
<p>keep your mind in "Start of section headers"</p>
<h1 id="access-the-array"><a class="header" href="#access-the-array">access the array</a></h1>
<p>because this is just start, so its started on index 0, luckly the ELF header tell me, what index <code>.shstrtab</code> is located, look at "Section header string table index". its 36</p>
<p>in C you may doing</p>
<pre><code class="language-c">Elf64_Shdr data = /* any data */;
dump(data[36]);
</code></pre>
<p>but in binary level, which what you should do is calculating how far away we need to walk from start  to index of 36, which can be done by <code>36 * sizeof(Elf64_Shdr)</code>, in this case, this is same as <code>36 * ehdr-&gt;e_shentsize</code>, then add it with initial offset where Shdr start off.</p>
<p>final formula
<code>ehdr-&gt;e_shoff + (shstrtab_idx * ehdr-&gt;e_shentsize)</code></p>
<h1 id="tests"><a class="header" href="#tests">tests</a></h1>
<p>this is how shdr at index 36 look like (at binary view)</p>
<p><img src="sysprog//assets/b4101386f834b7ee3be61da47e7d3204970dc31288edbd1e6a54551ed23b6818a398e69e5ffa8f9e0906f4401733ce4cdd5249a910ad1754e3016e3c.png" alt="image" /></p>
<p>lets map it into C code for better readibility
<img src="sysprog//assets/c9d50158491b3f0ab8f1a8f5bbdade5d3b74124f3f8d8eb3f3ac18a1bd43307145c0a16434319a073691cbaa436e549dba971708353d737bdc71aeab.png" alt="image" /></p>
<p>we know that, in current section header array, <code>.shstrtab</code> located on 67577 far away from 0, that is location of actual <code>.shstrtab</code>, the Shdr only create a "list of section table, what section in this binary".</p>
<p>also, <code>374</code> is the size, how many memory you need to spend for this a bunch of string.</p>
<p>lets jump to <code>67577</code></p>
<h1 id="xxd-stuff"><a class="header" href="#xxd-stuff">xxd stuff</a></h1>
<p><img src="sysprog//assets/830d5efac23b007e78db56747a4d1898bcaa931e09bf065986f90f21e684271f41152f00a39f53e75be8b4449ed3762a8f0e501be8d1c53768908394.png" alt="image" /></p>
<p>found!</p>
<h1 id="future"><a class="header" href="#future">future</a></h1>
<p>you just need to map <code>Elf64_Shdr</code> on section <code>sh_name</code> which this data. <code>sh_name</code> is a offset how much we walk from 67577 until we found \0</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="print-binary-using-shift-and-masking"><a class="header" href="#print-binary-using-shift-and-masking">print binary using shift and masking</a></h1>
<h2 id="8-bit-int"><a class="header" href="#8-bit-int">8 bit int</a></h2>
<p>lets play with small number first, imagine we want print 200 into binary, which is <code>0b11001000</code>, this is how I do</p>
<h3 id="step-0"><a class="header" href="#step-0">step 0</a></h3>
<p>identify how many bits we need?
say, char has 1 byte, int has 4 byte, long long has 8 byte. just multiply it with 8. you'll get the bit.</p>
<ul>
<li>1 * 8 = 8 bit</li>
<li>4 * 8 = 32 bit</li>
<li>8 * 8 = 64 bit</li>
</ul>
<h3 id="step-1"><a class="header" href="#step-1">step 1</a></h3>
<p>mask, lets see this pattern</p>
<pre><code class="language-txt">0b11001000
0b10000000
---------- &amp;
0b10000000
</code></pre>
<p>see? <code>0b10000000</code>, which is <code>0x80</code>, what about <code>0x8</code>? its <code>0x1000</code>. find that? by shift left the bit, we turn <code>0x8</code> into <code>0x80</code></p>
<p>lets follow this pattern</p>
<ul>
<li>0x8 &lt;&lt; 0  = 0x8 			(4 bit)</li>
<li>0x8 &lt;&lt; 4  = 0x80     		(8 bit) &lt;--- this is mask</li>
<li>0x8 &lt;&lt; 8  = 0x800     	(12 bit)</li>
<li>0x8 &lt;&lt; 12 = 0x8000     	(16 bit) &lt;--- this is mask</li>
<li>0x8 &lt;&lt; 16 = 0x80000  		(20 bit)</li>
</ul>
<p>when I want mask 8 bit int? the mask is 0x80 because its perfectly fit <code>0b10000000</code>, if I want mask 16 bit int? the mask is 0x8000, because its fit <code>0b1000000000000000</code> 16 bit int, can filter the MSB</p>
<p>conlusion:
the mask that we will use, is</p>
<p><code>0x8 &lt;&lt; BIT_SIZE - 4</code></p>
<p>SAY, <code>BIT_SIZE</code> is 8 (eight bit int), 8 - 4 is 4, <code>0x8 &lt;&lt; 4 = 0x80</code>
same thing with</p>
<p>BIT_SIZE is 16, then 16 - 4 = 12, <code>0x8 &lt;&lt; 12 = 0x8000</code></p>
<p>okay, the mask has been clearly explained</p>
<h3 id="step-3-shifting"><a class="header" href="#step-3-shifting">step 3, shifting</a></h3>
<p>say, I have 8 bit int. <code>0b11100011</code>, when I mask it</p>
<h4 id="n--1"><a class="header" href="#n--1">n = 1</a></h4>
<pre><code class="language-txt">0b11100011
0b10000000
---------- &amp;
0b10000000
</code></pre>
<p>lets continue shift to left</p>
<h4 id="n--2"><a class="header" href="#n--2">n = 2</a></h4>
<pre><code class="language-txt">0b11000110
0b10000000
---------- &amp;
0b10000000
</code></pre>
<h4 id="n--3"><a class="header" href="#n--3">n = 3</a></h4>
<pre><code class="language-txt">0b10001100
0b10000000
---------- &amp;
0b10000000
</code></pre>
<h4 id="n--4"><a class="header" href="#n--4">n = 4</a></h4>
<pre><code class="language-txt">0b00011000
0b10000000
---------- &amp;
0b0000000
</code></pre>
<h4 id="n--5"><a class="header" href="#n--5">n = 5</a></h4>
<pre><code class="language-txt">0b00110000
0b10000000
---------- &amp;
0b00000000
</code></pre>
<h4 id="n--6"><a class="header" href="#n--6">n = 6</a></h4>
<pre><code class="language-txt">0b01100000
0b10000000
---------- &amp;
0b00000000
</code></pre>
<h4 id="n--7"><a class="header" href="#n--7">n = 7</a></h4>
<pre><code class="language-txt">0b11000000
0b10000000
---------- &amp;
0b10000000
</code></pre>
<h4 id="n--8"><a class="header" href="#n--8">n = 8</a></h4>
<pre><code class="language-txt">0b10000000
0b10000000
---------- &amp;
0b10000000
</code></pre>
<h3 id="obtaining-result"><a class="header" href="#obtaining-result">obtaining result</a></h3>
<p>lets see this pattern</p>
<p><code>0b10000000 0b10000000 0b10000000 0b0000000 0b00000000 0b00000000 0b10000000 0b10000000</code></p>
<p>if we use if else, to match whatever one byte is same as 0b10000000 or not, we will get result
<code>1110 0011</code></p>
<p>YES, we successfully turn int 8 bit into binary presentation</p>
<h3 id="example-1"><a class="header" href="#example-1">example</a></h3>
<pre><code class="language-c">#include &lt;stddef.h&gt;
#include &lt;stdio.h&gt;

int main() {
        long long x = 3;

        size_t BIT_SIZE = sizeof(x) * 8;
        printf("size: %zu bit\n", BIT_SIZE);

        long long big_mask = (0x8ULL &lt;&lt; (BIT_SIZE - 4));

        int counter = 0;
        for (int i = 0; i &lt; BIT_SIZE; i++) {
                if (i % 4 == 0 &amp;&amp; i != 0) {
                        printf("  ");
                }

                if (i % 16 == 0 &amp;&amp; i != 0) {
                        printf("\n");
                }

                
                long int y = x &amp; big_mask;
                printf("%d ", y == big_mask ? 1 : 0);
                x = x &lt;&lt; 1;
        }
       
}
</code></pre>
<p><img src="sysprog//assets/f4c49ae0150291afc943b1c0d3adb4786a0768a73c6aea239966843d52ce7c036f588724916621a890b4a2a6798ca26bfd7d92e8cb0081f203ea742f.png" alt="image" /></p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="all-about-asan--debug-symbol"><a class="header" href="#all-about-asan--debug-symbol">all about ASan &amp; debug symbol</a></h1>
<h2 id="prerequisites"><a class="header" href="#prerequisites">prerequisites</a></h2>
<p>if you use clang infrastructure</p>
<ul>
<li><a href="https://man.archlinux.org/man/llvm-symbolizer.1.en">llvm-symbolizer</a>: without this, asan offset at debug output will be binary offset, not actual source code. I will demonstrate it</li>
<li>clang</li>
</ul>
<p>if you use GCC</p>
<ul>
<li>addr2line (usually preinstalled)</li>
<li>gcc</li>
</ul>
<p>the tools</p>
<ul>
<li>gdb (optional)</li>
<li><a href="https://github.com/google/sanitizers.git">address sanitizer</a></li>
</ul>
<h2 id="testing"><a class="header" href="#testing">testing</a></h2>
<p>very simple memory buggy program</p>
<pre><code class="language-c">#include &lt;stdlib.h&gt;
#include &lt;stdio.h&gt;

int main() {
        char* data = malloc(1024);
        printf("%s", data);
        return 0;
}
</code></pre>
<p><code>gcc ./leak.c -o leak -g -fsanitize=address</code></p>
<p>here buggy result
<img src="sysprog//assets/08c0c6679e504c218e3ea81a7a77b8113be47f6f1051d4ee8a309e861e279d04f7b62f86d5869c61686070f49d3b2721989b5ba0cd9fa4e97e797002.png" alt="image" /></p>
<p>lets compile it with clang
<code>clang ./leak.c -o leak -g -fsanitize=address</code></p>
<p><img src="sysprog//assets/e7127c07db68b7f553bb1e16e9527a2acd0e61c8e53fd6adda3ea10ff960327a91028e0581ef0b02653e3b75d4e586818af5ae6b3a3c81fbd409adc8.png" alt="image" /></p>
<p>after llvm-symbolizer installed
<img src="sysprog//assets/0a689ab3274a41163d066078f133ed63f1cc7316538b018e94490a106f7b3e8d8395616fb744109e4b91b9f072f9426a0a1e4a0f0a32055106216181.png" alt="image" /></p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="asm-volatile"><a class="header" href="#asm-volatile">asm volatile</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="amd64-endianness"><a class="header" href="#amd64-endianness">amd64 endianness</a></h1>
<p>I'll show you, the little endian (that used in most x86-64 linux systems), let go deeper</p>
<p>I have very simple program, the program</p>
<pre><code class="language-c">#include &lt;stdio.h&gt;

typedef unsigned char byte_ptr;

void show_bytes(byte_ptr *data, size_t n) {
        int i = 0;
        for(; i &lt; n; i++) {
                printf("%p -&gt; %.2x\n",  &amp;data[i], data[i]);
        }

        printf("\n");
}

int main() {
        unsigned long da = 0x5894F93;
        show_bytes((unsigned char*)&amp;da, 8);
}
</code></pre>
<p>as you can see, this is what we write</p>
<pre><code>hexadecimal	: 0x05 0x89 0x4F 0x93
dummy addr  : 0    1    2    3
</code></pre>
<p>the result</p>
<pre><code>0x7fff0fe80d10 -&gt; 93
0x7fff0fe80d11 -&gt; 4f
0x7fff0fe80d12 -&gt; 89
0x7fff0fe80d13 -&gt; 05
0x7fff0fe80d14 -&gt; 00
0x7fff0fe80d15 -&gt; 00
0x7fff0fe80d16 -&gt; 00
0x7fff0fe80d17 -&gt; 00
</code></pre>
<p>wow, it reversed!, because</p>
<pre><code>hexcode      : 0x93 0x4f 0x89 0x05 0x00 0x00 0x00 0x00
dummy addr   : 0    1    2    3    4    5    6    7
               ^~~ MSB                            ^~~ LSB
</code></pre>
<p>(read it first from right, to left, as you read binary code)
WOW, its least endian first, so the machine is <code>little-endian</code></p>
<p>you can also check out my lscpu result
<img src="sysprog//assets/cb27cc742ecc2180a209e7c7e35460caf57e4d3354e8a1c1b0056a66365d64f1f9b419000ab32ea67b58ef467e860f098f4a239813be980dc17e7573.png" alt="image" /></p>
<p><img src="sysprog//assets/b482f061fbd71bb226383393d5343644a6bf830c9c43ac2ac45380889b93986d110b6c192b18208f71e9cfba970939fd8004466e719577e245116607.png" alt="image" /></p>
<h2 id="rust"><a class="header" href="#rust">rust</a></h2>
<p>result
<img src="sysprog//assets/168766015cce02d62b18bb5339cd98f30dd83b729fbece7e291a97bcd758d1bfccc4a96c3d97f772b334d83b09a091c4a495abc30921582e8a95b291.png" alt="image" /></p>
<h1 id="big-endian"><a class="header" href="#big-endian">big endian</a></h1>
<p>because most of machine is little-endian, even RP2040 ARM chip, I'll demontrate it (with some stuff)</p>
<p>first, I'll use miri</p>
<h2 id="miri"><a class="header" href="#miri">miri</a></h2>
<p>this unique tool can emulate big endian
<img src="sysprog//assets/c33299af4f933e3251ee297c402e8474c8786599200d7b8675187d3d3b880b0ece7f37b8d3c5028c577f16e44d80cde36cba17ed83a776c41bd55492.png" alt="image" /></p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="linker---wrap-symbol"><a class="header" href="#linker---wrap-symbol">linker --wrap symbol</a></h1>
<p>konsep wrap linker compiler ini sebenernya berguna ketika kita ingin menimpa suatu fungsi, ke fungsi yang kita map sendiri. contoh misal saya ada</p>
<pre><code class="language-c">printf()
</code></pre>
<p>ketika saya compile dengan gcc, printf akan dipanggil sebagai</p>
<pre><code class="language-c">__wrap_printf()
</code></pre>
<p>nah, dengan trick ini, kita bisa mengubah behavior dari printf nya itu sendiri, misal</p>
<ul>
<li>kirim ke uart</li>
<li>kirim ke swdclk</li>
</ul>
<h1 id="poc"><a class="header" href="#poc">PoC</a></h1>
<pre><code class="language-c">#include &lt;stdlib.h&gt;
#include &lt;stdio.h&gt;

void* __real_malloc(size_t __size) {
        // return malloc(__size);
        printf("do?\n");
}

void* __wrap_malloc(size_t __size) {
        printf("wrap malloc called\n");
        return __real_malloc(__size);
}

int main() {
        char* x = malloc(1);

        // free(x);
}
</code></pre>
<p>lalu compile dengan <code>gcc -Wl,--wrap=malloc wrap_malloc.c -o p -g</code></p>
<p>hasil hexdump main</p>
<pre><code class="language-c">0000000000001180 &lt;main&gt;:
    1180:       55                      push   %rbp
    1181:       48 89 e5                mov    %rsp,%rbp
    1184:       48 83 ec 10             sub    $0x10,%rsp
    1188:       bf 01 00 00 00          mov    $0x1,%edi
    118d:       e8 c5 ff ff ff          call   1157 &lt;__wrap_malloc&gt;
    1192:       48 89 45 f8             mov    %rax,-0x8(%rbp)
    1196:       b8 00 00 00 00          mov    $0x0,%eax
    119b:       c9                      leave
    119c:       c3                      ret
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="rust-stuff"><a class="header" href="#rust-stuff">Rust stuff</a></h1>
<p>Welcome in this rust stuff section.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="rust-cursor-how-it-works"><a class="header" href="#rust-cursor-how-it-works">Rust cursor, How it works</a></h1>
<p>Cursor in rust basically just a in-memory implementation of Seek. <a href="https://en.cppreference.com/w/c/io/fseek">see fseek() here</a></p>
<p>Imagine, we have a file. and this is representation of contents</p>
<pre><code class="language-txt">abcde
</code></pre>
<p>seek start from 1, is <code>bcde</code>, start from 2 is <code>cde</code> and so-on, this is also happen when we use seek from end, for example, seek end -1 is mean <code>e</code>, -2 is <code>de</code>, etc.</p>
<h1 id="from-code-perspective"><a class="header" href="#from-code-perspective">From code perspective</a></h1>
<p>this is signature of cursor</p>
<pre><code class="language-rust">pub struct Cursor&lt;T&gt; {
    inner: T,
    pos: u64,
}</code></pre>
<p>and also, this struct implement <a href="https://doc.rust-lang.org/src/std/io/cursor.rs.html#566">Write</a> and <a href="https://doc.rust-lang.org/src/std/io/cursor.rs.html#289">Seek</a></p>
<p>so, in order to understanding this concept, let code first in C</p>
<pre><code class="language-c">
#include &lt;string.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;stdio.h&gt;

struct seekfd {
    FILE                *file;
};

int start_open(struct seekfd *seekfd) {
    seekfd-&gt;file = fopen("a.txt", "r");

    if (seekfd-&gt;file == NULL) {
        fprintf(stderr, "%s", "error");
        return -1;
    }
}

int do_op(struct seekfd *seekfd) {
    char allocated_buf[2048];
    memset(allocated_buf, 0, 2048);

    fseek(seekfd-&gt;file, 1, SEEK_SET);
    int ret = fread(allocated_buf, 1, 3, seekfd-&gt;file);

    printf("%s", allocated_buf);
}

int main() {
    struct seekfd seekfd;

    int ret = start_open(&amp;seekfd);
    if (ret &lt; 0) {
        return -9;
    }

    ret = do_op(&amp;seekfd);
    if (ret &lt; 0) {
        return ret;
    }
}
</code></pre>
<p>compile with</p>
<pre><code class="language-sh">clang fseek.c -o p -g
</code></pre>
<p>next step, create dummy files named a.txt with content <code>abcdefghijklmnopqr</code></p>
<p>first run with <code>fseek(seekfd-&gt;file, 0, SEEK_SET);</code> = <code>abc</code>
second run with <code>fseek(seekfd-&gt;file, 1, SEEK_SET);</code> = <code>bcd</code>
etc...</p>
<p>this concept is basically same in Rust</p>
<h1 id="rust-context"><a class="header" href="#rust-context">Rust context</a></h1>
<p>this is small example show Seek works (in-memory) instead utilize <em>real</em> file</p>
<pre><code class="language-rust">use std::io::prelude::*;
use std::io::{self, SeekFrom};
use std::io::Cursor;

fn write_bytes&lt;W: Write + Seek&gt;(mut w: W) -&gt; io::Result&lt;()&gt; {
    w.seek(SeekFrom::Start(5))?;
    
    for i in 1..6 {
        w.write(&amp;[i])?;
    }

    Ok(())
}


fn main() {
    let mut buf = Cursor::new(vec![0; 20]);
    write_bytes(&amp;mut buf).unwrap();
    println!("{:?}", &amp;buf.get_ref()); // print vector
}
</code></pre>
<p>this is the output</p>
<pre><code class="language-txt">[0, 0, 0, 0, 0, 1, 2, 3, 4, 5, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]
</code></pre>
<p>instead, we change <code>SeekFrom::Start(5)</code> with <code>SeekFrom::Start(10)</code>, the write will started at offset 10. this is the output</p>
<pre><code class="language-txt">[0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 2, 3, 4, 5, 0, 0, 0, 0, 0]
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="rust-bytes-has_remaining-method"><a class="header" href="#rust-bytes-has_remaining-method">Rust bytes has_remaining() method</a></h1>
<p>this function return whatever any best left on buffer. example, let make simple tcp/ip</p>
<pre><code class="language-rust">impl Connection {
    pub fn new(stream: TcpStream) -&gt; Connection {
        Connection {
            stream: BufWriter::new(stream),
            buffer: BytesMut::with_capacity(4096)
        }

    }

    pub async fn read(&amp;mut self) 
        -&gt; std::result::Result&lt;Option&lt;Frame&gt;, Box&lt;dyn std::error::Error + Send + Sync&gt;&gt; {
        
        let _ = self.stream.read_buf(&amp;mut self.buffer).await;
        println!("hasremaining: {}", self.buffer.has_remaining());
        
        while self.buffer.has_remaining() {
            let bytes = self.buffer.get_u8();
            println!("{} -&gt; {}", bytes as char, self.buffer.has_remaining());
        }

        println!("{}", self.buffer.has_remaining());
        // Frame::check(&amp;mut self.buffer);

        Ok(Some(Frame::Null))
    }
}</code></pre>
<p>let's see the server result using <code>ncat</code></p>
<p><img src="rust/../assets/tcp-ncat-snapshot.png" alt="ncat-result" /></p>
<p>which the input is something look like this</p>
<pre><code class="language-sh">[22:55:41] fadhil_riyanto@integral2 /home/fadhil_riyanto [SIGINT]
&gt; ncat 127.0.0.1 6380
abc

</code></pre>
<p>from this output, we know</p>
<pre><code class="language-txt">hasremaining: true &lt;--- this is initial, didn't mean anything
a -&gt; true &lt;--- a already read, but next char is b, why this is true
b -&gt; true &lt;--- next is c, also true
c -&gt; true &lt;--- next is \n char, also true

 -&gt; false &lt;--- this is false because no next chars
false &lt;--- confirm
</code></pre>
<p>Also, <code>get_u8</code> returns the first byte in the buffer. Each time it's called, it advances the position, so subsequent calls return the next bytes.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="how-rust-into-box--error-analysis"><a class="header" href="#how-rust-into-box--error-analysis">How Rust into() Box + Error analysis</a></h1>
<p>suppose, we have function return signature like this</p>
<pre><code class="language-rust">std::result::Result&lt;Option&lt;Frame&gt;, Box&lt;dyn std::error::Error + Send + Sync&gt;&gt;</code></pre>
<p>and then, we return something like this from our function</p>
<pre><code class="language-rust">return Err("connection reset".into())</code></pre>
<p>how the <code>into()</code> works?</p>
<h1 id="analysis"><a class="header" href="#analysis">analysis</a></h1>
<p>look at <a href="https://github.com/rust-lang/rust/blob/6e830462330a9e34d8176e86d4580dd0820c6fd5/library/alloc/src/boxed/convert.rs#L658">this</a> snippet</p>
<pre><code class="language-rust">#[cfg(not(no_global_oom_handling))]
#[stable(feature = "rust1", since = "1.0.0")]
impl&lt;'a&gt; From&lt;&amp;str&gt; for Box&lt;dyn Error + Send + Sync + 'a&gt; {
    /// Converts a [`str`] into a box of dyn [`Error`] + [`Send`] + [`Sync`].
    ///
    /// [`str`]: prim@str
    ///
    /// # Examples
    ///
    /// ```
    /// use std::error::Error;
    /// use std::mem;
    ///
    /// let a_str_error = "a str error";
    /// let a_boxed_error = Box::&lt;dyn Error + Send + Sync&gt;::from(a_str_error);
    /// assert!(
    ///     mem::size_of::&lt;Box&lt;dyn Error + Send + Sync&gt;&gt;() == mem::size_of_val(&amp;a_boxed_error))
    /// ```
    #[inline]
    fn from(err: &amp;str) -&gt; Box&lt;dyn Error + Send + Sync + 'a&gt; {
        From::from(String::from(err))
    }
}</code></pre>
<p>if we go deeper into <code>From::from</code>, we found <a href="https://github.com/rust-lang/rust/blob/6e830462330a9e34d8176e86d4580dd0820c6fd5/library/alloc/src/boxed/convert.rs#L608">this</a></p>
<pre><code class="language-rust">#[inline]
    fn from(err: String) -&gt; Box&lt;dyn Error + Send + Sync + 'a&gt; {
        struct StringError(String);

        impl Error for StringError {
            #[allow(deprecated)]
            fn description(&amp;self) -&gt; &amp;str {
                &amp;self.0
            }
        }

        impl fmt::Display for StringError {
            fn fmt(&amp;self, f: &amp;mut fmt::Formatter&lt;'_&gt;) -&gt; fmt::Result {
                fmt::Display::fmt(&amp;self.0, f)
            }
        }

        // Purposefully skip printing "StringError(..)"
        impl fmt::Debug for StringError {
            fn fmt(&amp;self, f: &amp;mut fmt::Formatter&lt;'_&gt;) -&gt; fmt::Result {
                fmt::Debug::fmt(&amp;self.0, f)
            }
        }

        Box::new(StringError(err))
    }</code></pre>
<p>nb: actually StringError is string aliases. then, we see in this section. we created a heap-allocated using <code>Box::new(StringError(err))</code>.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="rust-buffer-advance"><a class="header" href="#rust-buffer-advance">Rust buffer advance</a></h1>
<p>this simple article show how buffer advance works</p>
<pre><code class="language-rust">use bytes::Buf;

fn main() {
    let mut buf = &amp;b"hello world"[..];

    println!("{}", String::from_utf8_lossy(buf.chunk()));

    buf.advance(6);
    println!("{}", String::from_utf8_lossy(buf.chunk()));
}
</code></pre>
<p>and the result</p>
<pre><code class="language-rust">hello world
world</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="rust-resp-get_line-analysis"><a class="header" href="#rust-resp-get_line-analysis">Rust RESP get_line analysis</a></h1>
<p>if we look at simple tokio redis example (mini redis), we can see how the data is parsed. look at this</p>
<p>the resp is generally read something like this `+abc\r\n'</p>
<p>this is the code that actually crop down the buffer</p>
<pre><code class="language-rust">fn get_line&lt;'a&gt;(src: &amp;mut Cursor&lt;&amp;'a [u8]&gt;) -&gt; Result&lt;&amp;'a [u8], Error&gt; {
    // Scan the bytes directly
    let start = src.position() as usize;
    // Scan to the second to last byte
    let end = src.get_ref().len() - 1;

    for i in start..end {
        if src.get_ref()[i] == b'\r' &amp;&amp; src.get_ref()[i + 1] == b'\n' {
            // We found a line, update the position to be *after* the \n
            src.set_position((i + 2) as u64);

            // Return the line
            return Ok(&amp;src.get_ref()[start..i]);
        }
    }

    Err(Error::Incomplete)
}</code></pre>
<p>and I will show you how they works (algorithm)</p>
<h1 id="variables-setup"><a class="header" href="#variables-setup">variables setup</a></h1>
<p>we have <code>start</code> and <code>end</code>, which consist of</p>
<pre><code class="language-rust">let start = src.position() as usize;
let end = src.get_ref().len() - 1;</code></pre>
<p>the <code>src.position()</code> always return 0, also depending on the context. <code>src.get_ref().len()</code> return the length of the buffer, for example, <code>+rand\n\n</code> has length 7.</p>
<p>because we wan't to read two chars at the end, which is \r and \n</p>
<p>so we substract length with 1, <em>this is avoid buffer overflow</em></p>
<p>suppose this situation:
buf: <code>+rand\n\n</code></p>
<p>when we add everything with 1, we got this
idx: <code>012345 6 7</code>, it is idx[7]is found? no, so we need to sub with 1, the idx is something like this
idx: <code>012345 6</code>, no overflow</p>
<p>then we check the <code>i</code> and <code>i + 1</code>, make sure there is \r\n</p>
<h1 id="set-position"><a class="header" href="#set-position">set position</a></h1>
<p>now, we set the cursor to the next incoming buffer. which after \r\n</p>
<pre><code class="language-rust">src.set_position((i + 2) as u64);</code></pre>
<p>suppose:</p>
<pre><code>+rand\r\n+randomsomething\r\n
012345 6 ^ 
^^   ^   this is i + 2, indicates next buffer
ii+1 orig i
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="postgresql---get-generic-function-signature"><a class="header" href="#postgresql---get-generic-function-signature">postgresql - get() generic function signature</a></h1>
<p>In someday, i found</p>
<pre><code class="language-rust">#[track_caller]
    pub fn get&lt;'a, I, T&gt;(&amp;'a self, idx: I) -&gt; T
    where
        I: RowIndex + fmt::Display,
        T: FromSql&lt;'a&gt;,
    {
        match self.get_inner(&amp;idx) {
            Ok(ok) =&gt; ok,
            Err(err) =&gt; panic!("error retrieving column {}: {}", idx, err),
        }
    }</code></pre>
<p>some sort of notes:</p>
<ul>
<li>https://doc.rust-lang.org/rust-by-example/generics.html</li>
<li>https://serokell.io/blog/rust-generics</li>
</ul>
<p>how to call it</p>
<pre><code class="language-rust">let data2 = data_actual[0].get::&lt;_, i32&gt;(0);</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="rust-build-logging"><a class="header" href="#rust-build-logging">Rust build logging</a></h1>
<p>rust build usually don't show any output if you try to println!() in build.rs, in order to force this, use</p>
<pre><code class="language-rust">println!("cargo:warning=start build!");</code></pre>
<p>result</p>
<pre><code class="language-txt">warning: ourcrate-rs@0.1.0: Something went wrong!
</code></pre>
<p>all docs: <a href="https://doc.rust-lang.org/cargo/reference/build-scripts.html">https://doc.rust-lang.org/cargo/reference/build-scripts.html</a></p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="rust-tonic-grpc-server-build-process"><a class="header" href="#rust-tonic-grpc-server-build-process">Rust tonic gRPC server build process</a></h1>
<p>topik ini khusus membahas gRPC di rust,</p>
<h2 id="build"><a class="header" href="#build">build</a></h2>
<p>contoh template build rs:</p>
<pre><code class="language-rust">use std::{env, path::PathBuf};

fn main() -&gt; Result&lt;(), Box&lt;dyn std::error::Error&gt;&gt; {
    // let out_dir = PathBuf::from(env::var("OUT_DIR").unwrap());
    let out_dir = PathBuf::from(
        "/home/fadhil_riyanto/BALI64/fadev-service-rs/rpc/src/pb".to_string()
    );

    println!("cargo:warning=start build!");
    
    tonic_build::configure()
        .build_server(true)
        .build_client(false)
        .file_descriptor_set_path(out_dir.join("random_service.bin"))
        .compile_protos(
            &amp;["proto/random_service.proto"], 
            &amp;["proto"]
        )?;


    Ok(())
}
</code></pre>
<p>nb:</p>
<ul>
<li><code>file_descriptor_set_path</code>: dipakai sebagai reflection, bakal ketemu kalau pakai grpcurl.</li>
<li><code>build_server</code> dan <code>build_client</code>: disini ada 2 mode build, untuk server atau untuk client. maka kita set server true, client false</li>
<li><code>compile_protos</code>: masing2 berisi 2 param yg menerima slice, param pertama berisi lokasi protobuf, param kedua berisi root foldernya.</li>
</ul>
<p>anda bisa lihat-lihat contoh lain disini: <a href="https://github.com/hyperium/tonic/tree/master/examples">https://github.com/hyperium/tonic/tree/master/examples</a></p>
<p>optional:</p>
<ul>
<li>use <code>.out_dir()</code> ketimbang harus nurut dengan apa yang OUT_DIR katakan</li>
</ul>
<h2 id="out_dir"><a class="header" href="#out_dir">OUT_DIR</a></h2>
<p>what it is, simplenya <code>OUT_DIR</code> ini akan diset jika protobuf sudah di compile, dalam artian, file <code>*.proto</code> diubah jadi kumpulan file <code>*.rs</code> yang bakal di include sama macro, kemudian di compile</p>
<p>urutan compile adalah, macro dievaluasi dulu, baru compile, sampai sini masuk akal. ini macro signature nya</p>
<pre><code class="language-rust">#[macro_export]
macro_rules! include_proto {
    ($package: tt) =&gt; {
        include!(concat!(env!("OUT_DIR"), concat!("/", $package, ".rs")));
    };
}</code></pre>
<p>tambahan info bisa baca2 sendiri disini: <a href="https://doc.rust-lang.org/cargo/reference/environment-variables.html#environment-variables-cargo-sets-for-build-scripts">https://doc.rust-lang.org/cargo/reference/environment-variables.html#environment-variables-cargo-sets-for-build-scripts</a>, dan jg biasanya ini akan diinclude ke sebuah file handler. kira kira seperti itu</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="rust-tokio-postgres-connection-config-example"><a class="header" href="#rust-tokio-postgres-connection-config-example">Rust tokio-postgres connection config example</a></h1>
<p>first, this is example from the documentation</p>
<pre><code class="language-rust"> let (client, conn_ctx) = tokio_postgres::connect("host=localhost user=postgres", NoTls);</code></pre>
<p>then, we want to convert it into config like ctx. <a href="https://docs.rs/postgres/latest/postgres/config/struct.Config.html">see this</a></p>
<pre><code class="language-rust">use tokio_postgres::{NoTls, Error};

#[tokio::main]
async fn main() {
        let mut config = postgres::config::Config::new();
        config.host("localhost");
        config.user("fadhil_riyanto");
        config.password("1921684338");

        let client_ret = config.connect(NoTls);


}</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="miri-rust-setup"><a class="header" href="#miri-rust-setup">miri rust setup</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="embedtronics"><a class="header" href="#embedtronics">Embedtronics</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="picotool-build"><a class="header" href="#picotool-build">picotool build</a></h1>
<h2 id="os-setup"><a class="header" href="#os-setup">os setup</a></h2>
<pre><code class="language-sh">sudo pacman -S cmake arm-none-eabi-gcc arm-none-eabi-newlib
</code></pre>
<h2 id="setup-picosdk"><a class="header" href="#setup-picosdk">setup picosdk</a></h2>
<pre><code class="language-sh">git clone https://github.com/raspberrypi/pico-sdk.git
cd pico-sdk
git submodule update --init
export PICO_SDK_PATH=$PWD
</code></pre>
<h2 id="build-picotool"><a class="header" href="#build-picotool">build picotool</a></h2>
<pre><code class="language-sh">git clone https://github.com/raspberrypi/picotool.git
cd picotool
mkdir build
cd build
cmake ..
make
</code></pre>
<p>if you get cmake error minimum etc..., use <code>cmake .. -DCMAKE_POLICY_VERSION_MINIMUM=3.5</code> instead</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="debug-pico-with-another-pico"><a class="header" href="#debug-pico-with-another-pico">debug pico with another pico</a></h1>
<p>first, we need a patch this stuff https://review.openocd.org/c/openocd/+/8223/3/src/flash/nor/spi.c#187</p>
<h1 id="optional-dry-run"><a class="header" href="#optional-dry-run">optional dry run</a></h1>
<pre><code class="language-sh">pacman -S mingw-w64-x86_64-toolchain git make libtool pkg-config autoconf automake texinfo mingw-w64-x86_64-libusb
</code></pre>
<p>then run</p>
<pre><code class="language-sh">git clone https://github.com/raspberrypi/openocd.git --branch picoprobe --depth=1
cd openocd
nvim /src/flash/nor/spi.c
</code></pre>
<p>then add patch</p>
<p>after that</p>
<h1 id="build-1"><a class="header" href="#build-1">build</a></h1>
<pre><code class="language-sh">./bootstrap
./configure --enable-picoprobe --disable-werror
make -j4
sudo make install
</code></pre>
<h1 id="flash-elf"><a class="header" href="#flash-elf">flash ELF</a></h1>
<pre><code class="language-sh">sudo openocd -f interface/cmsis-dap.cfg -f target/rp2040.cfg -c "adapter speed 5000" -c "program blink.elf verify reset exit"
</code></pre>
<h1 id="just-debugging"><a class="header" href="#just-debugging">just debugging</a></h1>
<pre><code class="language-sh">sudo openocd -f interface/cmsis-dap.cfg -f target/rp2040.cfg -c "adapter speed 5000"

```sh
arm-none-eabi-gdb blink.elf
&gt; target remote localhost:3333
&gt; monitor reset init
&gt; continue
</code></pre>
<p>wiring position: <img src="embedtronics//assets/ffd3b015a7065c6a5188c94644ad5f017417ed0e7e010f92a6b4baff4e07d2da9be208c33b42527fb4bf2e6bbad3a0fd735c20ce4020101264e9aa77.png" alt="image" /></p>
<p><img src="embedtronics//assets/0470af216a4453ea5bfbded85fd6d523d2eac2fa64d59787e0c17ad13789eac7f54f1dd97bb273e4730c31ec8328f324db69cbb7a13852c789b482d7.png" alt="image" /></p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="pico-sdk-install--cmake-template"><a class="header" href="#pico-sdk-install--cmake-template">PICO SDK install &amp; cmake template</a></h1>
<p>install step is very easy,</p>
<pre><code class="language-sh">git clone https://github.com/raspberrypi/pico-sdk.git
cd pico-sdk
git submodule update --init
</code></pre>
<h1 id="cmake-template"><a class="header" href="#cmake-template">CMAKE Template</a></h1>
<p>this is my own standard of pico rp2040 chip cmake build template</p>
<pre><code class="language-C">cmake_minimum_required(VERSION 3.13)
set(CMAKE_EXPORT_COMPILE_COMMANDS ON)

include(/home/fadhil_riyanto/git_clone/pico-sdk/pico_sdk_init.cmake)

pico_sdk_init()

project(hello_usb C CXX ASM)
set(CMAKE_C_STANDARD 11)
set(CMAKE_CXX_STANDARD 17)


add_executable(hello_usb hello_usb.c)
target_link_libraries(hello_usb pico_stdlib)

# # enable usb output, disable uart output
# pico_enable_stdio_usb(hello_usb 1)
# pico_enable_stdio_uart(hello_usb 0)

pico_add_extra_outputs(hello_usb)
</code></pre>
<p>if you ask about</p>
<blockquote>
<blockquote>
<p>what uses of <code>pico_sdk_init</code>, or <code>pico_enable_stdio_usb</code>, please read it yourself on <a href="https://github.com/raspberrypi/pico-sdk/blob/9a4113fbbae65ee82d8cd6537963bc3d3b14bcca/pico_sdk_init.cmake#L44-L49">https://github.com/raspberrypi/pico-sdk/blob/9a4113fbbae65ee82d8cd6537963bc3d3b14bcca/pico_sdk_init.cmake#L44-L49</a>, thats is a macro!</p>
</blockquote>
</blockquote>
<p>feel free to change <code>include(/home/fadhil_riyanto/git_clone/pico-sdk/pico_sdk_init.cmake)</code> with your own SDK Path</p>
<p><img src="embedtronics//assets/3cd8678ed1023faefda7a4811168e691c0c03b33959a8272ce79f4833dba63016f479fe6da574e7b9dd0cfab422e1c05562aae820819ae717115691c.png" alt="image" /></p>
<p><img src="embedtronics//assets/647a46c8f9f938fa98e322298755afe0249e3cfe64d7ffcddd8626d6a31f07e8cf9f3e1fd131d2ce12001631a942c041f072916f19e416e26f2b1da9.png" alt="image" /></p>
<h1 id="vscode-autocomplete-settings"><a class="header" href="#vscode-autocomplete-settings">vscode autocomplete settings</a></h1>
<p>create file named <code>.vscode/c_cpp_properties.json</code></p>
<p>fill with</p>
<pre><code class="language-json">{
  "configurations": [
    {
      "name": "Linux",
      "compileCommands": "${workspaceFolder}/build/compile_commands.json",
      "intelliSenseMode": "linux-gcc-x64",
      "compilerPath": "/usr/bin/g++",
      "cStandard": "c11",
      "cppStandard": "c++17"
    }
  ],
  "version": 4
}

</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="arm-none-eabi-gdb-debugging-with-openocd"><a class="header" href="#arm-none-eabi-gdb-debugging-with-openocd">arm-none-eabi-gdb debugging with openocd</a></h1>
<p>the simplest thing to debug your RP2040 chip is using secondary pico as picoprobe, then running openocd.
I assume you're was ready with your pico debugprobe</p>
<h1 id="identify-your-tty"><a class="header" href="#identify-your-tty">identify your TTY</a></h1>
<p>check with <code>sudo dmesg</code>, the run a command like this <code>sudo chmod 666 /dev/ttyACM0</code></p>
<h1 id="openocd"><a class="header" href="#openocd">openocd</a></h1>
<pre><code class="language-sh">openocd -f interface/cmsis-dap.cfg -f target/rp2040.cfg -c "adapter speed 5000"
</code></pre>
<h1 id="cmake"><a class="header" href="#cmake">cmake</a></h1>
<p>make sure your ELF was build with <code>cmake -DCMAKE_BUILD_TYPE=Debug -DPICO_BOARD=pico ..</code></p>
<h1 id="flashing"><a class="header" href="#flashing">flashing</a></h1>
<pre><code class="language-sh">openocd -f interface/cmsis-dap.cfg -f target/rp2040.cfg -c "adapter speed 5000" -c "program hello_usb.elf verify reset exit"
</code></pre>
<p>without sudo</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="analysis-how-printf-rp2040-work-under-low-level-stuff"><a class="header" href="#analysis-how-printf-rp2040-work-under-low-level-stuff">analysis how printf rp2040 work under low level stuff</a></h1>
<p>in order to know how printf works in rp2040 uart bridge, lets compile simple program, compile as debug, then run GDB</p>
<p>consider this very simple hello world</p>
<pre><code class="language-c">#include &lt;pico/printf.h&gt;
#include &lt;pico/time.h&gt;

int main() {
    int n = 0;
    stdio_init_all();
    while (true) {
        printf("Hello, world! %d\n", n);
        sleep_ms(1000);
        n = n + 1;
    }
}
</code></pre>
<h1 id="analysis-1"><a class="header" href="#analysis-1">analysis</a></h1>
<p><img src="embedtronics//assets/c9a172f5c6ce190e648f88df4af894d4d115b23d2128cad758833395f62d3f5e5d2ef9cb3dc4d695806f538fa26510bf6bc0da2b995b7fceeaff4899.png" alt="image" /></p>
<p>see?</p>
<pre><code class="language-c">=&gt; 0x100002b4 &lt;+12&gt;:    bl      0x10003a64 &lt;__wrap_printf&gt;
</code></pre>
<p>its call <code>__wrap_printf</code> which mean, the backend call <code>-Wl,--wrap=printf</code> internally, but if we reffer to <code>/home/fadhil_riyanto/git_clone/pico-sdk/src/rp2_common/pico_stdio/stdio.c:347</code></p>
<p><img src="embedtronics//assets/44f66f5c4e0c51a2c0b4bc3885079beb5de306725363b91ba2a38898bf59d0e76fe467ec3abf98eb4881aaf0ce408cf5ebd19b28747ef3720bb99107.png" alt="image" /></p>
<p>the signature is different, this function has signature</p>
<pre><code class="language-c">int __printflike(1, 0) PRIMARY_STDIO_FUNC(printf)(const char* format, ...)
</code></pre>
<p>so, what exactly happen?</p>
<h1 id="result"><a class="header" href="#result">result</a></h1>
<p>lets look at stdio.c line 289</p>
<p><img src="embedtronics//assets/a00ffec057742b32cb76c8db0d3da75c299ceba49a218edf9d559fb31eb9ae029da9b798e2d255ca0af5754dcd7ac62929645ad3aa63155c62bf61a8.png" alt="image" /></p>
<p>when the macro <code>PICO_STDIO_SHORT_CIRCUIT_CLIB_FUNCS</code> is active, we replace the function name by <code>WRAPPER_FUNC(x)</code>, not <code>stdio_printf</code></p>
<p>after that, lets jump into <a href="https://github.com/raspberrypi/pico-sdk/blob/9a4113fbbae65ee82d8cd6537963bc3d3b14bcca/src/rp2_common/pico_platform_compiler/include/pico/platform/compiler.h#L185">https://github.com/raspberrypi/pico-sdk/blob/9a4113fbbae65ee82d8cd6537963bc3d3b14bcca/src/rp2_common/pico_platform_compiler/include/pico/platform/compiler.h#L185</a>, very clear definition</p>
<p>so, basically. this function
<img src="embedtronics//assets/b0dbbe24380b5411221dbffcf2cb8409180135d704b9ede610a1e8f3e032a9ce6071551b9c2628a7d85fec6dcb88aa3f8b529d15999cdf75570fdab8.png" alt="image" /></p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="math"><a class="header" href="#math">Math</a></h1>
<p>Welcome in this section.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="set-operations-formula"><a class="header" href="#set-operations-formula">Set operations formula</a></h1>
<h3 id="union-of-two-sets-cardinality"><a class="header" href="#union-of-two-sets-cardinality">Union of Two Sets (cardinality)</a></h3>
<p>\[
|A \cup B| = |A| + |B| - |A \cap B|
\]</p>
<p>how to read:
whole <code>A</code> and <code>B</code> add together, its make a data duplication on center of venn diagram, we remove that duplication using \( |A \cap B|  \)</p>
<h3 id="intersection-steps"><a class="header" href="#intersection-steps">Intersection (steps)</a></h3>
<p>its flip of Union
\[ |A \cup B| = |A| + |B| - |A \cap B| \]
\[ |A \cap B| = |A| + |B| - |A \cup B| \]</p>
<h3 id="intersection-of-three-sets"><a class="header" href="#intersection-of-three-sets">Intersection of three sets</a></h3>
<p>\[ |A \cup B \cup C| = |A| + |B| + |C| - |A \cap B| - |A \cap C| - |B \cap C| + |A \cap B \cap C| \]</p>
<p>how it works, de remove data duplication two times on \( |A \cap B| \), \( |B \cap C| \), and \( |B \cap C| \), then fill the empty section on the center which \( |A \cap B \cap C| \)</p>
<p>This is proof of concept by nice guy on internet: <a href="https://www.youtube.com/watch?v=vVZwe3TCJT8">https://www.youtube.com/watch?v=vVZwe3TCJT8</a>.</p>
<h3 id="difference"><a class="header" href="#difference">Difference</a></h3>
<p>\[ |A - B| = |A| - |A \cup B| \]</p>
<h3 id="symetric-difference"><a class="header" href="#symetric-difference">Symetric difference</a></h3>
<h4 id="1-general-formula"><a class="header" href="#1-general-formula">1. General formula</a></h4>
<p>\[
A \space \triangle \space B = (A \cup B) - (A \cap B)
\]
Cardinals version:
\[
| A \space \triangle \space B | = |A - B| + |B - A|
\]
\[
| A \space \triangle \space B | = |A| + |B| - 2|A \cap B|
\]</p>
<h4 id="2-symetric-difference-properties"><a class="header" href="#2-symetric-difference-properties">2. Symetric difference properties</a></h4>
<ul>
<li>
<p>\(
A \space \triangle \space B  =  B \space \triangle \space A
\)</p>
</li>
<li>
<p>\(
(A \space \triangle \space B) \space \triangle C  =  A \space \triangle \space (B \space \triangle C)
\)</p>
</li>
<li>
<p>\(
(A \space \triangle \space \emptyset) =  A
\), why?</p>
<ul>
<li>\(A \space \triangle \space B = (A \cup B) - (B \cap A) \)</li>
<li>\(A \space \triangle \space \emptyset = (A \cup \emptyset) - (\emptyset \cap A) \), but</li>
<li>\( (A \cup \emptyset) = A \) and \( (\emptyset \cap A) = \emptyset \)</li>
<li>\( (A - \emptyset) = A \)</li>
</ul>
</li>
<li>
<p>\(
(A \space \triangle \space A) =  \emptyset
\)</p>
</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="set-stuff"><a class="header" href="#set-stuff">Set stuff</a></h1>
<p>there is some intresting question about discrete math</p>
<h2 id="why--mathcalpemptyset--lbrace-emptyset-rbrace-"><a class="header" href="#why--mathcalpemptyset--lbrace-emptyset-rbrace-">why \( \mathcal{P}(\emptyset) = \lbrace \emptyset \rbrace \)</a></h2>
<p>consider \( \mathcal(S) \) where \( S \) is a set, for example</p>
<ul>
<li>if \( S = \lbrace a \rbrace \), then \( \mathcal{P}(S) = \lbrace \emptyset, \lbrace a \rbrace \rbrace \), same as \( \mathcal{P}(a) \)</li>
<li>if \( S = \lbrace a, b \rbrace \), then \(
\mathcal{P}(S) = \lbrace
\emptyset,
\lbrace a \rbrace,
\lbrace b \rbrace,
\lbrace a, b \rbrace
\rbrace \), same as \( \mathcal{P}(a, b) \)</li>
<li>if \( S = \lbrace \emptyset \rbrace \), then \( \mathcal{P}(S) = \lbrace \emptyset, \lbrace \emptyset \rbrace \rbrace \), same as \( \mathcal{P}(\emptyset) \)</li>
</ul>
<p>so, because \( \lbrace \rbrace \) usually hidden, \( \mathcal{P}(\emptyset) = \lbrace \emptyset \rbrace \)</p>
<h2 id="let--a--emptyset-b--emptyset--how-to--a-times-b-"><a class="header" href="#let--a--emptyset-b--emptyset--how-to--a-times-b-">let \( A = \emptyset, B = \emptyset \), how to \( A \times B \)</a></h2>
<p>Consider \( A \times B = \lbrace (a,b) | a \in A, b \in B \rbrace \)</p>
<p>because</p>
<ul>
<li>A is empty, no elements can be paired</li>
<li>B is also empty</li>
</ul>
<p>conlusion: no paired element = empty</p>
<p>proof by cardinality
\(
|A| = 0, |B| = 0, \text{so, when } |A \times B| = |A| \times |B| = 0 \times 0 = 0
\)</p>
<h2 id="does--pemptyset--lbrace-lbrace-rbrace-rbrace--lbrace-emptyset-rbrace--"><a class="header" href="#does--pemptyset--lbrace-lbrace-rbrace-rbrace--lbrace-emptyset-rbrace--">does \( P(\emptyset) = \lbrace \lbrace \rbrace \rbrace = \lbrace \emptyset \rbrace \) ?</a></h2>
<p>true, this is due \( \lbrace \emptyset \rbrace \) same as \( \lbrace \lbrace \rbrace \rbrace \), then consider example
\( P(a) = \lbrace \lbrace \rbrace, \lbrace a \rbrace\rbrace \)</p>
<h2 id="suppose-x-and-z-are-independent-of-each-other"><a class="header" href="#suppose-x-and-z-are-independent-of-each-other">Suppose X and Z are independent of each other</a></h2>
<ul>
<li>\( | \mathcal{P}(X \cap Z)| \)</li>
<li>\( | X - Z | \)</li>
<li>\( | X \oplus Z | \)</li>
<li>\( | X \cap Z | \)</li>
<li>\( | \mathcal{P}(X) \cup \mathcal{P}(Z)| \)</li>
<li>\( | \overline{\mathcal{P}(X) \cup \mathcal{P}(Z)}| \)</li>
</ul>
<p>nb: bagian ini belum jadi</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="logika"><a class="header" href="#logika">Logika</a></h1>
<p>Ringkasan ini dibuat sebagian sebagian dari Kuliah IF1220 Matematika Diskrit ITB oleh bapak Rinaldi Munir. dan berbagai sumber seperti Wikipedia, ChatGPT dsb</p>
<h2 id="proposisi"><a class="header" href="#proposisi">Proposisi</a></h2>
<p>adalah pernyataan bahwa suatu dua perbandingan adalah sama besar, contoh</p>
<ul>
<li>\( \frac{a}{b}=\frac{c}{d} \)</li>
<li>\( 4 = 2 * 2 \)</li>
<li>13 adalah bilangan ganjil</li>
<li>Untuk sembarang bilangan bulat \( n &gt;= 0 \), maka \( 2n \) adalah genap</li>
</ul>
<p>contoh yang bukan</p>
<ul>
<li>Isilah gelas tersebut dengan air</li>
<li>\( x + 3 = 8 \)</li>
<li>\( x &gt; 3 \)</li>
</ul>
<p>dan, Proposisi dilambangkan dengan huruf kecil seperti \( p, q, r, ... \)</p>
<h2 id="bentuk-bentuk-nya"><a class="header" href="#bentuk-bentuk-nya">Bentuk bentuk nya</a></h2>
<ul>
<li>Proposisi atomik
bentuk proposisi tunggal, contoh
<ul>
<li>2n selalu genap untuk n=0, 1, 2, …</li>
<li>Ibukota Maluku Utara adalah Ternate</li>
</ul>
</li>
<li>proposisi majemuk
diantaranya:
<ul>
<li>conjunction (and): \( \wedge \)</li>
<li>disjunction (or): \( \vee \)</li>
<li>negation (!n): \( ~ \)</li>
<li>exclusive disjunction (xor): \( \oplus \)</li>
</ul>
</li>
</ul>
<h2 id="table"><a class="header" href="#table">Table</a></h2>
<table border="1" cellspacing="0" cellpadding="5">
  <tr>
    <th>p</th>
    <th>q</th>
    <th>r</th>
    <th>p ∧ q</th>
    <th>¬q</th>
    <th>¬q ∧ r</th>
    <th>(p ∧ q) ∨ (¬q ∧ r)</th>
  </tr>
  <tr>
    <td>T</td>
    <td>T</td>
    <td>T</td>
    <td>T</td>
    <td>F</td>
    <td>F</td>
    <td>T</td>
  </tr>
  <tr>
    <td>T</td>
    <td>T</td>
    <td>F</td>
    <td>T</td>
    <td>F</td>
    <td>F</td>
    <td>T</td>
  </tr>
  <tr>
    <td>T</td>
    <td>F</td>
    <td>T</td>
    <td>F</td>
    <td>T</td>
    <td>T</td>
    <td>T</td>
  </tr>
  <tr>
    <td>T</td>
    <td>F</td>
    <td>F</td>
    <td>F</td>
    <td>T</td>
    <td>F</td>
    <td>F</td>
  </tr>
  <tr>
    <td>F</td>
    <td>T</td>
    <td>T</td>
    <td>F</td>
    <td>F</td>
    <td>F</td>
    <td>F</td>
  </tr>
  <tr>
    <td>F</td>
    <td>T</td>
    <td>F</td>
    <td>F</td>
    <td>F</td>
    <td>F</td>
    <td>F</td>
  </tr>
  <tr>
    <td>F</td>
    <td>F</td>
    <td>T</td>
    <td>F</td>
    <td>T</td>
    <td>T</td>
    <td>T</td>
  </tr>
  <tr>
    <td>F</td>
    <td>F</td>
    <td>F</td>
    <td>F</td>
    <td>T</td>
    <td>F</td>
    <td>F</td>
  </tr>
</table>
<p>nb:</p>
<ul>
<li>Tautologi adalah pernyataan logika yang selalu benar, tidak peduli nilai kebenaran dari komponen-komponennya. contoh</li>
</ul>
<table border="1" cellspacing="0" cellpadding="5">
  <tr>
    <th>p</th>
    <th>q</th>
    <th>p ∧ q</th>
    <th>¬(p ∧ q)</th>
    <th>p ∨ ¬(p ∧ q)</th>
  </tr>
  <tr>
    <td>T</td><td>T</td><td>T</td><td>F</td><td><span style="color:red;">T</span></td>
  </tr>
  <tr>
    <td>T</td><td>F</td><td>F</td><td>T</td><td><span style="color:red;">T</span></td>
  </tr>
  <tr>
    <td>F</td><td>T</td><td>F</td><td>T</td><td><span style="color:red;">T</span></td>
  </tr>
  <tr>
    <td>F</td><td>F</td><td>F</td><td>T</td><td><span style="color:red;">T</span></td>
  </tr>
</table>
<ul>
<li>Kontradiksi adalah pernyataan logika yang selalu salah, tidak peduli nilai kebenaran dari komponen-komponennya. contoh</li>
</ul>
<table border="1" cellspacing="0" cellpadding="5">
  <tr>
    <th>p</th>
    <th>q</th>
    <th>p ∧ q</th>
    <th>p ∨ q</th>
    <th>¬(p ∨ q)</th>
    <th>(p ∧ q) ∧ ¬(p ∨ q)</th>
  </tr>
  <tr>
    <td>T</td><td>T</td><td>T</td><td>T</td><td>F</td><td><span style="color:red;">F</span></td>
  </tr>
  <tr>
    <td>T</td><td>F</td><td>F</td><td>T</td><td>F</td><td><span style="color:red;">F</span></td>
  </tr>
  <tr>
    <td>F</td><td>T</td><td>F</td><td>T</td><td>F</td><td><span style="color:red;">F</span></td>
  </tr>
  <tr>
    <td>F</td><td>F</td><td>F</td><td>F</td><td>T</td><td><span style="color:red;">F</span></td>
  </tr>
</table>
- ekivalen
Intinya, jika dioperasikan, dia punya hasil tabel kebenaran yang identik, walau rumusnya beda.
<p><img src="https://upload.wikimedia.org/wikipedia/commons/8/83/In_Quest_of_Univeral_Logic_Morgan.png" alt="gambar wikipedia hukum de morgan" /></p>
<table border="1" cellspacing="0" cellpadding="5">
  <tr>
    <th>p</th>
    <th>q</th>
    <th>p ∧ q</th>
    <th>¬(p ∧ q)</th>
    <th>¬p</th>
    <th>¬q</th>
    <th>¬p ∨ ¬q</th>
  </tr>
  <tr>
    <td>T</td><td>T</td><td>T</td><td><span style="color:red;">F</span></td><td>F</td><td>F</td><td><span style="color:red;">F</span></td>
  </tr>
  <tr>
    <td>T</td><td>F</td><td>F</td><td><span style="color:red;">T</span></td><td>F</td><td>T</td><td><span style="color:red;">T</span></td>
  </tr>
  <tr>
    <td>F</td><td>T</td><td>F</td><td><span style="color:red;">T</span></td><td>T</td><td>F</td><td><span style="color:red;">T</span></td>
  </tr>
  <tr>
    <td>F</td><td>F</td><td>F</td><td><span style="color:red;">T</span></td><td>T</td><td>T</td><td><span style="color:red;">T</span></td>
  </tr>
</table>
<h2 id="hukum-hukum-nya"><a class="header" href="#hukum-hukum-nya">Hukum hukum nya</a></h2>
<div class="table-wrapper"><table><thead><tr><th>Bahasa Indonesia</th><th>Bahasa Inggris</th><th>Contoh</th></tr></thead><tbody>
<tr><td>Hukum Identitas</td><td>Identity Law</td><td><code>p ∧ T ≡ p</code>, <code>p ∨ F ≡ p</code></td></tr>
<tr><td>Hukum Dominasi</td><td>Domination Law</td><td><code>p ∨ T ≡ T</code>, <code>p ∧ F ≡ F</code></td></tr>
<tr><td>Hukum Idempotensi</td><td>Idempotent Law</td><td><code>p ∨ p ≡ p</code>, <code>p ∧ p ≡ p</code></td></tr>
<tr><td>Hukum Negasi</td><td>Negation Law</td><td><code>p ∨ ¬p ≡ T</code>, <code>p ∧ ¬p ≡ F</code></td></tr>
<tr><td>Hukum Komutatif</td><td>Commutative Law</td><td><code>p ∨ q ≡ q ∨ p</code>, <code>p ∧ q ≡ q ∧ p</code></td></tr>
<tr><td>Hukum Asosiatif</td><td>Associative Law</td><td><code>(p ∨ q) ∨ r ≡ p ∨ (q ∨ r)</code></td></tr>
<tr><td>Hukum Distributif</td><td>Distributive Law</td><td><code>p ∨ (q ∧ r) ≡ (p ∨ q) ∧ (p ∨ r)</code></td></tr>
<tr><td>Hukum De Morgan</td><td>De Morgan’s Laws</td><td><code>¬(p ∧ q) ≡ ¬p ∨ ¬q</code>, <code>¬(p ∨ q) ≡ ¬p ∧ ¬q</code></td></tr>
<tr><td>Hukum Involusi</td><td>Double Negation / Involution</td><td><code>¬(¬p) ≡ p</code></td></tr>
<tr><td>Hukum Implikasi</td><td>Implication Law</td><td><code>p → q ≡ ¬p ∨ q</code></td></tr>
<tr><td>Hukum Biimplikasi</td><td>Biconditional Law</td><td><code>p ↔ q ≡ (p → q) ∧ (q → p)</code></td></tr>
</tbody></table>
</div>
<h2 id="implikasi"><a class="header" href="#implikasi">Implikasi</a></h2>
<p>Disebut juga proposisi bersyarat, seperti jika x maka y, notasinya \( p \rightarrow q\). \( p \) nya adalah condition, \( q \) nya adalah conlusion</p>
<div class="table-wrapper"><table><thead><tr><th>p</th><th>q</th><th>p → q</th></tr></thead><tbody>
<tr><td>T</td><td>T</td><td>T</td></tr>
<tr><td>T</td><td>F</td><td>F</td></tr>
<tr><td>F</td><td>T</td><td>T</td></tr>
<tr><td>F</td><td>F</td><td>T</td></tr>
</tbody></table>
</div>
<p>versi versinya jika dijadikan teks</p>
<ul>
<li>Jika p, maka q (if p, then q)</li>
<li>Jika p, q (if p, q)</li>
<li>p mengakibatkan q (p implies q)</li>
<li>q jika p (q if p)</li>
<li>p hanya jika q (p only if q)</li>
<li>p syarat cukup untuk q (p is sufficient condition for q)</li>
<li>q syarat perlu bagi p (q is necessary condition for q)</li>
<li>q bilamana p (q whenever p)</li>
<li>q mengikuti dari p (q follows from p)</li>
</ul>
<h3 id="penjelasan-kenapa--f-rightarrow-f--t-"><a class="header" href="#penjelasan-kenapa--f-rightarrow-f--t-">penjelasan kenapa \( F \rightarrow F = T \)</a></h3>
<pre><code>“If I win the lottery, I’ll buy you a car.”
I didn't win the lottery → (False)

I didn't buy a car → (False)
</code></pre>
<p>dan juga \( P \rightarrow Q \) sebenarnya sama dengan \( \sim{P} \vee Q \)</p>
<h3 id="penjelasan-kenapa--sim-p-rightarrow-q--itu-sama-dengan--p-space-wedge-simq-"><a class="header" href="#penjelasan-kenapa--sim-p-rightarrow-q--itu-sama-dengan--p-space-wedge-simq-">Penjelasan kenapa \( \sim (p \rightarrow q )\) itu sama dengan \( p \space \wedge \sim{q} \)</a></h3>
<p>Kita tahu bahwa \( p \rightarrow q \) itu sebenarnya sama dengan \( \sim{p} \vee p \) , maka steps yang dibutuhkan hanya</p>
<ul>
<li>\( \sim(p \rightarrow q) \)</li>
<li>\( \sim(\sim{p} \vee q) \)</li>
<li>\( p \space \wedge \sim{q} \)</li>
</ul>
<h3 id="tabel-varian-implikasi-proporsi-bersyarat"><a class="header" href="#tabel-varian-implikasi-proporsi-bersyarat">tabel varian implikasi (Proporsi bersyarat)</a></h3>
<ul>
<li>Konvers (kebalikan): \( q \rightarrow p \)</li>
<li>Invers : \( \sim p \rightarrow \sim q \)</li>
<li>Kontraposisi : \( \sim q \rightarrow \sim p \)</li>
</ul>
<div class="table-wrapper"><table><thead><tr><th>p</th><th>q</th><th>¬p</th><th>¬q</th><th>p → q</th><th>q → p</th><th>¬p → ¬q</th><th>¬q → ¬p</th></tr></thead><tbody>
<tr><td>T</td><td>T</td><td>F</td><td>F</td><td>T</td><td>T</td><td>T</td><td>T</td></tr>
<tr><td>T</td><td>F</td><td>F</td><td>T</td><td>F</td><td>T</td><td>T</td><td>F</td></tr>
<tr><td>F</td><td>T</td><td>T</td><td>F</td><td>T</td><td>F</td><td>F</td><td>T</td></tr>
<tr><td>F</td><td>F</td><td>T</td><td>T</td><td>T</td><td>T</td><td>T</td><td>T</td></tr>
</tbody></table>
</div>
<h2 id="bi-impication"><a class="header" href="#bi-impication">Bi-impication</a></h2>
<p>Intinya, operand kanan kiri harus sama, entah sama sama true, atau sama sama false.
notasinya: \( p \leftrightarrow q \)</p>
<p>tabel kebenaran</p>
<div class="table-wrapper"><table><thead><tr><th style="text-align: center">p</th><th style="text-align: center">q</th><th style="text-align: center">p ↔ q</th></tr></thead><tbody>
<tr><td style="text-align: center">T</td><td style="text-align: center">T</td><td style="text-align: center">T</td></tr>
<tr><td style="text-align: center">T</td><td style="text-align: center">F</td><td style="text-align: center">F</td></tr>
<tr><td style="text-align: center">F</td><td style="text-align: center">T</td><td style="text-align: center">F</td></tr>
<tr><td style="text-align: center">F</td><td style="text-align: center">F</td><td style="text-align: center">T</td></tr>
</tbody></table>
</div>
<p>contoh</p>
<div class="table-wrapper"><table><thead><tr><th style="text-align: center">p</th><th style="text-align: center">q</th><th style="text-align: center">p ↔ q</th><th style="text-align: center">p → q</th><th style="text-align: center">q → p</th><th style="text-align: center">(p → q) ∧ (q → p)</th></tr></thead><tbody>
<tr><td style="text-align: center">T</td><td style="text-align: center">T</td><td style="text-align: center">T</td><td style="text-align: center">T</td><td style="text-align: center">T</td><td style="text-align: center">T</td></tr>
<tr><td style="text-align: center">T</td><td style="text-align: center">F</td><td style="text-align: center">F</td><td style="text-align: center">F</td><td style="text-align: center">T</td><td style="text-align: center">F</td></tr>
<tr><td style="text-align: center">F</td><td style="text-align: center">T</td><td style="text-align: center">F</td><td style="text-align: center">T</td><td style="text-align: center">F</td><td style="text-align: center">F</td></tr>
<tr><td style="text-align: center">F</td><td style="text-align: center">F</td><td style="text-align: center">T</td><td style="text-align: center">T</td><td style="text-align: center">T</td><td style="text-align: center">T</td></tr>
</tbody></table>
</div>
<p>analogi simple:</p>
<ul>
<li>
<p><code>Jika suatu bilangan genap, maka habis dibagi 2</code>: \( \text{true} \leftrightarrow \text{true} = \text{true} \)</p>
</li>
<li>
<p><code>Jika suatu bilangan bukan genap, maka tidak akan habis dibagi 2</code>: \( \text{false} \leftrightarrow \text{false} = \text{true} \)</p>
</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="kumpulan-soal-matematika-diskrit"><a class="header" href="#kumpulan-soal-matematika-diskrit">kumpulan soal Matematika Diskrit</a></h1>
<h2 id="no-1"><a class="header" href="#no-1">No. 1</a></h2>
<p>Dalam sebuah survei terhadap 120 orang, diperoleh data sebagai berikut:</p>
<ul>
<li>65 orang suka kopi</li>
<li>70 orang suka teh</li>
<li>50 orang suka cokelat</li>
<li>30 orang suka kopi dan teh</li>
<li>28 orang suka kopi dan cokelat</li>
<li>26 orang suka teh dan cokelat</li>
<li>15 orang suka semua minuman</li>
<li>Semua orang minimal menyukai satu jenis minuman</li>
</ul>
<p>Tentukan:</p>
<ol>
<li>Banyak orang yang hanya suka kopi</li>
<li>Banyak orang yang suka teh dan cokelat, tapi tidak suka kopi</li>
<li>Banyak orang yang suka tepat dua jenis minuman</li>
<li>Banyak orang yang hanya suka satu jenis minuman</li>
</ol>
<h2 id="no-2"><a class="header" href="#no-2">No. 2</a></h2>
<p>Jika diketahui</p>
<ul>
<li>S = {1,2,3 …, 15},</li>
<li>A = { 2,3,5,7},</li>
<li>B = { 1,3,5,7,9},</li>
<li>C = {2,4,6,8}</li>
</ul>
<p>Tentukan :</p>
<ol>
<li>A ∪ B ∪ C</li>
<li>A ∩ C</li>
<li>B - A</li>
<li>(A’ ∩ B) - C</li>
<li>(B - C) ∩ A’</li>
</ol>
<h2 id="no-3"><a class="header" href="#no-3">No. 3</a></h2>
<p>Dalam survei terhadap 80 mahasiswa, diperoleh data:</p>
<ul>
<li>45 mahasiswa suka Matematika</li>
<li>38 mahasiswa suka Fisika</li>
<li>40 mahasiswa suka Kimia</li>
<li>20 mahasiswa suka Matematika dan Fisika</li>
<li>25 mahasiswa suka Fisika dan Kimia</li>
<li>18 mahasiswa suka Matematika dan Kimia</li>
<li>10 mahasiswa suka ketiga mata kuliah</li>
<li>8 mahasiswa tidak suka semua mata kuliah</li>
</ul>
<p>tentukan</p>
<ol>
<li>Banyak mahasiswa yang suka hanya Matematika</li>
<li>Banyak mahasiswa yang suka tepat dua mata kuliah</li>
<li>Banyak mahasiswa yang suka Matematika atau Kimia tapi tidak Fisika</li>
<li>Banyak mahasiswa yang suka hanya satu mata kuliah</li>
</ol>
<div class='warning'>
	Catatan
<pre><code>format latex menyusul
</code></pre>
</div><div style="break-before: page; page-break-before: always;"></div><h1 id="asal-usul-rumus-sudut-vektor"><a class="header" href="#asal-usul-rumus-sudut-vektor">asal usul rumus sudut vektor</a></h1>
<p>awal mula dari rumus entah berantah ini. link untuk oprek rumus: <a href="https://proofwiki.org/wiki/Cosine_Formula_for_Dot_Product">https://proofwiki.org/wiki/Cosine_Formula_for_Dot_Product</a></p>
<p>\[ \vec{A} \cdot \vec{B} =  |\vec{A}| |\vec{B}| cos(\theta) \]</p>
<p>lalu
\[ \frac{\vec{A} \cdot \vec{B}}{|\vec{A}| |\vec{B}|} =   cos(\theta) \]</p>
<p>lalu kita bisa balik, menjadi
\[ cos(\theta) = \frac{\vec{A} \cdot \vec{B}}{|\vec{A}| |\vec{B}|} \]</p>
<p>\[ arccos(\frac{\vec{A} \cdot \vec{B}}{|\vec{A}| |\vec{B}|}) = \theta \]</p>
<p>solved!</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="transformasi-elementer"><a class="header" href="#transformasi-elementer">transformasi elementer</a></h1>
<p>beberapa notasi aneh disini diderive dari PPT kampus.</p>
<ul>
<li>\( H_{ij}A \): Swap baris i dengan baris j</li>
<li>\( H_i^{(k)} \): mengalikan baris i dengan konstanta k</li>
<li>\( H_{ij}^{(k)} \): hitung dulu konstanta k dikali baris j, lalu hasilnya ditambah baris i, simpan jg hasilnya ke baris i</li>
<li>\( H_{i \space \space \space \space \space \space \space j}^{\space \space (k) \space \space \space (z)}(A)_i \): intinya, baris ke i dikalikan dgn k, kalau udah lanjut hitung baris j dikalikan z. setelah itu hasilnya tentusaja simpan ke i hasil itung2 an tadi.</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="matrix-invers"><a class="header" href="#matrix-invers">matrix invers</a></h1>
<p>for 2x2</p>
<p>\[ A^{-1} = \frac{1}{(a \cdot d) - (b \cdot c)} \begin{bmatrix} d &amp; -b &amp; \newline -c &amp; a \end{bmatrix}\]</p>
<p>for 3x3
\[ A^{-1} = \frac{1}{\det A} \text{adj } A \]</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="cryptography"><a class="header" href="#cryptography">Cryptography</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="alur-konek-ke-rpc-server-telegram"><a class="header" href="#alur-konek-ke-rpc-server-telegram">Alur konek ke RPC server telegram</a></h1>
<p>step ini dibuat oleh seseorang dari masa lalu sekitar tahun 2020 yang akunnya telah terhapus, credit kepada Butthx</p>
<p>`originals written in telegram chat, but because I want to preserve it. I write it here</p>
<h2 id="step-1-1"><a class="header" href="#step-1-1">step 1:</a></h2>
<p>Bikin koneksi ke server telegram pakai TCP yang tersedia (disini gwa pakai TCPIntermediate)</p>
<h2 id="step-2"><a class="header" href="#step-2">step 2:</a></h2>
<p>Bikin random nonce dengan value int128</p>
<h2 id="step-3"><a class="header" href="#step-3">step 3:</a></h2>
<p>Kirim bytes dari ReqPqMulti dengan value bytes dari nonce tadi.</p>
<h2 id="step-4"><a class="header" href="#step-4">step 4:</a></h2>
<p>pick salah satu dari beberapa publick fingerprints yang diberikan dari results step3.</p>
<h2 id="step-5"><a class="header" href="#step-5">step 5:</a></h2>
<p>Lakuin faktor bilangan pq yang diberikan dari results step3, dapetin lagi hasil pembagian dari pq tadi dengan hasil faktor, terus urutkan dari yang terkecil. untuk yang kecil di kasih nama p dan yang besar kasih nama g.</p>
<h2 id="step-6"><a class="header" href="#step-6">step 6:</a></h2>
<p>bikin nonce baru (jangan ubah nonce yang lama) dengan value random int256.</p>
<h2 id="step-7"><a class="header" href="#step-7">step 7:</a></h2>
<p>bikin hash (sha1) dari bytes PQInnerData ke telegram: bytes[pq,bytes p,bytes q,nonce,nonce baru,server nonce (dapet dari step3)]</p>
<h2 id="step-8"><a class="header" href="#step-8">step 8:</a></h2>
<p>bikin padding dengan random bytes dengan panjang -(length bytes PQInnerData + length sha1) mod 255</p>
<h2 id="step-9"><a class="header" href="#step-9">step 9:</a></h2>
<p>encrypt bytes[sha,bytes PQInnerData,padding] dengan RSA (pakai publik fingerprints tadi)</p>
<h2 id="step-10"><a class="header" href="#step-10">step 10:</a></h2>
<p>kirim bytes ReqDhParams: bytes[nonce,server nonce, bytes p, bytes q, encrypted data (step9) ,fingerprint]</p>
<h2 id="step-11"><a class="header" href="#step-11">step 11:</a></h2>
<p>bikin temporary aes key: bytes[sha1[bytes nonce baru, bytes server nonce],sha1[bytes server nonce, bytes nonce baru] slice 0 – 12]</p>
<h2 id="step-12"><a class="header" href="#step-12">step 12:</a></h2>
<p>bikin temporary aes initial vector (IV): bytes[sha1[bytes server nonce, bytes nonce baru] slice 12 – end, sha1[bytes nonce baru,bytes nonce baru], bytes[nonce baru] slice 0 – 4 ]</p>
<h2 id="step-13"><a class="header" href="#step-13">step 13:</a></h2>
<p>decrypt encryptedAnswer (dapet dari step 10) menggunakan AES-256-IGE pakai key sama iv tadi.</p>
<h2 id="step-14"><a class="header" href="#step-14">step 14:</a></h2>
<p>parse decrypted answer tadi ke TLSchema/TLObject</p>
<h2 id="step-15"><a class="header" href="#step-15">step 15:</a></h2>
<p>bikin random int(panjang 256 bytes, bukan int256 ygy) kita beri nama b</p>
<h2 id="step-16"><a class="header" href="#step-16">step 16:</a></h2>
<p>dapetin g_b dengan (g ** b) mod dh_prime</p>
<ul>
<li>g, dh_prime → dapet dari step 14</li>
</ul>
<h2 id="step-17"><a class="header" href="#step-17">step 17:</a></h2>
<p>bikin hash sha1 dari bytes[ClientDhInnerData[nonce, server nonce, 0,unsigned big bytes g_b length 256]]</p>
<h2 id="step-18"><a class="header" href="#step-18">step 18:</a></h2>
<p>bikin padding dengan length -(length bytes ClientDhInnerData + length sha1) mod 16</p>
<h2 id="step-19"><a class="header" href="#step-19">step 19:</a></h2>
<p>encrypt bytes[bytes step 17,bytes ClientDhInnerData, padding ] dengan AES-256-IGE, key sama iv masih menggunakan yang step 11.</p>
<h2 id="step-20"><a class="header" href="#step-20">step 20:</a></h2>
<p>kirim bytes[SetClientDhParams[nonce, server nonce, bytes step 19]]</p>
<h2 id="step-21"><a class="header" href="#step-21">step 21:</a></h2>
<p>Bikin auth key dengan big-unsigned-bytes[big-u-int(g_a) ** b mod dhPrime] length 256</p>
<h2 id="step-22"><a class="header" href="#step-22">step 22:</a></h2>
<p>Lakuin security check..</p>
<p>notes:
Untuk format pengiriman bytes:</p>
<pre><code class="language-txt">bytes[sessionId,messageId,length content,content]
karena belum ada authkey, jadi sessionId  = Buffer.alloc(8)
</code></pre>
<p>untuk dapetin real data dari telegram, slice bytes yang di terima dari 20 – end</p>
<p>pengiriman content selalu bentuk bytes, jadi semua parameter jadiin bytes :)</p>
<pre><code class="language-ts">/**
 * tgsnake - Telegram MTProto framework for nodejs.
 * Copyright (C) 2022 butthx &lt;https://github.com/butthx&gt;
 *
 * THIS FILE IS PART OF TGSNAKE
 *
 * tgsnake is a free software : you can redistribute it and/or modify
 * it under the terms of the MIT License as published.
 */

export const DCTest = {
  1: '149.154.175.10',
  2: '149.154.167.40',
  3: '149.154.175.117',
};
export const DCProd = {
  1: '149.154.175.53',
  2: '149.154.167.51',
  3: '149.154.175.100',
  4: '149.154.167.91',
  5: '91.108.56.130',
};
export const DCProdMedia = {
  2: '149.154.167.151',
  4: '149.154.164.250',
};
export const DCTestIPV6 = {
  1: '2001:b28:f23d:f001::e',
  2: '2001:67c:4e8:f002::e',
  3: '2001:b28:f23d:f003::e',
};
export const DCProdIPV6 = {
  1: '2001:b28:f23d:f001::a',
  2: '2001:67c:4e8:f002::a',
  3: '2001:b28:f23d:f003::a',
  4: '2001:67c:4e8:f004::a',
  5: '2001:b28:f23f:f005::a',
};
export const DCProdMediaIPV6 = {
  2: '2001:067c:04e8:f002:0000:0000:0000:000b',
  4: '2001:067c:04e8:f004:0000:0000:0000:000b',
};
export function DataCenter(
  dcId: number,
  testMode: boolean,
  ipv6: boolean,
  media: boolean
): [ip: string, port: number] {
  if (testMode) {
    return [ipv6 ? DCTestIPV6[dcId] : DCTest[dcId], 80];
  } else {
    if (media) {
      return [ipv6 ? DCProdMediaIPV6[dcId] : DCProdMedia[dcId], 443];
    } else {
      return [ipv6 ? DCProdIPV6[dcId] : DCProd[dcId], 443];
    }
  }
}

</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="ca-certificates"><a class="header" href="#ca-certificates">ca-certificates</a></h1>
<p>draft: mengoprek kriptografi dibalik HTTPS &amp; konsep public private key pair dan juga peran CA authority, kenapa mereka harus dimasukkan ke package ???</p>
<p>dan juga kenapa MITM (Man in the Middle) bisa melogging jaringan, ketika certificate telah dipasang. kenapa hanya dengan <code>certificate</code> mitm bisa mendecode data yang lewat.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="pap-chap-eap"><a class="header" href="#pap-chap-eap">PAP, CHAP, EAP</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="server"><a class="header" href="#server">Server</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="cgit-setup"><a class="header" href="#cgit-setup">Cgit setup</a></h1>
<p>Ku mau share pengalaman bikin self hosting git server, pakai cgit, biar engga kalah aja sama git.kernel.org dan kernel.dk wkwk</p>
<p>step satu, include dir nya sites-available spt biasa, contoh config nya
https://gist.github.com/fadhil-riyanto/328f2cc0607eb58b713cdeaa473d08ee, lalu config untuk sites-available nya
https://gist.github.com/fadhil-riyanto/c2e26de30c97600e4ee9342aefbd6ece</p>
<p>nb: install fcgiwrap dulu</p>
<p>lalu edit /etc/cgitrc, contoh config: https://gist.github.com/fadhil-riyanto/4033e6ce59a35568c31dbd5e5a1d29bd</p>
<p>harusnya sampai sini, cgit dah bisa diakses, cuman empty repository aja.</p>
<p>ok, lalu kita ke permission2 nya, pertama2 pakai akun root, tldr</p>
<pre><code class="language-sh">cd /root
mkdir git
cd git
mkdir user1, misal aja mkdir fadhil_riyanto
cd fadhil_riyanto
</code></pre>
<p>clone git apapun disini, misal
<code>git clone https://github.com/fadhil-riyanto/reponame.git --bare</code> (harus pakai bare)</p>
<p>posisi dir ini di <code>/root/git/fadhil-riyanto/reponame.git</code></p>
<p>ok, balik ke parent dir, posisi di /root/git
lakukan <code>chown -R fadhil_riyanto fadhil-riyanto</code>, jika engga nanti error "git submodule update" failed with 'fatal: detected dubious ownership in repository at...' etc...</p>
<p>ok, saatnya push
<code>git remote add cgit fadhil_riyanto@123.123.111.222:/root/git/fadhil-riyanto/reponame.git</code></p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="config-https-nginx"><a class="header" href="#config-https-nginx">config HTTPS nginx</a></h1>
<p>Cara config HTTPS di server pakai certbot (NGINX)</p>
<ul>
<li>apt install certbot python3-certbot-nginx</li>
<li>verify config na pakai nginx -t</li>
<li>generate cert na pakai certbot --nginx -d namasite.com</li>
</ul>
<p>ganti namasite.com dengan embel2 di /etc/nginx/sites-enabled/somefile.conf</p>
<p>didalamnya kan ada server_name, nah diganti dgn itu</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="setup-virtual-network-interface"><a class="header" href="#setup-virtual-network-interface">Setup virtual network interface</a></h1>
<p>cara setup virtual ethernet + assign ip nya</p>
<ul>
<li><code>sudo ip link add veth0 type dummy</code></li>
</ul>
<p>bisa dicek pakai <code>ip addr</code></p>
<pre><code class="language-txt">[11:11:35] fadhil_riyanto@integral2 /etc/systemd/network  
&gt; ip addr
1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
    inet 127.0.0.1/8 scope host lo
       valid_lft forever preferred_lft forever
    inet6 ::1/128 scope host noprefixroute 
       valid_lft forever preferred_lft forever
2: enp2s0: &lt;NO-CARRIER,BROADCAST,MULTICAST,UP&gt; mtu 1500 qdisc fq_codel state DOWN group default qlen 1000
    link/ether 2c:4d:54:c6:f2:0c brd ff:ff:ff:ff:ff:ff
    altname enx2c4d54c6f20c
3: wlan0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP group default qlen 1000
    link/ether f0:03:8c:66:9c:21 brd ff:ff:ff:ff:ff:ff
    inet 192.168.5.44/24 brd 192.168.5.255 scope global dynamic noprefixroute wlan0
       valid_lft 581sec preferred_lft 581sec
    inet 192.168.5.197/24 metric 1024 brd 192.168.5.255 scope global secondary dynamic wlan0
       valid_lft 582sec preferred_lft 582sec
    inet6 fe80::5574:5771:be47:2f7b/64 scope link noprefixroute 
       valid_lft forever preferred_lft forever
    inet6 fe80::f203:8cff:fe66:9c21/64 scope link proto kernel_ll 
       valid_lft forever preferred_lft forever
4: veth0: &lt;BROADCAST,NOARP,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UNKNOWN group default qlen 1000
    link/ether 76:4d:3f:3d:11:7f brd ff:ff:ff:ff:ff:ff
    inet6 fe80::744d:3fff:fe3d:117f/64 scope link proto kernel_ll 
       valid_lft forever preferred_lft forever

</code></pre>
<p>lalu assign ip nya</p>
<ul>
<li><code>sudo ip addr add 192.168.100.10/24 dev veth0</code></li>
<li><code>sudo ip link set veth0 up</code></li>
</ul>
<p>dan bisa diping juga
<img src="server//assets/11bb1cc1160be5425a379843f6c2ccef31b6a80cf13b505d842404bd9e9922d4cda2d7e4f0693c4291743e74c3143e20021494aa95a5d380b1b8e3c8.png" alt="image" /></p>
<p>untuk remove interface nya bisa pakai
<code>sudo ip link delete vnet0</code></p>
<h1 id="some-sorts-of-equalivalent-command"><a class="header" href="#some-sorts-of-equalivalent-command">some sorts of equalivalent command</a></h1>
<ul>
<li>Create bridge: <code>brctl addbr br0</code> <code>ip link add br0 type bridge</code></li>
<li>Delete bridge: <code>brctl delbr br0</code>   ip link delete br0</li>
<li>Add interface to bridge: <code>brctl addif br0 eth0</code> ip link set eth0 master br0</li>
<li>Remove interface from bridge: <code>brctl delif br0 eth0</code> ip link set eth0 nomaster</li>
<li>Show bridge info: <code>brctl show</code> or <code>brctl show br0</code>  <code>bridge link show</code> or <code>ip link show master br0</code></li>
<li>Enable/disable STP: <code>brctl stp br0 on/off</code> <code>bridge link set dev eth0 guard off/on</code> (note: STP enable/disable logic is reversed)</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="ip-aliasing"><a class="header" href="#ip-aliasing">ip aliasing</a></h1>
<p>satu interface bisa punya lebih dari 1 IP dinamai sebagai IP aliasing. contoh</p>
<p><code>eth0</code> bisa punya 2 ip dengan cara</p>
<ul>
<li><code>ip addr add 192.168.1.100/24 dev eth0</code></li>
<li><code>ip addr add 192.168.1.101/24 dev eth0</code></li>
</ul>
<p>atau bisa juga ada 2 interface, katakanlah <code>eth0</code> dengan <code>eth1</code>, masing2 punya ip nya sendiri2 dengan cara</p>
<pre><code class="language-sh">ip addr add 192.168.1.10/24 dev eth0
ip addr add 10.0.0.5/24 dev eth1
</code></pre>
<h1 id="tambahan"><a class="header" href="#tambahan">tambahan</a></h1>
<p>untuk ngeremove salah satu ip nya, bisa dengan <code>ip addr del &lt;IP NYA&gt;/&lt;CIDR&gt; dev &lt;IFACE&gt;</code></p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="setup-bridge-enp0s16u1"><a class="header" href="#setup-bridge-enp0s16u1">Setup bridge enp0s16u1</a></h1>
<ul>
<li>setup dulu bridgenya pakai <code>ip link add br0 type bridge</code></li>
<li>buat enp0s16u1 sebagai master dari br0, pakai <code>ip link set enp0s16u1 master br0</code>
<ul>
<li>catatan, wlan0 tidak bisa di add. <a href="https://bbs.archlinux.org/viewtopic.php?id=264651">https://bbs.archlinux.org/viewtopic.php?id=264651</a>, <a href="https://wiki.archlinux.org/title/Network_bridge#Wireless_interface_on_a_bridge">https://wiki.archlinux.org/title/Network_bridge#Wireless_interface_on_a_bridge</a></li>
</ul>
</li>
<li>lalu enable semua interface nya
<ul>
<li><code>sudo ip link set dev enp0s16u1 up</code></li>
<li><code>sudo ip link set dev br0 up</code></li>
</ul>
</li>
<li>set dhcp <code>sudo dhclient br0</code>
<ul>
<li>nb, ditahap ini, harusnya sudah dapat ip dan bisa ping keluar.</li>
</ul>
</li>
<li>hapus ip bawaan enp0s16u1 dan pakai br0 sebagai default interface pakai <code>sudo ip addr flush dev enp0s16u1</code></li>
</ul>
<p>bisa di test dengan</p>
<ul>
<li>hapus dahulu ip yang tadi diberikan ke br0 pakai <code>sudo dhclient -r br0</code>, pastikan ip nya kosong</li>
<li>lalu hapus ip milik enp0s16u1</li>
<li>test ping</li>
<li>lalu lakukan lagi <code>sudo dhclient br0</code></li>
</ul>
<p><img src="server//assets/1b691564498dc373215573884ca30d7158cea49b44f53d17d2958e9222a4b8222cdfc38a294f0bf4bdfeca36d956e235deb899f3e8ec755f63c0c729.png" alt="image" /></p>
<h1 id="reverse-command"><a class="header" href="#reverse-command">reverse command</a></h1>
<p>Pakai ini untuk in-case ada kesalahan</p>
<h2 id="hapus-ip-br0"><a class="header" href="#hapus-ip-br0">hapus ip br0</a></h2>
<ul>
<li><code>ip addr show br0</code></li>
<li><code>sudo ip addr del 192.168.1.10/24 dev br0</code></li>
</ul>
<p>tambahan, kadang tidak bener2 kehapus karna mungkin NetworkManager, systemd-networkd, dhclient aktif.</p>
<p><img src="server//assets/4de0445fce99e64ac0afd61922742bcf44ea710e3ca4ce1e6f11643aca1002b469648ce176789d7431aa0ff361e570f1eca3c2fa175f401cf0ee121e.png" alt="image" /></p>
<p>nb: untuk dhcp kadang NetworkManager sama systemd-networkd bertabrakan, solusinya stop dahulu pakai</p>
<ul>
<li><code>sudo systemctl stop systemd-networkd.socket</code></li>
<li><code>sudo systemctl stop systemd-networkd</code></li>
</ul>
<h1 id="next-buat-bridge-ke-vm-topologi"><a class="header" href="#next-buat-bridge-ke-vm-topologi">next, buat bridge ke VM. topologi</a></h1>
<pre><code class="language-txt">   [Internet]
       |
     Router
       |
     eth0 (on host) → br0 (bridge)
                      |
    +--------+--------+--------+
    |        |        |        |
  VM1      VM2      VM3      etc.
  ↳ 192.168.12.101   192.168.12.102   ...

</code></pre>
<p>mulai dari sini akan utak atik <code>veth</code></p>
<h1 id="setup-veth-manual"><a class="header" href="#setup-veth-manual">setup veth manual</a></h1>
<ul>
<li><code>sudo ip link add veth0 type veth peer name veth0-peer</code></li>
<li><code>sudo ip link set veth0 master br0</code></li>
<li><code>sudo ip link set veth0 up</code></li>
<li><code>sudo ip link set veth0-peer up</code></li>
<li><code>sudo dhclient veth0-peer</code></li>
</ul>
<p>topologinya kira2 seperti ini</p>
<pre><code class="language-txt">                +---------------------------+
                |        Linux Host         |
                |                           |
                |   +-------------------+   |
                |   |       br0         |   |  ← bridge acting as a virtual switch
                |   +--------+----------+   |
                |            |              |
                |         veth0            ... ← more veths for other containers/VMs
                |            |
                +------------+--------------+
                             |
                             | (virtual cable)
                             |
                         veth0-peer
                             |
                    +------------------+
                    |   Container/VM   |  ← gets its own IP
                    +------------------+

</code></pre>
<h1 id="lanjut-assign-veth-peer-ke-qemu-pakai-tap-device"><a class="header" href="#lanjut-assign-veth-peer-ke-qemu-pakai-tap-device">lanjut assign veth-peer ke qemu (pakai tap device)</a></h1>
<p>topology:</p>
<pre><code class="language-txt">            Linux Host
       +------------------+
       |      br0         |  ← acts as switch
       +--+-----------+---+
          |           |
        eth0         tap0  ← tap device for QEMU VM
                        |
                   QEMU VM

</code></pre>
<p>attach</p>
<pre><code class="language-sh">sudo ip tuntap add dev tap0 mode tap
sudo ip link set tap0 up
sudo ip link set tap0 master br0
</code></pre>
<p>qemu</p>
<pre><code class="language-txt">sudo qemu-system-x86_64 \
  -enable-kvm \
  -m 2048 \
  -hda ubuntu.qcow2 \
  -netdev tap,id=net0,ifname=tap0,script=no,downscript=no \
  -device virtio-net-pci,netdev=net0

</code></pre>
<p>test qemu mikrotik</p>
<pre><code class="language-sh">qemu-system-x86_64 \
                -enable-kvm \
                -boot order=d \
                -drive file=chr.qcow2,format=qcow2 \
                -m 4G \
                -smp 4 \
                -net user,hostfwd=tcp::10022-:22,hostfwd=tcp::8080-:8080 \
                -netdev tap,id=net0,ifname=tap0,script=no,downscript=no \
                -device virtio-net-pci,netdev=net0
</code></pre>
<p>untuk test nya, bisa dengan</p>
<ul>
<li>cek ip mikrotik pakai <code>/ip address print</code></li>
<li>lalu <code> ip netns exec namespace_satu ping &lt;IP NYA&gt;</code></li>
<li>Bisa juga pakai dummy http server php, caranya <code>sudo ip netns exec namespace_satu php -S 192.168.12.82:1234</code> (cek dahulu ip namespace pakai ip addr)</li>
</ul>
<h1 id="contoh-setup-pakai-namespace"><a class="header" href="#contoh-setup-pakai-namespace">contoh setup pakai namespace</a></h1>
<ul>
<li>create dulu pakai <code>sudo ip netns add namespace_satu</code></li>
<li>set <code>sudo ip link set veth0-peer netns namespace_satu</code></li>
<li>cek dahulu, pastikan didalamnnya masih kosong ip nya, pakai <code>sudo ip netns exec namespace_satu ip addr</code>
<img src="server//assets/48984020250811e0f4a6c52d75940e5ba795f025c6ff2d76fbfc4d213bc7593b1555684a602581fa67772570e4708af35395540e36f8ecdf11295255.png" alt="image" /></li>
<li>lalu kita nyalakan veth0-peer nya <code>sudo ip netns exec namespace_satu ip link set dev veth0-peer up</code>, tapi tetap saja masih belum dapat ip. maka next kita exec dhclient pakai <code>sudo ip netns exec namespace_satu dhclient veth0-peer</code>
<img src="server//assets/eef365d5a00b998adf7153b07c0c9f6fee144b5f0c44cae796269b1d3d6ac142cb75939a65b00ea84ec1828783e5d4b2574e62f77cdd8a1a79df87b0.png" alt="image" /></li>
<li>test ping keluar
<img src="server//assets/cb4039e3828cd86cc73a5d980b39aceb4799ce9b4bfe34dc364ac87cd3e3500b12c118cf861de575ed4f86c2e1a98b8d3392bf43575726771234517e.png" alt="image" /></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="setup-shadowsocks-proxy-server"><a class="header" href="#setup-shadowsocks-proxy-server">Setup shadowsocks proxy server</a></h1>
<p>shadowsocks-libev is available in the official repository for Debian 9("Stretch"), unstable, Ubuntu 16.10 and later derivatives:</p>
<pre><code class="language-sh">sudo apt update
sudo apt install shadowsocks-libev
</code></pre>
<p>then, create a file config on <code>/etc/shadowsocks-libev/config.json</code> which has contents something like this</p>
<pre><code class="language-json">{
    "server":["::1", "10.1.1.4"],
    "mode":"tcp_and_udp",
    "server_port":8388,
    "local_port":1080,
    "password":"1u21wW3E0bwu",
    "timeout":86400,
    "method":"chacha20-ietf-poly1305"
}

</code></pre>
<p>in this case, I use <code>10.1.1.4</code> as local ip, then forwarded through firewall to the public addr.</p>
<p>then, <code>sudo systemctl start shadowsocks-libev</code></p>
<p>ref: <a href="https://shadowsocks.org/doc/configs.html">https://shadowsocks.org/doc/configs.html</a></p>
<h1 id="connect"><a class="header" href="#connect">connect</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="alpine-htop-install-on-live-qemu"><a class="header" href="#alpine-htop-install-on-live-qemu">Alpine htop install on live QEMU</a></h1>
<h1 id="create-disk-first"><a class="header" href="#create-disk-first">create disk first</a></h1>
<pre><code class="language-sh">qemu-img create -f qcow2 alpine-1.qcow2 1G
</code></pre>
<h1 id="start-qemu"><a class="header" href="#start-qemu">start qemu</a></h1>
<p>download iso here <a href="https://dl-cdn.alpinelinux.org/alpine/v3.21/releases/x86_64/alpine-virt-3.21.3-x86_64.iso">https://dl-cdn.alpinelinux.org/alpine/v3.21/releases/x86_64/alpine-virt-3.21.3-x86_64.iso</a></p>
<pre><code class="language-sh">qemu-system-x86_64 \
      -enable-kvm \
      -m 256 \
      -smp 4 \
      -cpu host \
      -drive file=pc-1.qcow2,format=qcow2 \
      -cdrom alpine-virt-3.21.3-x86_64.iso \
      -boot d \
      -net nic \
      -net user -nographic
</code></pre>
<p>default username is <code>root</code>, password left blank, just enter</p>
<h1 id="set-eth0-up--dhcp"><a class="header" href="#set-eth0-up--dhcp">set eth0 up &amp; DHCP</a></h1>
<ul>
<li><code>ip link set dev eth0 up</code></li>
<li><code>udhcpc -i eth0</code></li>
<li><code>ping 1.1.1.1</code> (testing)</li>
</ul>
<p>for <code>/etc/resolv.conf</code>, change to <code>nameserver 1.1.1.1</code></p>
<h1 id="patch-apk-configuration"><a class="header" href="#patch-apk-configuration">patch apk configuration</a></h1>
<p><code>cp /etc/apk/repositories /etc/apk/repositories-old</code></p>
<pre><code class="language-patch">--- repositories-old
+++ repositories
@@ -1 +1,2 @@
-/media/cdrom/apks
+http://dl-cdn.alpinelinux.org/alpine/v3.21/main
+http://dl-cdn.alpinelinux.org/alpine/v3.21/community
</code></pre>
<h1 id="update"><a class="header" href="#update">update</a></h1>
<ul>
<li><code>apk update</code></li>
<li><code>apk cache download</code></li>
<li><code>apk cache -v sync</code></li>
</ul>
<h1 id="setup-partition"><a class="header" href="#setup-partition">setup partition</a></h1>
<div class="warning">
Note 
<p>set it with your needs, I use entire disk in this docs</p>
</div>
<p>make sure first your ext4 kernel module is installed &amp; loaded by typing</p>
<ul>
<li><code>lsmod | grep ext4</code>: check</li>
<li><code>modprobe ext4</code></li>
<li><code>lsmod | grep ext4</code>: recheck again</li>
</ul>
<p>the output is should be something like this
<img src="server//assets/37fc640f3957aa8c9cc08ae77ed08afc3ad58b7b1187232994a259776acbdc94fe64e1a8b0cd1cbd834fc51e3f7d9d21cdd850a4fbfd35aa0092ffb9.png" alt="image" /></p>
<p>then we can move forward to ext4 partition generation</p>
<h1 id="partitioning"><a class="header" href="#partitioning">partitioning</a></h1>
<p>install parted first using <code>apk add parted</code>, check your disk first using <code>fdisk -l</code>, for example there is <code>/dev/sda</code></p>
<h2 id="parted-section"><a class="header" href="#parted-section">parted section</a></h2>
<p>run <code>parted /dev/sda</code>, inside of parted is</p>
<ul>
<li><code>unit s</code></li>
<li><code>mklabel [gpt/msdos]</code>: I use msdos anyway</li>
<li><code>print</code>: identify disk size by see on section something like Disk /dev/sda: 2097152s, there has 2097152s sector, so I use 2097152 - (2948 * 2), which is 2093056s</li>
<li><code>mkpart</code>
<ul>
<li><code>primary</code></li>
<li><code>ext4</code></li>
<li><code>2048s</code></li>
<li><code>2093056s</code>
<ul>
<li><code>q</code></li>
</ul>
</li>
</ul>
</li>
</ul>
<p>resulted partition:
<img src="server//assets/2e9d14e41182f8915e615acd0bedb1797c4a5b13411506a142ce9bf33b0874ce1abbc3963190e351a97b67876af6c7613735930d2e1c71140947c98d.png" alt="image" /></p>
<h1 id="setup-diskless-install"><a class="header" href="#setup-diskless-install">setup diskless install</a></h1>
<p>warn: you need to enable ext4 kernel module or you'll get <code>mount: mounting /dev/sda1 on /media/sda1 failed: Invalid argument</code> when mounting</p>
<ul>
<li><code>modprobe ext4</code></li>
<li><code>apk add e2fsprogs</code> for <code>mkfs.ext4</code> command</li>
<li><code>mkfs.ext4 /dev/sda1</code></li>
<li><code>mount /dev/sda1 /media/sda1</code>: mount location should be located on <code>/media</code>, not <code>/mnt</code></li>
</ul>
<p>then, you can do normal <code>setup-alpine</code>, except for this thing</p>
<ul>
<li>Which disk(s) would you like to use? (or '?' for help or 'none') [none] none</li>
<li>Enter where to store configs ('floppy', 'sda1', 'usb' or 'none') [sda1] sda1</li>
<li>Enter apk cache directory (or '?' or 'none') [/media/sda1/cache] /media/sda1/cache</li>
</ul>
<h1 id="lbu"><a class="header" href="#lbu">LBU</a></h1>
<p>run <code>lbu commit</code></p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="run-router-os-on-qemu"><a class="header" href="#run-router-os-on-qemu">Run router-OS on qemu</a></h1>
<p>on normal interface</p>
<pre><code class="language-sh">qemu-system-x86_64 \
          -enable-kvm \
          -boot order=d \
          -cdrom chr-6.49.18.img \
          -drive file=chr.qcow2,format=qcow2 \
          -m 4G \
          -smp 4 \
          -net user,hostfwd=tcp::10022-:22,hostfwd=tcp::8291-:8291 \
          -net nic
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="setup-linux-bridge-between-routeros--alpine-linux-hosts"><a class="header" href="#setup-linux-bridge-between-routeros--alpine-linux-hosts">setup linux bridge between RouterOS &amp; Alpine linux hosts</a></h1>
<p>this docs is second part of <a href="http://localhost:3000/server/alpine_install_on_live_cd_qemu.html">this</a></p>
<p>first thing that we need to do is create a copy of qcow2 alpine, so we do not need to re-install again. do not forget to change the hostname &amp; password for easy identification</p>
<h1 id="setup-bridge"><a class="header" href="#setup-bridge">setup bridge</a></h1>
<ul>
<li><code>sudo ip link add br0-lan type bridge</code></li>
<li><code>sudo ip link add br1-lan type bridge</code></li>
</ul>
<h1 id="setup-tap"><a class="header" href="#setup-tap">setup TAP</a></h1>
<p>tap0 &amp; tap1 connected to br0-lan
tap2 &amp; tap3 connected to br1-lan</p>
<ul>
<li><code>sudo ip tuntap add dev tap0 mode tap</code></li>
<li><code>sudo ip tuntap add dev tap1 mode tap</code></li>
<li><code>sudo ip tuntap add dev tap2 mode tap</code></li>
<li><code>sudo ip tuntap add dev tap3 mode tap</code></li>
<li><code>sudo ip link set tap0 master br0-lan</code></li>
<li><code>sudo ip link set tap1 master br0-lan</code></li>
<li><code>sudo ip link set tap2 master br1-lan</code></li>
<li><code>sudo ip link set tap3 master br1-lan</code></li>
<li><code>sudo ip link set tap0 up</code></li>
<li><code>sudo ip link set tap1 up</code></li>
<li><code>sudo ip link set tap2 up</code></li>
<li><code>sudo ip link set tap3 up</code></li>
</ul>
<h1 id="launch-mikrotik-iso"><a class="header" href="#launch-mikrotik-iso">launch mikrotik ISO</a></h1>
<pre><code class="language-sh">qemu-system-x86_64 \
      -enable-kvm \
      -boot order=d \
      -drive file=chr.qcow2,format=qcow2 \
      -m 256M \
      -smp 4 \
      -netdev tap,id=net0,ifname=tap0,script=no,downscript=no \
      -device virtio-net-pci,netdev=net0,mac=02:11:2a:3b:ff:c3  \
      -netdev tap,id=net1,ifname=tap2,script=no,downscript=no \
      -device virtio-net-pci,netdev=net1,mac=02:1a:f2:f1:21:b5  \
      -nographic \
      -net user,hostfwd=tcp::10022-:22,hostfwd=tcp::8291-:8291 \
      -net nic
</code></pre>
<p><img src="server//assets/74d589bde385dccca9047d3167ed42def74f535f82c92cbf66599c40b835c624eaf8de74ef1787a86df7886b00194fdaef8e290afbef0021128ef4a1.png" alt="image" /></p>
<p>based on topology, we know that</p>
<ul>
<li><code>02:11:2a:3b:ff:c3</code> used by tap0 (in routerOS, bridge 0)</li>
<li><code>02:1a:f2:f1:21:b5</code> used by tap2 (in routerOS, bridge 1)</li>
<li><code>tap1</code> &amp; <code>tap3</code> used by alpine virtual machine</li>
</ul>
<p>now run alpine iso</p>
<h1 id="alpine-as-pc-1"><a class="header" href="#alpine-as-pc-1">alpine (as pc-1)</a></h1>
<pre><code class="language-sh">qemu-system-x86_64 \
            -enable-kvm \
            -m 256 \
            -smp 4 \
            -cpu host \
            -drive file=pc-1.qcow2,format=qcow2 \
            -cdrom alpine-virt-3.21.3-x86_64.iso \
            -boot d \
            -nographic \
            -netdev tap,id=net0,ifname=tap1,script=no,downscript=no \
            -device virtio-net-pci,netdev=net0
</code></pre>
<h1 id="alpine-as-pc-3"><a class="header" href="#alpine-as-pc-3">alpine (as pc-3)</a></h1>
<pre><code class="language-sh">qemu-system-x86_64 \
            -enable-kvm \
            -m 256 \
            -smp 4 \
            -cpu host \
            -drive file=pc-2.qcow2,format=qcow2 \
            -cdrom alpine-virt-3.21.3-x86_64.iso \
            -boot d \
            -nographic \
            -netdev tap,id=net0,ifname=tap3,script=no,downscript=no \
            -device virtio-net-pci,netdev=net0
</code></pre>
<h1 id="winbox-config"><a class="header" href="#winbox-config">WinBox config</a></h1>
<p>first, we need to see the configuration &amp; which etherX by looking to spesific mac-addr, we find out that</p>
<pre><code class="language-txt">[admin@MikroTik] &gt; /interface print
Flags: D - dynamic, X - disabled, R - running, S - slave 
 #     NAME                                TYPE       ACTUAL-MTU L2MTU  MAX-L2MTU MAC-ADDRESS      
 0  R  ;;; wan
       ether1                              ether            1500                  52:54:00:12:34:56
 1  R  ether4                              ether            1500                  02:11:2A:3B:FF:C3
 2  R  ether5                              ether            1500                  02:1A:F2:F1:21:B5
[admin@MikroTik] &gt; 
</code></pre>
<p>next thing, lets configure our ip using winbox, this is ip configuration
<img src="server//assets/7dedfcaff5c700e6e724ad760e3b5fc2436b7c644d63310b24aaaf93490a6b8d5cf51677ce32e719a4e0237ec43dfd8ed5e624c58e890d7c37f81ce1.png" alt="image" /></p>
<p>DHCP server section
<img src="server//assets/ca1cdfa9afe3e1d127ce07a5c1e57d47f87842aa0d4804d3b926fcf883b73ed90cc602012200326be8fdbcb021a7f40fa974427ce40f6ccb530c9322.png" alt="image" /></p>
<p>now, try run <code>udhcpc -i eth0</code> on each vm</p>
<h1 id="result-on-pc-1"><a class="header" href="#result-on-pc-1">result on pc-1</a></h1>
<p><img src="server//assets/4e13804d5d7b7ceb052ab19a79d8bf0720b28671348a035f0bfe9809eff022183489033a1c0c11482e99cb3c8dea4785747482724f5a37ab6ad8b61c.png" alt="image" /></p>
<h1 id="result-on-pc-2"><a class="header" href="#result-on-pc-2">result on pc-2</a></h1>
<p><img src="server//assets/1458eceef396746ef428f3d19210c34e564131ad6f30a26d5f075ef170fa0ae20f403f5dbf1f44d924f85b7105a51568576bb16246475772d26d0c55.png" alt="image" /></p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="linux-iptables-preview-try-making-a-nat"><a class="header" href="#linux-iptables-preview-try-making-a-nat">Linux iptables preview (try making a nat)</a></h1>
<p>for example, <code>iptables -t nat</code> the t option from manpage is</p>
<pre><code>          filter:
              This  is  the  default  table  (if  no -t option is passed). It contains the built-in
              chains INPUT (for packets destined to local  sockets),  FORWARD  (for  packets  being
              routed through the box), and OUTPUT (for locally-generated packets).

          nat:
              This  table  is consulted when a packet that creates a new connection is encountered.
              It consists of four built-ins: PREROUTING (for altering packets as soon as they  come
              in),  INPUT  (for  altering packets destined for local sockets), OUTPUT (for altering
              locally-generated packets before routing), and POSTROUTING (for altering  packets  as
              they are about to go out).  IPv6 NAT support is available since kernel 3.7.

          mangle:
              This table is used for specialized packet alteration.  Until kernel 2.4.17 it had two
              built-in chains: PREROUTING (for altering incoming packets before routing) and OUTPUT
              (for  altering locally-generated packets before routing).  Since kernel 2.4.18, three
              other built-in chains are also supported: INPUT (for packets coming into the box  it‐
              self),  FORWARD  (for altering packets being routed through the box), and POSTROUTING
              (for altering packets as they are about to go out).

          raw:
              This table is used mainly for configuring exemptions from connection tracking in com‐
              bination with the NOTRACK target.  It registers at the netfilter  hooks  with  higher
              priority and is thus called before ip_conntrack, or any other IP tables.  It provides
              the  following  built-in chains: PREROUTING (for packets arriving via any network in‐
              terface) and OUTPUT (for packets generated by local processes).

          security:
              This table is used for Mandatory Access Control (MAC) networking rules, such as those
              enabled by the SECMARK and CONNSECMARK targets.  Mandatory Access Control  is  imple‐
              mented by Linux Security Modules such as SELinux.  The security table is called after
              the filter table, allowing any Discretionary Access Control (DAC) rules in the filter
              table  to  take  effect before MAC rules.  This table provides the following built-in
              chains: INPUT (for packets coming into the box itself), OUTPUT (for altering locally-
              generated packets before routing), and FORWARD (for  altering  packets  being  routed
              through the box).
</code></pre>
<h1 id="what-kind-of-tables-in-iptables"><a class="header" href="#what-kind-of-tables-in-iptables">What kind of tables in iptables</a></h1>
<p>according from <a href="https://wiki.archlinux.org/title/Iptables">archlinux wiki</a></p>
<p>iptables contains five tables:</p>
<ul>
<li>raw is used only for configuring packets so that they are exempt from connection tracking.</li>
<li>filter is the default table, and is where all the actions typically associated with a firewall take place.</li>
<li>nat is used for network address translation (e.g. port forwarding).</li>
<li>mangle is used for specialized packet alterations.</li>
<li>security is used for Mandatory Access Control networking rules (e.g. SELinux -- <a href="https://lwn.net/Articles/267140/">see this article</a> for more details).</li>
</ul>
<p>In most common use cases, you will only use two of these: filter and nat. The other tables are aimed at complex configurations involving multiple routers and routing decisions and are in any case beyond the scope of these introductory remarks.</p>
<h1 id="tables--chain-details"><a class="header" href="#tables--chain-details">Tables &amp; chain details</a></h1>
<p>all iptables chain information can be gathered by this command</p>
<pre><code class="language-sh">sudo iptables -t filter -L
sudo iptables -t nat -L
sudo iptables -t mangle -L
sudo iptables -t raw -L
sudo iptables -t security -L
</code></pre>
<p>this is list of all chain by corresponding table</p>
<h2 id="table-raw"><a class="header" href="#table-raw">table <code>raw</code></a></h2>
<ul>
<li>PREROUTING</li>
<li>OUTPUT</li>
</ul>
<h2 id="table-nat"><a class="header" href="#table-nat">table <code>nat</code></a></h2>
<ul>
<li>PREROUTING</li>
<li>INPUT</li>
<li>OUTPUT</li>
<li>POSTROUTING</li>
</ul>
<h2 id="table-mangle"><a class="header" href="#table-mangle">table <code>mangle</code></a></h2>
<ul>
<li>PREROUTING</li>
<li>INPUT</li>
<li>FORWARD</li>
<li>OUTPUT</li>
<li>POSTROUTING</li>
</ul>
<h2 id="table-filter"><a class="header" href="#table-filter">table <code>filter</code></a></h2>
<ul>
<li>INPUT</li>
<li>FORWARD</li>
<li>OUTPUT</li>
</ul>
<h2 id="table-security"><a class="header" href="#table-security">table <code>security</code></a></h2>
<ul>
<li>INPUT</li>
<li>FORWARD</li>
<li>OUTPUT</li>
</ul>
<p>we will focus on <code>NAT</code> section.</p>
<h1 id="machine-session"><a class="header" href="#machine-session">machine session</a></h1>
<p>In iptables, packet often categorized as 4 different state, such</p>
<ul>
<li>NEW</li>
<li>ESTABLISHED</li>
<li>RELATED</li>
<li>INVALID</li>
</ul>
<p>this connection tracking is done by a special framework within the kernel called conntrack</p>
<h1 id="command-lists"><a class="header" href="#command-lists">command lists</a></h1>
<p>this is some special iptables command collection</p>
<ul>
<li><code>iptables --list-rules</code>: show all ip rules</li>
<li><code>iptables --table nat --list --line-numbers</code>: will useful if you want to delete spesific rule, i.e, duplicated rule</li>
<li><code>sudo iptables --table nat -D POSTROUTING 2</code> example: delete rule 2</li>
</ul>
<h2 id="create-your-own-chain"><a class="header" href="#create-your-own-chain">create your own chain</a></h2>
<ul>
<li><code>iptables -N chain_name</code>: eq: <code>--new-chain</code></li>
<li><code>iptables -A chain_name -p icmp -j accept</code> (example)</li>
</ul>
<h2 id="make-changes-permanent"><a class="header" href="#make-changes-permanent">make changes permanent</a></h2>
<p><code>sudo iptables-save &gt; /etc/iptables/rules.v4</code></p>
<h2 id="tables-explanation"><a class="header" href="#tables-explanation">tables explanation</a></h2>
<pre><code class="language-txt">&gt; sudo iptables --table nat --list
Chain PREROUTING (policy ACCEPT)
target     prot opt source               destination         

Chain INPUT (policy ACCEPT)
target     prot opt source               destination         

Chain OUTPUT (policy ACCEPT)
target     prot opt source               destination         

Chain POSTROUTING (policy ACCEPT)
target     prot opt source               destination         
MASQUERADE  all  --  anywhere             anywhere            
MASQUERADE  all  --  anywhere             anywhere            
MASQUERADE  all  --  anywhere             anywhere            
MASQUERADE  all  --  anywhere             anywhere            
</code></pre>
<p>target: what to do with packet.
prot: abbr of protocol
opt: abbr of options (AI says rarely used)
source: its <code>anywhere</code> or explicit ip such <code>192.168.1.0/24</code>
destination: same as source, can be network</p>
<h2 id="show-rules-from-x-table"><a class="header" href="#show-rules-from-x-table">show rules from X table</a></h2>
<p>for example, there has</p>
<ul>
<li><code>nat</code> table, which contains <code>PREROUTING</code>, <code>INPUT</code>, <code>OUTPUT</code>, <code>POSTROUTING</code></li>
<li><code>filter</code> table contains main chain that used by iptables for packet filtering, which contains <code>INPUT</code>, <code>FORWARD</code>, <code>OUTPUT</code></li>
</ul>
<p>MORE deeper on X table</p>
<div class="table-wrapper"><table><thead><tr><th>Table</th><th>Purpose</th><th>Chains it uses</th></tr></thead><tbody>
<tr><td><code>filter</code></td><td>Default, handles packet filtering</td><td><code>INPUT</code>, <code>OUTPUT</code>, <code>FORWARD</code></td></tr>
<tr><td><code>nat</code></td><td>Network Address Translation</td><td><code>PREROUTING</code>, <code>POSTROUTING</code>, <code>OUTPUT</code></td></tr>
<tr><td><code>mangle</code></td><td>Packet modification (TTL, TOS, etc.)</td><td>All chains</td></tr>
<tr><td><code>raw</code></td><td>Pre-connection tracking processing</td><td><code>PREROUTING</code>, <code>OUTPUT</code></td></tr>
<tr><td><code>security</code></td><td>SELinux/LSM-based packet filtering</td><td><code>INPUT</code>, <code>OUTPUT</code>, <code>FORWARD</code></td></tr>
</tbody></table>
</div><div style="break-before: page; page-break-before: always;"></div><h1 id="linux-qemu-network-address-translation"><a class="header" href="#linux-qemu-network-address-translation">Linux QEMU network address translation</a></h1>
<p>first all, set setup our interface</p>
<ul>
<li><code>sudo ip tuntap add tap0 mode tap</code></li>
<li><code>sudo ip tuntap add tap1 mode tap</code> (optional, if there has any more vm)</li>
<li><code>sudo ip link add br0-lan type bridge</code> (our switch)</li>
<li><code>sudo ip addr add 192.168.12.1/24 dev br0-lan</code></li>
<li><code>sudo ip link set br0-lan up</code></li>
<li><code>sudo ip link set tap0 up</code>, also with tap1 if needed</li>
</ul>
<h1 id="run-alpine-guest-hosts"><a class="header" href="#run-alpine-guest-hosts">Run alpine guest hosts</a></h1>
<pre><code class="language-sh">qemu-system-x86_64 \
            -enable-kvm \
            -m 256 \
            -smp 4 \
            -cpu host \
            -drive file=pc-2.qcow2,format=qcow2 \
            -cdrom alpine-virt-3.21.3-x86_64.iso \
            -boot d \
            -nographic \
            -netdev tap,id=net0,ifname=tap0,script=no,downscript=no \
            -device virtio-net-pci,netdev=net0
</code></pre>
<h1 id="inside-of-guest-vm"><a class="header" href="#inside-of-guest-vm">Inside of guest VM</a></h1>
<p>Your <code>ip addr</code> output might something like this</p>
<pre><code class="language-txt">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN qlen 1000
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
    inet 127.0.0.1/8 scope host lo
       valid_lft forever preferred_lft forever
    inet6 ::1/128 scope host 
       valid_lft forever preferred_lft forever
2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state DOWN qlen 1000
    link/ether 52:54:00:12:34:56 brd ff:ff:ff:ff:ff:ff
    inet6 fe80::5054:ff:fe12:3456/64 scope link 
       valid_lft forever preferred_lft forever
</code></pre>
<p>now set eth0 up by typing</p>
<ul>
<li><code>ip link set eth0 up</code></li>
<li><code>ip addr add 192.168.12.2/24 dev eth0</code> (I manually setting up IP)</li>
</ul>
<p>check ip route</p>
<pre><code class="language-sh">pc-2:~# ip r
192.168.12.0/24 dev eth0 scope link  src 192.168.12.2 
</code></pre>
<p>there is no route, run <code>ip route add default via 192.168.12.1</code>, check again with ip route</p>
<pre><code class="language-txt">pc-2:~# ip r
default via 192.168.12.1 dev eth0 
192.168.12.0/24 dev eth0 scope link  src 192.168.12.2 
</code></pre>
<h1 id="setting-up-firewall"><a class="header" href="#setting-up-firewall">setting up firewall</a></h1>
<p>we want everyting from br0-lan is forwarded into wlan0, vice versa. in order to do that, we need NAT (network address translation)</p>
<p>here</p>
<h2 id="check-your-nat-table-first"><a class="header" href="#check-your-nat-table-first">check your nat table first</a></h2>
<p><code>sudo iptables --table nat --list -v</code>, make sure there is no</p>
<pre><code class="language-txt"> 2151  499K MASQUERADE  all  --  any    wlan0   anywhere             anywhere            
</code></pre>
<p>now run</p>
<ul>
<li><code>sudo iptables --table nat --append POSTROUTING --out-interface wlan0 -j MASQUERADE</code></li>
<li><code>sudo iptables -t filter -A FORWARD -i wlan0 -o br0-lan -m state --state RELATED,ESTABLISHED -j ACCEPT</code></li>
<li><code>sudo iptables -t filter -A FORWARD -i br0-lan -o wlan0 -j ACCEPT</code></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="qemu-block-8888-from-host"><a class="header" href="#qemu-block-8888-from-host">QEMU block 8.8.8.8 from host</a></h1>
<p>after <a href="server/../server/qemu_nat.html">this</a></p>
<p>I want this rule</p>
<ul>
<li>allow other ICMP (i.e 1.1.1.1)</li>
<li>deny ICMP 8.8.8.8</li>
</ul>
<h1 id="iptables-rule"><a class="header" href="#iptables-rule">iptables rule</a></h1>
<p>suppose, vm ip is 192.168.12.2, so the iptables command is</p>
<pre><code class="language-sh">sudo iptables -t filter -A FORWARD -s 192.168.12.2 -d 8.8.8.8 -p icmp -j DROP
</code></pre>
<p>note:</p>
<ul>
<li>t: explicit table</li>
<li>a: table FORWARD</li>
<li>s: source from 192.168.12.2 (OUR VM)</li>
<li>d: destination: 8.8.8.8</li>
<li>p: protocol (which is ICMP)</li>
<li>j: jump</li>
</ul>
<h1 id="the-problem"><a class="header" href="#the-problem">the problem</a></h1>
<p>you may see ping 8.8.8.8 still success, let check iptables rule</p>
<pre><code class="language-sh">sudo iptables -t filter -L FORWARD -n --line-numbers -v
</code></pre>
<p>the output</p>
<pre><code class="language-txt">Chain FORWARD (policy ACCEPT)
num  target     prot opt source               destination         
1    ACCEPT     all  --  0.0.0.0/0            0.0.0.0/0            state RELATED,ESTABLISHED
2    ACCEPT     all  --  0.0.0.0/0            0.0.0.0/0           
3    DROP       icmp --  192.168.12.2         8.8.8.8             
</code></pre>
<p>see? when ping to 8.8.8.8, its stop at rule 2, which abort 3st rule, in order to fix it, we need re-order this</p>
<p>remote all rule</p>
<pre><code class="language-sh">sudo iptables -t filter -F FORWARD
</code></pre>
<p>re-add</p>
<pre><code class="language-sh">sudo iptables -t filter -A FORWARD -m state --state RELATED,ESTABLISHED -j ACCEPT
sudo iptables -t filter -A FORWARD -s 192.168.12.2 -d 8.8.8.8 -p icmp -j DROP
sudo iptables -t filter -A FORWARD -s 192.168.12.2/24 -j ACCEPT
</code></pre>
<p>Try re-run <code>sudo iptables -t filter -L FORWARD -n --line-numbers</code></p>
<p>the order should be fixed</p>
<pre><code class="language-txt">Chain FORWARD (policy ACCEPT)
num  target     prot opt source               destination         
1               all  --  0.0.0.0/0            0.0.0.0/0            state RELATED,ESTABLISHED
2    DROP       icmp --  192.168.12.2         8.8.8.8             
3    ACCEPT     all  --  0.0.0.0/0            0.0.0.0/0           
</code></pre>
<p><img src="server//assets/fe70890c7092ec6722fc720cd7358a0107ebfa293c9a1474d84672fb2d07dddff6a1e8027dc13e5f047194144034338506a30d6420584eda58a6019b.png" alt="image" /></p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="logic-netfilter-linux-kernel"><a class="header" href="#logic-netfilter-linux-kernel">logic netfilter linux kernel</a></h1>
<h1 id="logic-nat"><a class="header" href="#logic-nat">Logic NAT</a></h1>
<p>misalkan kita ada virtual interface br0, dengan anggotanya tap0, tap1 lalu ingin forward semua traffic ke wlan0 (karna memang wlan0 tidak bisa di jadikan master dari x y z)</p>
<p>maka solusinya iptables</p>
<pre><code class="language-sh">sudo iptables -t nat -A POSTROUTING -o wlan0 -j MASQUERADE
</code></pre>
<p>logic nya</p>
<ul>
<li>fill dulu tabel nat</li>
<li>append ke postrouting, jadi setelah packet di routing oleh linux kernel, ada 2 field, source addr (katakanlah ip tap0) lalu destination addr (misal 8.8.8.8)</li>
<li>nah, semisal tidak di apa apakan, packet sent ke 8.8.8.8, tapi 8.8.8.8 tidak bisa mengirim back packetnya karna source addr nya invalid (di stage ini, source ip nya adalah IP LAN)</li>
<li>maka, setelah linux kernel meng-routingkan packet nya, seketika setelah itu (postrouting), kita ganti source addrnya dengan source ip PUBLIK milik firewall, jadi 8.8.8.8 bisa tahu kemana packet harus dikirim kembali</li>
<li>didalam firewall, packet yang tadi diterima, direverse balik oleh nat, dan dikirim balik ke perangkat aslinya.</li>
<li>pakai MASQUERADE</li>
</ul>
<h1 id="logic-forward-data-dari-br0-ke-wlan"><a class="header" href="#logic-forward-data-dari-br0-ke-wlan">logic forward data dari br0 ke wlan</a></h1>
<pre><code class="language-sh">sudo iptables -A FORWARD -i br0 -o wlan0 -j ACCEPT
</code></pre>
<p>important notes:</p>
<ul>
<li>chain FORWARD: This chain is only used for packets that are not destined for the local machine, but are routed through it (i.e., from one interface to another).</li>
<li>In this case: a device connected to br0 (e.g., a VM or container) wants to access the internet via wlan0.</li>
</ul>
<p>analoginya</p>
<pre><code class="language-txt">[Device 192.168.100.2] ──&gt; [br0 (Linux bridge)] ──&gt; Linux router ──&gt; [wlan0] ──&gt; Internet
</code></pre>
<p>bisa juga -j diganti drop, maka aliran data akan terputus</p>
<h1 id="logic-forward-dari-wlan0-ke-br0-sebaliknya"><a class="header" href="#logic-forward-dari-wlan0-ke-br0-sebaliknya">logic forward dari wlan0 ke br0 (sebaliknya)</a></h1>
<pre><code class="language-sh">sudo iptables -A FORWARD -i wlan0 -o br0 -m state --state RELATED,ESTABLISHED -j ACCEPT
</code></pre>
<p>logic:</p>
<ul>
<li>misal vm tap0 buat koneksi keluar, misal ke 8.8.8.8</li>
<li>dari tap0 -&gt; br0 -&gt; wlan0 di allow oleh rule <code>sudo iptables -A FORWARD -i br0 -o wlan0 -j ACCEPT</code></li>
<li>ketika server mengirim respon balik, maka alurnya dari wlan0 ke br0, nah ini fungsi dari <code>sudo iptables -A FORWARD -i wlan0 -o br0 -j ACCEPT</code></li>
</ul>
<p>KENAPA harus pakai <code>--state RELATED,ESTABLISHED</code>
karna kita butuh packet yg sudah estab duluan yg boleh lewat. ini akan menghindari jaringan luar (wlan0) mengakses br0 -&gt; tap0 &amp; tap1</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="resep-nginx-oleh-pak-hanif"><a class="header" href="#resep-nginx-oleh-pak-hanif">resep nginx oleh pak hanif</a></h1>
<p>cuplikan config nginx di server, cc <a href="https://github.com/hansputera">@hansputera</a></p>
<pre><code class="language-txt">
server {
        listen 80; # tanpa server_default
        listen [::]:80;

        root /var/www/html/blablabla.fadev.org;
        
        index index.php index.html index.htm index.nginx-debian.html;

        server_name blablabla.fadev.org;

        location ~ \.php$ {
                include snippets/fastcgi-php.conf;

                fastcgi_pass unix:/run/php/php-fpm.sock;
        }
}

</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="ip-command"><a class="header" href="#ip-command">ip command</a></h1>
<h2 id="ip-addr"><a class="header" href="#ip-addr"><code>ip addr</code></a></h2>
<p>ip addr is used to display and manage IP addresses assigned to network interfaces.</p>
<p>example:</p>
<ul>
<li><code>ip addr</code></li>
<li><code>ip addr show</code></li>
<li><code>sudo ip addr add 192.168.1.100/24 dev eth0</code></li>
<li><code>sudo ip addr del 192.168.1.100/24 dev eth0</code></li>
</ul>
<p>anything about ip assigment</p>
<h2 id="ip-link"><a class="header" href="#ip-link"><code>ip link</code></a></h2>
<p>ip link is used to display and manage network interfaces (links), focusing on layer 2 (Ethernet, loopback, etc.), not IP addresses.</p>
<p>example:</p>
<ul>
<li><code>ip link</code></li>
<li><code>sudo ip link set dev eth0 up</code></li>
<li><code>sudo ip link set dev eth0 down</code></li>
<li><code>sudo ip link set dev eth0 mtu 1400</code></li>
</ul>
<p>anyting about interface</p>
<h2 id="ip-tuntap"><a class="header" href="#ip-tuntap"><code>ip tuntap</code></a></h2>
<p>ip tuntap manages TUN/TAP virtual network interfaces, which provide a way for user-space programs to interact with network packets as if they were network devices.</p>
<ul>
<li>TUN: Simulates a point-to-point device (layer 3), used for routing IP packets (e.g., VPN tunnels).</li>
<li>TAP: Simulates an Ethernet device (layer 2), used for bridging Ethernet frames (e.g., virtual switches, VMs).</li>
</ul>
<p>example:</p>
<ul>
<li><code>sudo ip tuntap add mode tap dev tap0</code></li>
<li><code>sudo ip tuntap add mode tun dev tun0</code></li>
<li><code>sudo ip tuntap del mode tap dev tap0</code></li>
</ul>
<h2 id="ip-route"><a class="header" href="#ip-route"><code>ip route</code></a></h2>
<p>IP routing is the process by which data packets are directed from their source to their destination across interconnected networks using Internet Protocol (IP). This process is fundamental to the operation of the Internet and all IP-based networks.</p>
<ul>
<li><a href="https://www.link11.com/en/glossar/ip-routing/">https://www.link11.com/en/glossar/ip-routing/</a></li>
<li><a href="https://www.cloudflare.com/learning/network-layer/what-is-routing/">https://www.cloudflare.com/learning/network-layer/what-is-routing/</a></li>
<li><a href="https://info.support.huawei.com/info-finder/encyclopedia/en/IP+routing.html">https://info.support.huawei.com/info-finder/encyclopedia/en/IP+routing.html</a></li>
</ul>
<p>View routing table:</p>
<ul>
<li><code>ip route</code></li>
</ul>
<p>add route</p>
<ul>
<li><code>ip route add &lt;destination&gt; via &lt;gateway&gt; dev &lt;interface&gt;</code></li>
</ul>
<p>example:</p>
<pre><code class="language-sh">pc-1:~# ip route add default via 192.168.15.1 dev eth0
pc-1:~# ip route
default via 192.168.15.1 dev eth0 
192.168.15.0/24 dev eth0 scope link  src 192.168.15.2 

</code></pre>
<p>delete route</p>
<ul>
<li><code>sudo ip route del &lt;destination&gt; [via &lt;gateway&gt;] [dev &lt;interface&gt;]</code></li>
</ul>
<p>example:</p>
<pre><code class="language-sh">pc-1:~# ip route delete default via 192.168.15.1 dev eth0
pc-1:~# ip r
192.168.15.0/24 dev eth0 scope link  src 192.168.15.2 
pc-1:~# 
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="qemu-default-network"><a class="header" href="#qemu-default-network">qemu default network</a></h1>
<p>The default gateway in QEMU when using the default user-mode networking (SLIRP) is typically 10.0.2.2 on the network 10.0.2.0/24. QEMU creates a virtual NAT network where the guest is assigned an IP like 10.0.2.15 by DHCP, and the gateway for the guest to reach outside networks is 10.0.2.2. This gateway is implemented inside QEMU and handles routing and NAT for the guest's traffic.</p>
<ul>
<li>Default network: 10.0.2.0/24</li>
<li>Default gateway: 10.0.2.2</li>
<li>Default guest IP (DHCP assigned): 10.0.2.15</li>
<li>Default DNS server in guest: 10.0.2.3</li>
</ul>
<p>This setup requires no special host configuration or root privileges and is the default networking mode for QEMU user mode networking.</p>
<p>additional</p>
<ul>
<li><a href="https://docs.zephyrproject.org/latest/connectivity/networking/qemu_user_setup.html">https://docs.zephyrproject.org/latest/connectivity/networking/qemu_user_setup.html</a></li>
<li><a href="https://darnassus.sceen.net/~hurd-web/hurd/running/qemu/networking/">https://darnassus.sceen.net/~hurd-web/hurd/running/qemu/networking/</a></li>
<li><a href="https://wiki.qemu.org/Documentation/Networking">https://wiki.qemu.org/Documentation/Networking</a></li>
</ul>
<p><img src="server//assets/48f2d507fd958141a00b350df469bf5d076debc3f89ecb8785b87ff2f44e56f5eeb4ab6639640679f02cf29cbb0942992cfd0d92592042be8685c4ae.png" alt="image" /></p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="mikrotik-firewall"><a class="header" href="#mikrotik-firewall">mikrotik firewall</a></h1>
<p>each firewall module (called as table in iptables) has its own predefined chain</p>
<ul>
<li>
<p>raw:
dipakai sebelum data dilihat oleh conntrack, NAT, masuk routing, dll. intinya di sinilah proses early sebelum benar2 di proses. karna belum sampai ke conntrack, maka akan sangat fast, dipakai untuk mitigasi ddos</p>
<p>karna statenya ada sebelum conntrack, maka tidak ada status kayak estab, dll, tapi sangat fast + low cpu, only raw matching</p>
<p>Karna raw table melihat packet sebelum NAT, maka</p>
<ul>
<li>Destination IPs are still the original IPs from the client</li>
<li>Source IPs haven't been changed by masquerade or src-nat yet</li>
</ul>
<p>chain chain nya</p>
<ul>
<li>prerouting: packet yang datang dari luar just sebelum masuk conntrack</li>
<li>output: packet yang digenerate oleh aplikasi, juga statenya sebelum di track oleh conntrack</li>
</ul>
<h2 id="contoh"><a class="header" href="#contoh">contoh</a></h2>
<ul>
<li><code>/ip firewall raw add chain=prerouting src-address=8.8.8.8 action=drop</code></li>
</ul>
<h2 id="tambahan-1"><a class="header" href="#tambahan-1">tambahan:</a></h2>
<p>letak raw di packet flow</p>
<pre><code class="language-txt">IN → RAW → MANGLE (pre) → CONNECTION TRACKING → NAT (dstnat) → FILTER (input/forward) → MANGLE (post) → NAT (srcnat) → OUT
</code></pre>
</li>
<li>
<p>filter</p>
<ul>
<li>input</li>
<li>forward</li>
<li>output</li>
</ul>
</li>
<li>
<p>mangle</p>
<ul>
<li>prerouting</li>
<li>input</li>
<li>forward</li>
<li>output</li>
<li>postrouting</li>
<li></li>
</ul>
</li>
<li>
<p>nat</p>
<ul>
<li>srcnat</li>
<li>dstnat</li>
</ul>
</li>
</ul>
<h1 id="chains"><a class="header" href="#chains">chains</a></h1>
<p>RouterOS consist of a few default chains. These chains allow you to filter packets at various points:</p>
<ul>
<li>The PREROUTING chain: Rules in this chain apply to packets as they just arrive on the network interface. This chain is present in the nat, mangle and raw tables.</li>
<li>The INPUT chain: Rules in this chain apply to packets just before they’re given to a local process. This chain is present in the mangle and filter tables.</li>
<li>The OUTPUT chain: The rules here apply to packets just after they’ve been produced by a process. This chain is present in the raw, mangle, nat, and filter tables.</li>
<li>The FORWARD chain: The rules here apply to any packets that are routed through the current host. This chain is only present in the mangle and filter tables.</li>
<li>The POSTROUTING chain: The rules in this chain apply to packets as they just leave the network interface. This chain is present in the nat and mangle tables.</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="bring-wlan0-connectivity-to-the-network-namespace-linux--test-routeros"><a class="header" href="#bring-wlan0-connectivity-to-the-network-namespace-linux--test-routeros">bring wlan0 connectivity to the network namespace linux &amp; test routerOS</a></h1>
<h1 id="setup-network-namespace"><a class="header" href="#setup-network-namespace">setup network namespace</a></h1>
<ul>
<li><code>sudo ip netns add firefoxns</code></li>
<li><code>sudo ip netns exec firefoxns ip link add br0-lan type bridge</code></li>
<li><code>sudo ip netns exec firefoxns ip tuntap add tap0 mode tap</code></li>
<li><code>sudo ip netns exec firefoxns ip tuntap add tap1 mode tap</code></li>
<li><code>sudo ip netns exec firefoxns ip tuntap add tap2 mode tap</code></li>
<li><code>sudo ip netns exec firefoxns ip link set dev tap0 master br0-lan</code></li>
<li><code>sudo ip netns exec firefoxns ip link set dev tap1 master br0-lan</code></li>
<li><code>sudo ip netns exec firefoxns ip link set dev tap2 master br0-lan</code></li>
</ul>
<h1 id="enable-the-network-interface-inside-netns"><a class="header" href="#enable-the-network-interface-inside-netns">enable the network interface (inside netns)</a></h1>
<ul>
<li><code>sudo ip netns exec firefoxns ip link set br0-lan up</code></li>
<li><code>sudo ip netns exec firefoxns ip link set tap0 up</code></li>
<li><code>sudo ip netns exec firefoxns ip link set tap1 up</code></li>
<li><code>sudo ip netns exec firefoxns ip link set tap2 up</code></li>
</ul>
<h1 id="create-virtual-eth-pair-between-host--netns"><a class="header" href="#create-virtual-eth-pair-between-host--netns">create virtual eth pair between host &amp; netns</a></h1>
<ul>
<li><code>sudo ip link add veth0 type veth peer name veth0-peer</code></li>
<li><code>sudo ip link set veth0-peer netns firefoxns</code></li>
</ul>
<h1 id="assign-ip-for-virtual-eth--virtual-eth-peer"><a class="header" href="#assign-ip-for-virtual-eth--virtual-eth-peer">assign ip for virtual eth &amp; virtual eth peer</a></h1>
<ul>
<li><code>sudo ip addr add 10.200.1.1/24 dev veth0</code></li>
<li><code>sudo ip netns exec firefoxns ip addr add 10.200.1.2/24 dev veth0-peer</code></li>
<li><code>sudo ip link set veth0 up</code></li>
<li><code>sudo ip netns exec firefoxns ip link set veth0 up</code></li>
</ul>
<h1 id="setup-routing-table"><a class="header" href="#setup-routing-table">setup routing table</a></h1>
<ul>
<li><code>sudo ip netns exec firefoxns ip route add default via 10.200.1.1</code></li>
</ul>
<h1 id="setup-ip-forwarding--network-address-translation"><a class="header" href="#setup-ip-forwarding--network-address-translation">setup ip forwarding &amp; network address translation</a></h1>
<ul>
<li><code>sudo sysctl -w net.ipv4.ip_forward=1</code></li>
<li><code>sudo iptables -t nat -A POSTROUTING -s 10.200.1.0/24 -o wlan0 -j MASQUERADE</code></li>
</ul>
<h1 id="test"><a class="header" href="#test">test</a></h1>
<ul>
<li><code>sudo ip netns exec ping 1.1.1.1</code></li>
</ul>
<h1 id="now-run-routeros--alpine-inside-of-netns"><a class="header" href="#now-run-routeros--alpine-inside-of-netns">now, run routeros &amp; alpine inside of netns</a></h1>
<h2 id="routeros"><a class="header" href="#routeros">routeros</a></h2>
<pre><code class="language-sh">sudo ip netns exec firefoxns qemu-system-x86_64 \
            -enable-kvm \
            -m 256 \
            -smp 4 \
            -cpu host \
            -drive file=chr.qcow2,format=qcow2 \
            -boot d \
            -nographic \
            -netdev tap,id=net0,ifname=tap0,script=no,downscript=no \
            -device virtio-net-pci,netdev=net0,mac=02:aa:bb:cc:dd:ee \
            -net user,hostfwd=tcp::8291-:8291 \
            -net nic
</code></pre>
<h2 id="alpine"><a class="header" href="#alpine">alpine</a></h2>
<pre><code class="language-sh">sudo ip netns exec firefoxns qemu-system-x86_64 \
            -enable-kvm \
            -m 256 \
            -smp 4 \
            -cpu host \
            -drive file=pc-2.qcow2,format=qcow2 \
            -cdrom alpine-virt-3.21.3-x86_64.iso \
            -boot d \
            -nographic \
            -netdev tap,id=net0,ifname=tap2,script=no,downscript=no \
            -device virtio-net-pci,netdev=net0,mac=$(randommac)

</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="network-namespace--nat-notes"><a class="header" href="#network-namespace--nat-notes">network namespace + NAT notes</a></h1>
<ul>
<li><code>ip a</code></li>
<li><code>sudo ip link add veth0 type veth peer name veth0-peer</code></li>
<li><code>sudo ip addr add 10.200.1.1/24 dev veth0</code></li>
<li><code>sudo ip netns add firefoxns</code></li>
<li><code>sudo ip link set veth0-peer netns firefoxns</code></li>
<li><code>sudo sysctl -w net.ipv4.ip_forward=1</code></li>
<li><code>sudo iptables -t nat -A POSTROUTING -s 10.200.1.0/24 -o wlan0 -j MASQUERADE</code></li>
<li><code>sudo ip netns exec firefoxns ip addr add 10.200.1.2/24 dev veth0-peer</code></li>
<li><code>sudo ip netns exec firefoxns ip addr add 127.0.0.1/8 dev lo</code></li>
<li><code>sudo ip netns exec firefoxns ip link set lo up</code></li>
<li><code>sudo ip netns exec firefoxns ip link set veth0-peer up</code></li>
<li><code>sudo ip netns exec firefoxns ip route add default via 10.200.1.1</code></li>
<li><code>sudo ip netns exec firefoxns ip link add br0-lan type bridge</code></li>
<li><code>sudo ip netns exec firefoxns ip tuntap add tap0 mode tap</code></li>
<li><code>sudo ip netns exec firefoxns ip tuntap add tap1 mode tap</code></li>
<li><code>sudo ip netns exec firefoxns ip tuntap add tap2 mode tap</code></li>
<li><code>sudo ip netns exec firefoxns ip link set dev tap0 master br0-lan</code></li>
<li><code>sudo ip netns exec firefoxns ip link set dev tap1 master br0-lan</code></li>
<li><code>sudo ip netns exec firefoxns ip link set dev tap2 master br0-lan</code></li>
<li><code>sudo ip netns exec firefoxns ip link set dev tap0 up</code></li>
<li><code>sudo ip netns exec firefoxns ip link set dev tap1 up</code></li>
<li><code>sudo ip netns exec firefoxns ip link set dev tap2 up</code></li>
<li><code>sudo ip netns exec firefoxns ip link set dev br0-lan up</code></li>
<li><code>sudo ip netns exec firefoxns qemu-system-x86_64 -enable-kvm -m 256 -smp 4 -cpu host -drive file=chr.qcow2,format=qcow2 -boot d -nographic -netdev tap,id=net0,ifname=tap0,script=no,downscript=no -device virtio-net-pci,netdev=net0,mac=02:aa:bb:cc:dd:ee -net user,hostfwd=tcp::8291-:8291 -net nic</code></li>
<li><code>sudo ip netns exec firefoxns qemu-system-x86_64 -enable-kvm -m 256 -smp 4 -cpu host -drive file=pc-1.qcow2,format=qcow2 -cdrom alpine-virt-3.21.3-x86_64.iso -boot d -nographic -netdev tap,id=net0,ifname=tap1,script=no,downscript=no -device virtio-net-pci,netdev=net0,mac=$(randommac)</code></li>
</ul>
<p>randommac source code</p>
<pre><code class="language-rust">use rand::Rng;

fn main() {
    let mut rng = rand::thread_rng();
    let mac = format!(
        "52:54:00:{:02x}:{:02x}:{:02x}",
        rng.gen::&lt;u8&gt;(),
        rng.gen::&lt;u8&gt;(),
        rng.gen::&lt;u8&gt;()
    );
    println!("{}", mac);
}
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="deploy-docmost-on-server"><a class="header" href="#deploy-docmost-on-server">deploy Docmost on server</a></h1>
<p>please read this doc first, <a href="https://docmost.com/docs/installation">https://docmost.com/docs/installation</a></p>
<h2 id="docker-compose-config"><a class="header" href="#docker-compose-config">docker compose config</a></h2>
<pre><code class="language-yml">version: "3"

services:
  docmost:
    image: docmost/docmost:latest
    depends_on:
      - db
      - redis
    environment:
      APP_URL: "http://localhost:3000"
      APP_SECRET: "REPLACE_WITH_LONG_SECRET"
      DATABASE_URL: "postgresql://docmost:STRONG_DB_PASSWORD@db:5432/docmost?schema=public"
      REDIS_URL: "redis://redis:6379"
    ports:
      - "3000:3000"
    restart: unless-stopped
    volumes:
      - docmost:/app/data/storage

  db:
    image: postgres:16-alpine
    environment:
      POSTGRES_DB: docmost
      POSTGRES_USER: docmost
      POSTGRES_PASSWORD: STRONG_DB_PASSWORD
    restart: unless-stopped
    volumes:
      - db_data:/var/lib/postgresql/data

  redis:
    image: redis:7.2-alpine
    restart: unless-stopped
    volumes:
      - redis_data:/data

volumes:
  docmost:
  db_data:
  redis_data:
</code></pre>
<p>replace your <code>STRONG_DB_PASSWORD</code> with <code>openssl rand -hex 10</code>, and <code>REPLACE_WITH_LONG_SECRET</code> with <code>openssl rand -hex 32</code>, and <code>APP_URL</code>, for example, in my case is <code>https://docmost.fadev.org</code></p>
<p>run <code>docker compose run</code></p>
<h2 id="setup-reverse-proxy-nginx"><a class="header" href="#setup-reverse-proxy-nginx">setup reverse proxy (nginx)</a></h2>
<p>go to <code>/etc/nginx/sites-enabled</code>, and create a clone with <code>cp default docmost.fadev.org</code></p>
<p>fill it like this</p>
<pre><code class="language-conf">server_name docmost.fadev.org;

location / {
	# First attempt to serve request as file, then
	# as directory, then fall back to displaying a 404.
	#try_files $uri $uri/ =404;

	proxy_pass http://127.0.0.1:3000;
}

location /socket.io/ {
	proxy_pass http://127.0.0.1:3000;
	proxy_http_version 1.1;
	proxy_set_header Upgrade $http_upgrade;
	proxy_set_header Connection "upgrade";
	proxy_set_header Host $host;
}

location /collab {
	proxy_pass http://127.0.0.1:3000;
	proxy_http_version 1.1;
	proxy_set_header Upgrade $http_upgrade;
	proxy_set_header Connection "upgrade";
	proxy_set_header Host $host;
}

</code></pre>
<h2 id="https"><a class="header" href="#https">HTTPS</a></h2>
<p>run</p>
<ul>
<li><code>sudo apt install certbot python3-certbot-nginx</code></li>
<li><code>sudo certbot --nginx -d docmost.fadev.org</code></li>
</ul>
<h2 id="firewall"><a class="header" href="#firewall">Firewall</a></h2>
<p>allow port 443</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="fix-vthxxxxxxxx-is-not-connected-to-docker0"><a class="header" href="#fix-vthxxxxxxxx-is-not-connected-to-docker0">fix vthxxxxxxxx is not connected to docker0</a></h1>
<p>consider</p>
<pre><code class="language-txt">&gt; ip  a
1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
    inet 127.0.0.1/8 scope host lo
       valid_lft forever preferred_lft forever
    inet6 ::1/128 scope host noprefixroute 
       valid_lft forever preferred_lft forever
2: enp2s0: &lt;NO-CARRIER,BROADCAST,MULTICAST,UP&gt; mtu 1500 qdisc fq_codel state DOWN group default qlen 1000
    link/ether 2c:4d:54:c6:f2:0c brd ff:ff:ff:ff:ff:ff
    altname enx2c4d54c6f20c
3: wlan0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP group default qlen 1000
    link/ether f0:03:8c:66:9c:21 brd ff:ff:ff:ff:ff:ff
    inet 192.168.105.162/24 metric 1024 brd 192.168.105.255 scope global dynamic wlan0
       valid_lft 2920sec preferred_lft 2920sec
    inet 192.168.105.163/24 brd 192.168.105.255 scope global secondary dynamic noprefixroute wlan0
       valid_lft 2921sec preferred_lft 2921sec
    inet6 fe80::ee67:75f9:fa9c:2561/64 scope link noprefixroute 
       valid_lft forever preferred_lft forever
4: docker0: &lt;NO-CARRIER,BROADCAST,MULTICAST,UP&gt; mtu 1500 qdisc noqueue state DOWN group default 
    link/ether 86:1e:e0:72:f4:8d brd ff:ff:ff:ff:ff:ff
    inet 172.17.0.1/16 brd 172.17.255.255 scope global docker0
       valid_lft forever preferred_lft forever
    inet6 fe80::841e:e0ff:fe72:f48d/64 scope link proto kernel_ll 
       valid_lft forever preferred_lft forever
17: veth914db4f@if2: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP group default 
    link/ether d2:02:61:f4:12:d0 brd ff:ff:ff:ff:ff:ff link-netnsid 0
    inet6 fe80::d002:61ff:fef4:12d0/64 scope link proto kernel_ll 
       valid_lft forever preferred_lft forever

</code></pre>
<p>you can see, veth914db4f is not connected to br0. let's try hard</p>
<ul>
<li>run image (explicitly) as bridge network: <code>docker run --network bridge -it --rm -p 127.0.0.1:8000:4000 php-test-server</code> (this is nothing happen)</li>
<li>force connect: <code>docker network connect bridge 2cf520235e6a</code> (this is show Error response from daemon: endpoint with name mystifying_yonath already exists in network bridge, but <code>ip a</code> says vethxxxx is not master to anyone). you can try <code>disconnect</code> &amp; <code>connect</code> again</li>
</ul>
<p>also</p>
<pre><code class="language-txt">docker inspect -f '{{json .NetworkSettings.Networks}}' 2cf520235e6a | jq
{
  "bridge": {
    "IPAMConfig": null,
    "Links": null,
    "Aliases": null,
    "MacAddress": "5a:2d:5d:7c:c1:86",
    "DriverOpts": null,
    "GwPriority": 0,
    "NetworkID": "08f151565c95ba052f682c7560e55199e2d75f3d2348af8f98a9711e9294b3fd",
    "EndpointID": "0522c15ad18fbae05071a7d5e09944b7777deaafd3490082cac237fdfcd14f0c",
    "Gateway": "172.17.0.1",
    "IPAddress": "172.17.0.2",
    "IPPrefixLen": 16,
    "IPv6Gateway": "",
    "GlobalIPv6Address": "",
    "GlobalIPv6PrefixLen": 0,
    "DNSNames": null
  }
}

</code></pre>
<p>the medicine: <a href="https://forums.docker.com/t/no-connection-to-the-bridge-by-default/134619/8">https://forums.docker.com/t/no-connection-to-the-bridge-by-default/134619/8</a></p>
<pre><code class="language-txt">sudo systemctl stop systemd-networkd.service                                                    
sudo systemctl disable systemd-networkd.service                                                        
sudo systemctl stop systemd-networkd.socket                                                            
sudo systemctl disable systemd-networkd.socket
sudo systemctl start NetworkManager
sudo systemctl enable NetworkManager
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="php-fpm-config"><a class="header" href="#php-fpm-config">php-fpm config</a></h1>
<p>file ini biasanya ada di</p>
<ul>
<li><code>/usr/local/etc/php-fpm.d/www.conf</code> (di docker php-fpm)</li>
<li><code>/etc/php/8.3/fpm/pool.d/www.conf</code> (di debian bullseye)</li>
</ul>
<p>intinya, tidak pasti haha.</p>
<h2 id="config-structure"><a class="header" href="#config-structure">config structure</a></h2>
<p>general structure nya seperti ini kalau ';' dihilangkan</p>
<pre><code class="language-ini">[www]
user = www-data
group = www-data
listen = /run/php/php8.3-fpm.sock
listen.owner = www-data
listen.group = www-data
pm = dynamic
pm.max_children = 5
pm.start_servers = 2
pm.min_spare_servers = 1
pm.max_spare_servers = 3
</code></pre>
<h2 id="config-global-wip"><a class="header" href="#config-global-wip">config global (WIP)</a></h2>
<p>lokasi config ini ada di</p>
<p><code>/etc/php/php-fpm.conf</code></p>
<h2 id="config-untuk-pool-each"><a class="header" href="#config-untuk-pool-each">config untuk pool (each)</a></h2>
<p>best read <a href="https://www.php.net/manual/en/install.fpm.configuration.php">https://www.php.net/manual/en/install.fpm.configuration.php</a></p>
<ul>
<li><b>[pool_name]</b>
intinya ini unique, tidak ada yang sama</li>
<li><b>user / group</b>
<ul>
<li><code>user</code>: dimana child process akan di run (as user?)</li>
<li><code>group</code>: liat /etc/passwd</li>
</ul>
</li>
<li><b>listen</b>
<ul>
<li>
<p><code>listen</code>: dimana daemon akan listen yg nanti akan di reverse proxy oleh nginx,
nilai defaultnya biasanya <code>/run/php/php8.3-fpm.sock</code> atau <code>127.0.0.1:9000</code>, contoh:</p>
<ul>
<li><code>ip.add.re.ss:port</code></li>
<li><code>[ip:6:addr:ess]:port</code></li>
<li><code>port</code></li>
<li>/path/to/unix/socket</li>
</ul>
</li>
<li>
<p><code>listen.backlog</code>: jumlah queue pending connection yang bisa di hold</p>
</li>
<li>
<p><code>listen.owner</code>: configure ke mana kah <code>/run/php/php8.3-fpm.sock</code> itu ownernya</p>
</li>
<li>
<p><code>listen.group</code>: same as <code>listen.owner</code></p>
</li>
<li>
<p><code>listen.mode</code>: nomor permission si <code>/run/php/php8.3-fpm.sock</code> listen</p>
</li>
<li>
<p><code>listen.acl_users</code>: WIP</p>
</li>
<li>
<p><code>listen.acl_groups</code>: WIP</p>
</li>
<li>
<p><code>listen.allowed_clients</code>: set dari mana FCGI boleh diakses, di kasus nginx, mostly 127.0.0.1, except docker, dia pakai br-xxxxxx yang ip nya pasti bukan 127.0.0.1</p>
</li>
<li>
<p><code>listen.setfib</code>: WIP</p>
</li>
</ul>
</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="systemd-config-template"><a class="header" href="#systemd-config-template">systemd config template</a></h1>
<p>root location: <code>/etc/systemd/system/&lt;YOUR_SERVICE&gt;.service</code></p>
<p>template</p>
<pre><code class="language-txt">[Unit]
Description=Random service
After=network.target
StartLimitIntervalSec=0

[Service]
Type=simple
Restart=always
RestartSec=1
User=root
ExecStart=/usr/bin/randomprogram -c /etc/randomprogram/other.toml

[Install]
WantedBy=multi-user.target
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="setting-up-ubuntu-server-with-qemu--custom-bridge"><a class="header" href="#setting-up-ubuntu-server-with-qemu--custom-bridge">setting up ubuntu server with qemu + custom bridge</a></h1>
<h2 id="qemu-section"><a class="header" href="#qemu-section">qemu section</a></h2>
<pre><code class="language-sh"># create image first
qemu-img create -f qcow2 ubuntu-server.img 10G

# run the iso
qemu-system-x86_64 \
      -enable-kvm \
      -boot order=d \
      -cdrom ubuntu-24.04.2-live-server-amd64.iso \
      -drive if=pflash,format=raw,readonly=on,file=/usr/share/edk2/x64/OVMF_CODE.4m.fd \
      -drive if=pflash,format=raw,file=OVMF_VARS_ubuntu_server_gpt.4m.fd \
      -drive file=ubuntu-server.img,format=qcow2 \
      -m 4G \
      -smp 4 \
      -net user,hostfwd=tcp::20022-:22 \
      -net nic

# run iso
qemu-system-x86_64 \
	-enable-kvm \
	-boot order=d \
	-drive if=pflash,format=raw,readonly=on,file=/usr/share/edk2/x64/OVMF_CODE.4m.fd \
	-drive if=pflash,format=raw,file=OVMF_VARS_ubuntu_server_gpt.4m.fd \
	-drive file=ubuntu-server.img,format=qcow2 \
	-m 4G \
	-smp 4 \
	-net user,hostfwd=tcp::20022-:22 \
	-net nic \
	-vga virtio
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="setting-up-routeros--ubuntu-server-freeradius--and-archlinux-client"><a class="header" href="#setting-up-routeros--ubuntu-server-freeradius--and-archlinux-client">setting up routeros + ubuntu server (freeradius) + and archlinux client</a></h1>
<h2 id="first-setup-virtual-lan"><a class="header" href="#first-setup-virtual-lan">first, setup virtual lan</a></h2>
<p>setup configurasi ip hingga seperti ini</p>
<pre><code class="language-sh">51: br0-lan: &lt;NO-CARRIER,BROADCAST,MULTICAST,UP&gt; mtu 1500 qdisc noqueue state DOWN group default qlen 1000
    link/ether 8a:b9:27:b3:c7:a5 brd ff:ff:ff:ff:ff:ff
    inet6 fe80::88b9:27ff:feb3:c7a5/64 scope link proto kernel_ll 
       valid_lft forever preferred_lft forever
53: tap0: &lt;NO-CARRIER,BROADCAST,MULTICAST,UP&gt; mtu 1500 qdisc fq_codel master br0-lan state DOWN group default qlen 1000
    link/ether c6:33:f3:fe:d3:ba brd ff:ff:ff:ff:ff:ff
    inet6 fe80::c433:f3ff:fefe:d3ba/64 scope link proto kernel_ll 
       valid_lft forever preferred_lft forever
54: tap1: &lt;NO-CARRIER,BROADCAST,MULTICAST,UP&gt; mtu 1500 qdisc fq_codel master br0-lan state DOWN group default qlen 1000
    link/ether a2:eb:ee:56:8a:90 brd ff:ff:ff:ff:ff:ff
    inet6 fe80::a0eb:eeff:fe56:8a90/64 scope link proto kernel_ll 
       valid_lft forever preferred_lft forever
55: tap2: &lt;BROADCAST,MULTICAST&gt; mtu 1500 qdisc noop master br0-lan state DOWN group default qlen 1000
    link/ether c6:c7:1c:7c:67:8a brd ff:ff:ff:ff:ff:ff
</code></pre>
<p>untuk membuatnya, jalankan skrip command command ini:</p>
<ul>
<li><code>sudo ip link add br0-lan type bridge</code> &lt;- buat switch virtual</li>
<li><code>sudo ip tuntap add tap0 mode tap</code> &lt;- buat colokan virtual</li>
<li><code>sudo ip tuntap add tap1 mode tap</code></li>
<li><code>sudo ip tuntap add tap2 mode tap</code></li>
<li><code>sudo ip link set tap0 master br0-lan</code> &lt;- set semua colokan punya induk ke switch br0-lan, intinya harus satu switch</li>
<li><code>sudo ip link set tap1 master br0-lan</code></li>
<li><code>sudo ip link set tap2 master br0-lan</code></li>
<li><code>sudo ip link set br0-lan up</code> &lt;- nyalakan semua interface nya</li>
<li><code>sudo ip link set tap0 up</code></li>
<li><code>sudo ip link set tap1 up</code></li>
<li><code>sudo ip link set tap2 up</code></li>
</ul>
<h2 id="alokasi-interface"><a class="header" href="#alokasi-interface">alokasi interface</a></h2>
<ul>
<li><code>br0-lan</code> --&gt; switch utama</li>
<li><code>tap0</code> --&gt; interface untuk routerOS</li>
<li><code>tap1</code> --&gt; interface untuk freeradius (running di ubuntu server)</li>
<li><code>tap2</code> --&gt; interface test client (bisa alpineLinux, archlinux, bebas)</li>
</ul>
<h2 id="run-routeros"><a class="header" href="#run-routeros">run routeros</a></h2>
<p>download links: https://download.mikrotik.com/routeros/6.49.18/chr-6.49.18.img.zip</p>
<pre><code class="language-sh"># convert first
qemu-img convert -f raw -O qcow2 chr-6.49.18.img chr.qcow2

# then run
qemu-system-x86_64 \
      -enable-kvm \
      -smp 4 \
      -m 256M \
      -drive file=chr.qcow2,format=qcow2 \
      -boot order=d \
      -net user,hostfwd=tcp::8291-:8291 \
      -net nic \
      -nographic \
      -netdev tap,id=net0,ifname=tap0,script=no,downscript=no \
      -device virtio-net-pci,netdev=net0,mac=02:11:2a:3b:ff:c3
</code></pre>
<p><img src="server//assets/5f64d4f9b4ff9ec75cdb5641d5ccc8e63e796e7e736d3b66f0523fdbb984f651e399a2fa28fd943cfc1272db3b1330dddf56b5ca9100e9316e8c31a5.png" alt="image" />
setidaknya, mac-addr nya sama. yaitu ether3</p>
<h2 id="run-ubuntu-server"><a class="header" href="#run-ubuntu-server">run ubuntu server</a></h2>
<p>command ini hanya dirun run sekali (ketika instalasi)</p>
<pre><code class="language-sh"># copy firmware uefi vars
cp /usr/share/edk2/x64/OVMF_VARS.4m.fd .
mv OVMF_VARS.4m.fd OVMF_VARS_ubuntu_server_gpt.4m.fd

# run qemu
qemu-system-x86_64 \
    -enable-kvm \
    -boot order=d \
    -cdrom ubuntu-24.04.2-live-server-amd64.iso \
    -drive if=pflash,format=raw,readonly=on,file=/usr/share/edk2/x64/OVMF_CODE.4m.fd \
    -drive if=pflash,format=raw,file=OVMF_VARS_ubuntu_server_gpt.4m.fd \
    -drive file=ubuntu-server.img,format=qcow2 \
    -m 4G \
    -smp 4 \
    -net user,hostfwd=tcp::20022-:22 \
    -net nic
</code></pre>
<p>proses instalasi ubuntu server cari di internet xixi.</p>
<p>setelah installed, kita install beberapa base package dahulu. base package yg akan diinstall adalah</p>
<pre><code class="language-sh">sudo apt-get update &amp;&amp; \
sudo apt-get upgrade &amp;&amp; \
sudo apt-get install \
    openssh-server freeradius isc-dhcp-client
</code></pre>
<p>lalu setelah installed, kita tidak butuh iso lagi, kita bisa buang saja parameter <code>-cdrom ubuntu-24.04.2-live-server-amd64.iso</code> karna unused. dan untuk konfigurasi tambahan, saya buat pakai vga virtio (agar text nya smooth), dan juga netdev untuk colokan <code>tap1</code> yang nyambung ke bridge</p>
<pre><code class="language-sh">qemu-system-x86_64 \
    -enable-kvm \
    -boot order=d \
    -drive if=pflash,format=raw,readonly=on,file=/usr/share/edk2/x64/OVMF_CODE.4m.fd \
    -drive if=pflash,format=raw,file=OVMF_VARS_ubuntu_server_gpt.4m.fd \
    -drive file=ubuntu-server.img,format=qcow2 \
    -m 4G \
    -smp 4 \
    -netdev user,id=net0,hostfwd=tcp::20022-:22 \
    -device e1000,netdev=net0 \
    -netdev tap,id=net1,ifname=tap1,script=no,downscript=no \
    -device virtio-net-pci,netdev=net1,mac=02:11:2a:3b:aa:c4 \
    -vga virtio
</code></pre>
<p>nb: jangan lupa <code>sudo apt-get update &amp;&amp; sudo apt-get upgrade &amp;&amp; sudo apt-get install openssh-server</code>, karna di vm tidak bisa copy paste (mau dari dalam ataupun keluar), dan juga tidak bisa scroll atas bawah. maka proses me-config nya akan pakai ssh saja</p>
<p><img src="server//assets/6216af66c741aa5c444f4e3f3c92f5cd5cff2b16d84e1ce7959fb3022404de548d8e3d12b5792f871bc5d68599a8ff141d866ec9af17bdf15822e380.png" alt="image" /></p>
<p>intinya biarkan vm nya jalan begitu saja, bisa di minimize atau dipindah ke tab lain yang tidak menganggu. selanjutnya remote vm nya pakai</p>
<pre><code class="language-sh">ssh -o StrictHostKeyChecking=no -o UserKnownHostsFile=/dev/null  fadhil_riyanto@127.0.0.1 -p 20022
</code></pre>
<p>nb: ganti <code>fadhil_riyanto</code> dengan username yang sudah diset tadi</p>
<p><img src="server//assets/e1b3a2a87f2147be937d1c1604519f52d7979acf87d6ed653f1319393fa3d9099b1562a1b6d1bef94c0b907c5c142fd2f00428ddd5b6266bc854c826.png" alt="image" /></p>
<p>setidaknya seperti itu remote-an nya</p>
<h2 id="freeradius"><a class="header" href="#freeradius">freeradius</a></h2>
<p>jalankan <code>sudo apt-get install freeradius</code>, lalu test dengan <code>sudo freeradius -X</code></p>
<p><img src="server//assets/c94a211608a1db50024e52889c911f4ba6d5b894301a6c0676ce0d0529b7830a4dd824567d341d9f82c91165bcf77b1b5dfcb914183c5e466c150fa9.png" alt="image" /></p>
<p>pastikan ada tulisan ready to process request</p>
<h2 id="winbox"><a class="header" href="#winbox">winbox</a></h2>
<p>karna winbox pakai port 8291 untuk merepote mikrotik, maka kita konek dengan host 127.0.0.1:8291, password sesuai config awal mikrotik ketika awal tadi</p>
<p>winbox localhost</p>
<p><img src="server//assets/5c2d5ee56f841a1c270df51d085e5506a2582a05610927ddcd84820cd3002f689dcc4170ec3fe3af3b77ecf3e1e61d98ea2e7ca6cc5f51b3d8b9e770.png" alt="image" /></p>
<h3 id="setup-mikrotik-dhcp-server"><a class="header" href="#setup-mikrotik-dhcp-server">setup mikrotik dhcp server</a></h3>
<p>ip -&gt; address
<img src="server//assets/cdc8c75a5259e1dd336291a4d4991eb1301e32f68b5f1ac46f12d27a33c6b7716b3ef0cb260d58477d1b8d054ee449f378aeeb1e1331b5ec84b45569.png" alt="image" /></p>
<p>ip -&gt; dhcp server</p>
<p><img src="server//assets/6133719edf4cf0c1e46b9284e559fa88868cf8a60d103446d3f1d522f5754df314c82cab832272a9b683b823750ff3470e005c49780858db86e16ebc.png" alt="image" /></p>
<p><img src="server//assets/1429917ae1cc7caa5b655d3b3dc59264012d026ed3c20e1ec825d5719d6e22e81bf686ba3b9013b9a00050b6a4da887d1d9d418ddfa025c7e4e1162e.png" alt="image" /></p>
<p><img src="server//assets/321b4b134b67a9be0c091c9ae2093bbca9edb62df2799cc3b4339665e178102b8afc4e09d7125d01665356e77c2b2f9b938e3fded7bcb192445ec3ff.png" alt="image" /></p>
<p><img src="server//assets/76a1f9eae8f7a57a5d426ce2a9e5562d69d4d71237c707bb6af5cd8483dddb3fe227a9ffa0b127a91ee85b4ea4a20813b53c11f78033e5c9ba75f77d.png" alt="image" /></p>
<p><img src="server//assets/425c569d1b6df4dee6f4e64925263eda657131e8b70af0f8248a330aef0a92f514b5ae6cbcb2b5e8266ad0520b83a44ef20536490d66323dd6c80767.png" alt="image" /></p>
<p>dns server kita biarkan dahulu</p>
<p><img src="server//assets/8380a0b6d16f00b1d879e38b6bd10c71142750ae6c1df4325f6176b255f1e1e89845912464c7c3f7ee27a63bf44886982f0312807e3e038d4122c2ad.png" alt="image" /></p>
<p>pembuktian:
jalankan <code>sudo dhclient enp4</code> (karna interface tun1 dia dibaca sebagai enp4 di ubuntu server)
<img src="server//assets/2025-06-10_13-20.png" alt="image" /></p>
<p>ping ke router</p>
<p><img src="server//assets/e44475652a0685c34088f0709bbce20eb1c8e14e3ef28fdb0df1d8f8fcfaf57af06cc14d7fd57c2db2937f2969c538fb1eb922f0a3ca490246bf2744.png" alt="image" /></p>
<p>router ke ubuntu server
<img src="server//assets/cb465e579a0eb33086d6a74da97b51470a70d2d114ec5fe7c00c155c95590524e81d0eaf9036a7e973aaf58c909174d5eae9387b59e324efde5f6f47.png" alt="image" /></p>
<h2 id="setting-up-archlinux-gui"><a class="header" href="#setting-up-archlinux-gui">setting up Archlinux (GUI)</a></h2>
<p>download dahulu bahan nya di <a href="https://sourceforge.net/projects/arch-linux-gui/">https://sourceforge.net/projects/arch-linux-gui/</a>, pakai xfce (paling ringan)</p>
<p>run archlinux gui sebagai <code>tap2</code></p>
<pre><code class="language-sh">qemu-system-x86_64 \
    -enable-kvm \
    -boot order=d \
    -cdrom archlinux-gui-xfce-2022.07-x86_64.iso \
    -m 4G \
    -smp 4 \
    -netdev tap,id=net1,ifname=tap2,script=no,downscript=no \
    -device virtio-net-pci,netdev=net1,mac=02:11:5c:1b:aa:c9 \
    -vga virtio
</code></pre>
<p>catatan: macnya dikarang lagi, agar tidak sama. jika sama ternyata bakal dapat ip yang sama</p>
<p><img src="server//assets/6dbca4ece71a387364fe6d5368d8b1c6431c3d3ab2f9f366f9d34c07aa81327e44fb8b757e6ae98906cf4ae440ca26c020a249db84c78060abb37442.png" alt="image" /></p>
<p><img src="server//assets/dbadc00c801066a13f108acff5eb48186a0931e7f6071f3f8a7733406b357e6d8c9a8453fe03f60d13e85a3fa2b547591029535ce3b727720902a3a3.png" alt="image" /></p>
<p>nb: archlinux makan 2 ip karna NetworkManager dan systemd-resolved bentrok (bawaannta sepertinya). tapi harusnya no problem at all</p>
<h2 id="setup-hotspot-winbox"><a class="header" href="#setup-hotspot-winbox">setup hotspot winbox</a></h2>
<p>ip -&gt; hotspot</p>
<p><img src="server//assets/320a0dc0cd86c6f47ad63480a9570276e208c48b60099f3a320ef890aa3bb7c06604c32b157531104b5f5edc51853d2732c25403a84f737406780e31.png" alt="image" /></p>
<p>next next saja, kecuali dns nanti diisi 1.1.1.1, dan dns-name diisi nama domain untuk captive portalnya
<img src="server//assets/988a96f698f5bdbd154f04c7523e1dd24d88853b451c6e887122bbf82c54d00f86ab0f688d3303e478e9cc1c016272d84e1937049e5e454119939477.png" alt="image" /></p>
<h1 id="test-1"><a class="header" href="#test-1">test</a></h1>
<p><img src="server//assets/a402fb33b60465533c6e5bdc6762359c82f692492362ec74d96e8c440c90fba385489ba574cdfe6ed8254d4852e8ea55b368a4f5ab98d74ca75d5e30.png" alt="image" /></p>
<h2 id="karna-1921681254-ip-freeradius"><a class="header" href="#karna-1921681254-ip-freeradius">karna <code>192.168.1.254</code> ip freeradius</a></h2>
<p>maka kita ignore pakai</p>
<p><img src="server//assets/000cd141407bb54adf25c3c11ceefa575a528165b64a30e3eb444b8620b926e094dd5ef3841ff0c082def4c08b13fdf29bf9f9e1e8e1760ef739fcaf.png" alt="image" /></p>
<p>ip binding</p>
<h2 id="static-ip-versions"><a class="header" href="#static-ip-versions">static ip versions</a></h2>
<ul>
<li><code>sudo ip addr add 192.168.1.2/24 dev ens4</code></li>
<li><code>sudo ip link set dev ens4 up</code></li>
<li><code>sudo ip route append default via 192.168.1.1</code></li>
</ul>
<h1 id="freeradius-1"><a class="header" href="#freeradius-1">freeradius</a></h1>
<p>ubah <code>/etc/freeradius/3.0/clients.conf</code>, tambah</p>
<pre><code class="language-txt">client private-network-1 {
    ipaddr      = 192.192.1.1/24
    secret      = testing123
}


</code></pre>
<p>lalu <code>/etc/freeradius/3.0/users</code></p>
<pre><code class="language-txt">bob Cleartext-Password := "password"
</code></pre>
<h2 id="winbox-1"><a class="header" href="#winbox-1">winbox</a></h2>
<p><img src="server//assets/50f3df1d429445c00433163d8e1c79a253f2cef67178d21c5a811f8bd23350d9c557ba0b174c7fddcb7bbed88e3261c8ed3beb84f01932a8e3ae73fc.png" alt="image" /></p>
<p>system -&gt; AAA
<img src="server//assets/cee05007032ea0004685a07cffdffcfb957095daae4524a931d8a374c06a6ab190ce8ca75a394f33e42e58c6af012761539621bbb28e2dc1214860b6.png" alt="image" /></p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="sql-authentication-freeradius-server"><a class="header" href="#sql-authentication-freeradius-server">SQL authentication freeradius server</a></h1>
<p>first, desclaimer. I use Ubuntu 24.04.2 LTS that running on Archlinux qemu host. so this is not host machine.
big thanks for linux netdev that makes local networking possible.</p>
<p>first, lets configure postgresql server</p>
<pre><code class="language-sh">root@integral2:/home/fadhil_riyanto# su postgres
postgres@integral2:/home/fadhil_riyanto$ psql
psql (16.9 (Ubuntu 16.9-0ubuntu0.24.04.1))
Type "help" for help.

postgres=# 
</code></pre>
<h2 id="database-setup"><a class="header" href="#database-setup">database setup</a></h2>
<p>get it inside. then run</p>
<p><img src="server//assets/0b31f1fb1d97b32e112694dfd750fcc3b92093645f508ce8fa438a0db2cb899fd2f0998547e4bdc11ac18ebb15bb735e6418d9fae86960146d3acfed.png" alt="image" /></p>
<p><img src="server//assets/5fb4e7aa16213974a3e2db1bf3f1efbf60963f9489610aa012244e484c45351272758aedd68c41b79f1a4dac034c30e5fea04f1ab2caf5efe849df87.png" alt="image" /></p>
<p><img src="server//assets/7fffd04029a9a3640c8ffc737d03ef9339da23e60c7189f3a567e733c49cc24d569843fd1e7611015a05c06dd794129b7536bf92ef2e83caaddf40aa.png" alt="image" /></p>
<p><img src="server//assets/5aab65a8641c5e71d111bbb878e53009adbe5b74d8715d5adb371fd4ba81a2b0873fbed49ae237c6c816e7d779535a5c5ada5173c566ae341c83177d.png" alt="image" /></p>
<p>do not forget to allow CRUD option on all tables by running</p>
<pre><code class="language-sql">\c radius
GRANT ALL PRIVILEGES ON ALL TABLES IN SCHEMA public TO radius;
</code></pre>
<h2 id="radius-server-configuration"><a class="header" href="#radius-server-configuration">radius server configuration</a></h2>
<p>the sequence of config file</p>
<ul>
<li><code>/etc/freeradius/3.0/clients.conf</code> &lt;-- specify 'who' can connect, we need define it in this file</li>
<li><code>/etc/freeradius/3.0/users</code> &lt;-- [manual authentication, using file]</li>
<li><code>/etc/freeradius/3.0/radiusd.conf:986</code> &lt;-- this file enable sql module.</li>
<li><code>/etc/freeradius/3.0/mods-available/sql</code> &lt;-- this file is where we configure user/pass for sql module</li>
<li><code>/etc/freeradius/3.0/sites-available/default</code> &lt;-- sequence layer of login,
<ul>
<li>first, we filter-out all args</li>
<li>then go to preprocess</li>
<li>send to log</li>
<li>chap &amp; mschap</li>
<li>check whatever has digest</li>
<li>check whatever user@domain format</li>
<li>eap</li>
<li>files</li>
<li>lookup to sql &lt;-- uncomment this</li>
</ul>
</li>
</ul>
<p>as root</p>
<ul>
<li><code>/etc/freeradius/3.0/mods-enabled</code></li>
<li><code>ln -s ../mods-available/sql ./sql</code></li>
<li>uncomment this line in radiusd.conf
<img src="server//assets/d0665ba7eb645242c298dedbe2902e18796c7216dc8896139a721fab2415fa7611195ab9422d6948f86a427b9707e760fc0221f88fc230a67758b76d.png" alt="image" /></li>
<li>change this line to postgresql (mods-enabled/sql)
<img src="server//assets/fdfd7b497384b6a5c5987b572b67fa8568798a334fadc2019039dcf90b8b6d534905f22318cf4c7af41a02ab7e2343f119de684f3044167e957c3196.png" alt="image" /></li>
</ul>
<p>also
<img src="server//assets/8d2a7f06a33c1eb1cd47bb7d3668d313b43431c18415335eecfbd41e24ea23ebaaf5ca351afa0987d3fa16a05fa05bb81f1324b17d8e7ef5abc916b4.png" alt="image" /></p>
<ul>
<li>fill the pgsql server credentials (/etc/freeradius/3.0/mods-config/sql/main/postgresql/queries.conf) (aka raddb/sql/database/dialup.conf in rhel)</li>
</ul>
<p><img src="server//assets/88a6744259611366420a5d727c6d0340d810087dab0abf04c70d2e2470cb06d85a74c82608b32feda254e2b333978fdcb4120294454460480cb4e270.png" alt="image" /></p>
<h3 id="when-connection-failed"><a class="header" href="#when-connection-failed">when connection failed</a></h3>
<p><img src="server//assets/9717e76d53ae41ea098987ea8dfb4bbe936527330f4c1b9fb7aed97549ddb79ef0ef21a1663f8d9297537cc60cb768258b9a9fd4c959a1e48539bab6.png" alt="image" /></p>
<h3 id="when-connection-succeed"><a class="header" href="#when-connection-succeed">when connection succeed</a></h3>
<p><img src="server//assets/4591156b3d62c9d877f6ae8def706c382955e5c8440c902c5098eac584894d6d24b8218338280b7b701156eec3cb480dacdbaac0b8947828932c72b0.png" alt="image" /></p>
<h1 id="populating"><a class="header" href="#populating">populating</a></h1>
<p>best read: <a href="https://wiki.freeradius.org/guide/SQL-HOWTO#populating-sql">https://wiki.freeradius.org/guide/SQL-HOWTO#populating-sql</a></p>
<p>big thanks for freeradius developer, the sql file is located at <code>/etc/freeradius/3.0/mods-config/sql/main/postgresql/schema.sql</code></p>
<p>import it with:</p>
<pre><code class="language-sql">psql -U radius -d radius -f /etc/freeradius/3.0/mods-config/sql/main/postgresql/schema.sql
</code></pre>
<h1 id="configuration"><a class="header" href="#configuration">configuration</a></h1>
<p>lets look at <code>sites-available/default</code></p>
<p><img src="server//assets/b609f49cbcdf2c21d6291c8b173e74b9b8ff663c18c5bd1314fd3ec7eae39ec65ef238a89d9522f8ded12b3bd6ff1a0bcb2b6ce5fc5bc70146bb82f3.png" alt="image" /></p>
<p>this configuration only allow authorize users that come from NAS-Port-Type == "Wireless-802.11", this is the difference</p>
<p>footage 1: from winbox request
<img src="server//assets/599e5f76e91856db04f9d4cbdadd0d4c4384d7e073c91fa187c4754eefc83424ec9ecb304d5f166ae2204b4b6c471aa531e2b41045cb487d17e7440d.png" alt="image" /></p>
<p>this one come from captive portal
<img src="server//assets/b3d083c9d4dd4f95275e637bbf7a9a401086cd7bce221b536e1c500bf734d96647b0171dbca68e2d0e69fa23855bde1d9c4336f32c95289db615dcc3.png" alt="image" /></p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="linux-netplan"><a class="header" href="#linux-netplan">Linux netplan</a></h1>
<p>ref: <a href="https://documentation.ubuntu.com/server/explanation/networking/configuring-networks/">https://documentation.ubuntu.com/server/explanation/networking/configuring-networks/</a></p>
<p>example</p>
<pre><code class="language-yaml">network:
  version: 2
  ethernets:
    ens3:
      dhcp4: true
    ens4:
      addresses:
        - 192.168.1.2/24
      routes:
        - to: default
          via: 192.168.1.1
</code></pre>
<p>location: <code>/etc/netplan</code>
note: execution is ordered by file name</p>
<p>then run <code>sudo netplan generate</code></p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="sshfs"><a class="header" href="#sshfs">sshfs</a></h1>
<p>the setup is very easy</p>
<ul>
<li>in your home, run <code>mkdir mount</code></li>
<li><code>mkdir vm_001_ubuntu</code> or whatever</li>
<li>mount it <code>sshfs root@127.0.0.1:/ -p 20022 ./vm_001_ubuntu</code></li>
<li>verify with <code>findmnt</code></li>
</ul>
<p>enjoy</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="tldr-qemu"><a class="header" href="#tldr-qemu">TLDR qemu</a></h1>
<p>buat file namanya <code>setup-network.sh</code>, lalu isi dengan</p>
<pre><code class="language-sh">sudo ip link add br0-lan type bridge
sudo ip tuntap add tap0 mode tap
sudo ip tuntap add tap1 mode tap
sudo ip tuntap add tap2 mode tap

sudo ip link set tap0 master br0-lan
sudo ip link set tap1 master br0-lan
sudo ip link set tap2 master br0-lan

sudo ip link set br0-lan up
sudo ip link set tap0 up
sudo ip link set tap1 up
sudo ip link set tap2 up

sudo ip a

</code></pre>
<p>lalu lakukan ini agar bisa di exec via terminal</p>
<ul>
<li><code>sudo chmod 666 setup-network.sh</code></li>
<li><code>sh ./setup-network.sh</code></li>
</ul>
<h1 id="running-qemu"><a class="header" href="#running-qemu">running qemu</a></h1>
<p>run routerOS</p>
<pre><code class="language-sh"># download dahulu chr-7.19.1.img dari web resminya
qemu-img convert -f raw -O qcow2 chr-7.19.1.img chr7.qcow2

# run chr
# port yang dipakai
# - 8291: untuk winbox
# - 30022: untuk keperluan sftp, utak atik file hotspot nya
qemu-system-x86_64 \
	-enable-kvm \
	-smp 4 \
	-m 256M \
	-drive file=chr7.qcow2,format=qcow2 \
	-boot order=d \
	-net user,hostfwd=tcp::8291-:8291,hostfwd=tcp::30022-:22 \
	-net nic \
	-nographic \
	-netdev tap,id=net0,ifname=tap0,script=no,downscript=no \
	-device virtio-net-pci,netdev=net0,mac=02:11:2a:3b:ff:c3
</code></pre>
<h1 id="ubuntu-server"><a class="header" href="#ubuntu-server">ubuntu server</a></h1>
<p>buat image (HDD virtual untuk os kita nanti)</p>
<pre><code class="language-sh">qemu-img create -f qcow2 ubuntu-server.img 15G
</code></pre>
<p>run iso (saat install)</p>
<pre><code class="language-sh">qemu-system-x86_64 \
	-enable-kvm \
	-boot order=d \
	-cdrom GANTI_NAMA_ISO_UBUNTU.iso \
	-drive file=ubuntu-server.img,format=qcow2 \
	-m 4G \
	-smp 4 \
	-netdev user,id=net0,hostfwd=tcp::20022-:22,hostfwd=tcp::10000-:5432 \
	-device e1000,netdev=net0 \
	-netdev tap,id=net1,ifname=tap1,script=no,downscript=no \
	-device virtio-net-pci,netdev=net1,mac=02:11:2a:3b:aa:c4 \
	-vga virtio
</code></pre>
<p>lalu run hasil image (Default no graphic, jadi ntar kita ssh pakai <code>ssh -p 20022 root@127.0.0.1</code> biar bisa copas)</p>
<p>dan juga kita optimalisasi dengan cara pakai nographic, tanpa cdrom, map port yang dibutuhkan saja</p>
<p>port yg di forward:</p>
<ul>
<li>20022: untuk remote</li>
<li>10302: untuk keperluan ngoding laravel</li>
<li>10000: untuk keperluan postgresql, siapa tahu mau di remote via adminer, pgadmin dari local, atau cuman psql dll</li>
</ul>
<pre><code class="language-sh">qemu-system-x86_64 \
	-enable-kvm \
	-boot order=d \
	-drive file=ubuntu-server.img,format=qcow2 \
	-m 4G \
	-smp 4 \
	-netdev user,id=net0,hostfwd=tcp::20022-:22,hostfwd=tcp::10302-:10302,hostfwd=tcp::10000-:5432 \
	-device e1000,netdev=net0 \
	-netdev tap,id=net1,ifname=tap1,script=no,downscript=no \
	-device virtio-net-pci,netdev=net1,mac=02:11:2a:3b:aa:c4 \
	-vga virtio \
	-nographic
</code></pre>
<p>VPS KVM siap jadi bahan ujicoba, langsung test saja ke <code>ssh -p 20022 root@127.0.0.1</code></p>
<h1 id="experimental-jangan-dipakai--do-not-use"><a class="header" href="#experimental-jangan-dipakai--do-not-use">experimental (jangan dipakai / do not use)</a></h1>
<p>untuk catatan pribadi bahan experimental UEFI, KVM, sama custom machine q35</p>
<h1 id="experimental-1-safest"><a class="header" href="#experimental-1-safest">experimental 1 (safest)</a></h1>
<pre><code class="language-sh">qemu-system-x86_64 \
    -name guest=ubuntu22.04,debug-threads=on \
    -machine type=pc,accel=kvm \
    -cpu host \
    -enable-kvm \
    -boot order=d \
    -drive if=pflash,format=raw,readonly=on,file=/usr/share/edk2/x64/OVMF_CODE.4m.fd \
    -drive if=pflash,format=raw,file=OVMF_VARS_ubuntu_server_gpt.4m.fd \
    -drive file=ubuntu-server.img,format=qcow2 \
    -m 4G \
    -smp 4 \
    -netdev user,id=net0,hostfwd=tcp::20022-:22,hostfwd=tcp::10000-:5432 \
    -device virtio-net-pci,netdev=net0 \
    -netdev tap,id=net1,ifname=tap1,script=no,downscript=no \
    -device virtio-net-pci,netdev=net1,mac=02:11:2a:3b:aa:c4

</code></pre>
<p>dgn iso</p>
<pre><code class="language-sh">qemu-system-x86_64 \
	-name guest=ubuntu22.04,debug-threads=on \
	-machine type=pc,accel=kvm \
	-cpu host \
	-enable-kvm \
	-boot order=d \
	-cdrom a.iso \
	-drive if=pflash,format=raw,readonly=on,file=/usr/share/edk2/x64/OVMF_CODE.4m.fd \
	-drive if=pflash,format=raw,file=OVMF_VARS_ubuntu_server_gpt.4m.fd \
	-drive file=ubuntu-server.img,format=qcow2 \
	-m 4G \
	-smp 4 \
	-netdev user,id=net0,hostfwd=tcp::20022-:22,hostfwd=tcp::10302-:10302,hostfwd=tcp::10000-:5432 \
	-device e1000,netdev=net0 \
	-netdev tap,id=net1,ifname=tap1,script=no,downscript=no \
	-device virtio-net-pci,netdev=net1,mac=02:11:2a:3b:aa:c4 \
	-vga virtio
</code></pre>
<p>custom machine chipset PC, KVM, UEFI headless</p>
<pre><code class="language-sh">qemu-system-x86_64 \
	-name guest=ubuntu22.04,debug-threads=on \
	-machine type=pc,accel=kvm \
	-cpu host \
	-enable-kvm \
	-boot order=d \
	-drive if=pflash,format=raw,readonly=on,file=/usr/share/edk2/x64/OVMF_CODE.4m.fd \
	-drive if=pflash,format=raw,file=OVMF_VARS_ubuntu_server_gpt.4m.fd \
	-drive file=ubuntu-server.img,format=qcow2 \
	-m 4G \
	-smp 4 \
	-netdev user,id=net0,hostfwd=tcp::20022-:22,hostfwd=tcp::10302-:10302,hostfwd=tcp::10000-:5432 \
	-device e1000,netdev=net0 \
	-netdev tap,id=net1,ifname=tap1,script=no,downscript=no \
	-device virtio-net-pci,netdev=net1,mac=02:11:2a:3b:aa:c4 \
	-vga virtio \
	-nographic
</code></pre>
<p>working (part 2)</p>
<pre><code class="language-sh">qemu-system-x86_64 \
          -enable-kvm \
          -boot order=d \
          -drive if=pflash,format=raw,readonly=on,file=/usr/share/edk2/x64/OVMF_CODE.4m.fd \
          -drive if=pflash,format=raw,file=OVMF_VARS_ubuntu_server_gpt.4m.fd \
          -drive file=ubuntu-server.img,format=qcow2 \
          -m 4G \
          -smp 4 \
          -netdev user,id=net0,hostfwd=tcp::20022-:22,hostfwd=tcp::10000-:5432 \
          -device e1000,netdev=net0 \
          -netdev tap,id=net1,ifname=tap1,script=no,downscript=no \
          -device virtio-net-pci,netdev=net1,mac=02:11:2a:3b:aa:c4 \
          -vga virtio

</code></pre>
<p>no iso (headless)</p>
<pre><code class="language-sh">qemu-system-x86_64 \
	-name guest=ubuntu22.04,debug-threads=on \
	-machine type=q35,accel=kvm \
	-cpu host \
	-enable-kvm \
	-boot order=d \
	-drive if=pflash,format=raw,readonly=on,file=/usr/share/edk2/x64/OVMF_CODE.4m.fd \
	-drive if=pflash,format=raw,file=OVMF_VARS_ubuntu_server_gpt.4m.fd \
	-drive file=ubuntu-server.img,format=qcow2 \
	-m 4G \
	-smp 4 \
	-netdev user,id=net0,hostfwd=tcp::20022-:22,hostfwd=tcp::10000-:5432 \
	-device e1000,netdev=net0 \
	-netdev tap,id=net1,ifname=tap1,script=no,downscript=no \
	-device virtio-net-pci,netdev=net1,mac=02:11:2a:3b:aa:c4
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="qemu-q35-vs-i440fx"><a class="header" href="#qemu-q35-vs-i440fx">qemu q35 vs i440fx</a></h1>
<h1 id="q35"><a class="header" href="#q35">q35</a></h1>
<p>this is lspci output from ubuntu server</p>
<p><img src="server//assets/8c531e238d5e74cca661ec7c1ce674003edc513ac3918c5a8c51d0630c208ac312febbddcab71736d49725ab0ccec1325a5802a3557607c04704ac4b.png" alt="image" /></p>
<h1 id="i440fx"><a class="header" href="#i440fx">i440fx</a></h1>
<p><img src="server//assets/38c547bee31795b4bf3cc8f09e815bfe96c1fe6962b2e9310dd5b001dce4ad4a527603935dde4fa453a218d23e1fa4aa41b97476cb788164f86f2acf.png" alt="image" /></p>
<p>http://wiki.qemu.org/images/4/4e/Q35.pdf</p>
<p>http://wiki.qemu.org/images/f/f6/PCIvsPCIe.pdf</p>
<p>http://git.qemu.org/?p=qemu.git;a=blob;f=docs/pcie.txt</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="qemu--dedicated-nic--macvtap"><a class="header" href="#qemu--dedicated-nic--macvtap">qemu &amp; dedicated nic + macvtap</a></h1>
<p>docs ini memahas solusi agar bisa akses tap (dari vm) tetapi hw yang diakses adalah nic asli, diusahakan tanpa bridge dan NAT NAT</p>
<p>ADA 2 strategi</p>
<ul>
<li>add iface fisik ke bridge, lalu attach bridge tersebut ke vm.</li>
<li>pakai macvtap, dengan cara meredirect packet yang datang, ke arah tap device menggunakan fd (file descriptor). kita akan (ab)use option <code>-net</code> tap di qemu</li>
</ul>
<p>strategi lain (tidak direkomendasikan, diluar topik macvtap)</p>
<ul>
<li>membuat virtual eth pair, redirect pakai iptables</li>
<li>pakai -netdev user (somewhat slow, need triage)</li>
</ul>
<h1 id="normal"><a class="header" href="#normal">normal</a></h1>
<p>bagian ini tanpa macvtap ataupun hal hal lain dahulu, pure qemu bridging</p>
<p>configuration</p>
<ul>
<li>eth1: mostly WAN</li>
<li>eth2: tap</li>
</ul>
<pre><code class="language-sh">qemu-system-x86_64 \
    -enable-kvm \
    -smp 4 -m 256M \
    -drive file=chr7.qcow2,format=qcow2 \
    -boot order=d \
    -net user,hostfwd=tcp::8291-:8291,hostfwd=tcp::10022-:22 \
    -net nic \
    -netdev tap,id=net0,ifname=tap0,script=no,downscript=no \
    -device virtio-net-pci,netdev=net0,mac=02:11:2a:3b:ff:c3 \
    -nographic
</code></pre>
<pre><code class="language-sh">qemu-system-x86_64 \
	-name guest=ubuntu22.04 \
	-machine type=pc,accel=kvm \
	-cpu host -m 4G -smp 4 \
	-enable-kvm \
	-boot order=d \
	-drive if=pflash,format=raw,readonly=on,file=/usr/share/edk2/x64/OVMF_CODE.4m.fd \
	-drive if=pflash,format=raw,file=OVMF_VARS_ubuntu_server_gpt.4m.fd \
	-drive file=ubuntu-server.img,format=qcow2 \
	-netdev user,id=net0,hostfwd=tcp::20022-:22,hostfwd=tcp::10000-:5432,hostfwd=tcp::10302-:10302 \
	-device virtio-net-pci,netdev=net0 \
	-netdev tap,id=net1,ifname=tap1,script=no,downscript=no \
	-device virtio-net-pci,netdev=net1,mac=02:11:2a:3b:aa:c4 \
	-nographic
</code></pre>
<p>network stack note:</p>
<ul>
<li>ens3: come from qemu bridge (for ssh purpose)</li>
<li>ens4: come from tap1 (connected to bridge, internal lan)</li>
</ul>
<p>netplan configuration</p>
<pre><code class="language-yaml">network:
  version: 2
  ethernets:
    ens4:
      addresses:
        - 192.168.1.2/24
      routes:
        - to: default
          via: 192.168.1.1
    ens3:
      dhcp4: true
</code></pre>
<pre><code class="language-sh">// ip a 

2: ens3: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc fq_codel state UP group default qlen 1000
    link/ether 52:54:00:12:34:56 brd ff:ff:ff:ff:ff:ff
    altname enp0s3
    inet 10.0.2.15/24 metric 100 brd 10.0.2.255 scope global dynamic ens3
       valid_lft 86314sec preferred_lft 86314sec
    inet6 fec0::5054:ff:fe12:3456/64 scope site dynamic mngtmpaddr noprefixroute 
       valid_lft 86317sec preferred_lft 14317sec
    inet6 fe80::5054:ff:fe12:3456/64 scope link 
       valid_lft forever preferred_lft forever
3: ens4: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc fq_codel state UP group default qlen 1000
    link/ether 02:11:2a:3b:aa:c4 brd ff:ff:ff:ff:ff:ff
    altname enp0s4
    inet 192.168.1.2/24 brd 192.168.1.255 scope global ens4
       valid_lft forever preferred_lft forever
    inet6 fe80::11:2aff:fe3b:aac4/64 scope link 
       valid_lft forever preferred_lft forever

</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="alpine-install-ssh--firefox-lite-qemu"><a class="header" href="#alpine-install-ssh--firefox-lite-qemu">alpine install SSH + firefox lite qemu</a></h1>
<h2 id="create-image"><a class="header" href="#create-image">create image</a></h2>
<pre><code class="language-sh">qemu-img create -f qcow2 alpine-client.qcow2 2G
</code></pre>
<h2 id="run"><a class="header" href="#run">RUN</a></h2>
<p>THIS is dry run</p>
<pre><code class="language-sh">qemu-system-x86_64 \
	-enable-kvm \
	-m 1G -smp 4 -cpu host \
	-boot d \
	-drive file=alpine-client.qcow2,format=qcow2 \
	-cdrom ./iso/alpine-virt-3.21.3-x86_64.iso \
	-netdev user,id=net0,hostfwd=tcp::30022-:22 \
	-device virtio-net-pci,netdev=net0
	-vga virtio
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="resizing-qemu-image"><a class="header" href="#resizing-qemu-image">resizing qemu image</a></h1>
<p>lets add 10 GiB</p>
<pre><code class="language-sh">qemu-img resize ubuntu-server.img +10G
</code></pre>
<p>then</p>
<p><img src="server//assets/184aa9877fe42d187e0b75e010695b33809a7f5245f90e087adcfa877be2cd55c8bb193f90bd86b497e97884c6aa5d2b04423fb87d92e639ce121671.png" alt="image" /></p>
<p>nice work!</p>
<h1 id="fixing"><a class="header" href="#fixing">fixing</a></h1>
<p>if your ubuntu use LVM2, Use this command</p>
<p><img src="server//assets/1845e6740dc67207974700ee9a9583d8cd4d4056d4be06a3fdacd31643a1c6585009adc6f696bd47113242084f2f30307415a32464b5f709122c2216.png" alt="image" /></p>
<p>then, run</p>
<pre><code class="language-sh">sudo lvextend -l +100%FREE /dev/ubuntu-vg/ubuntu-lv
sudo e2fsck -f /dev/ubuntu-vg/ubuntu-lv
sudo resize2fs /dev/ubuntu-vg/ubuntu-lv
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="docker-snippets"><a class="header" href="#docker-snippets">docker snippets</a></h1>
<h2 id="docker-run"><a class="header" href="#docker-run">docker run</a></h2>
<p>this command will run as daemon, from image <code>freeradius/freeradius-server</code></p>
<pre><code class="language-sh">docker run --name my-radius -d freeradius/freeradius-server
</code></pre>
<p>no daemon involved</p>
<pre><code class="language-sh">docker run --name my-radius freeradius/freeradius-server
</code></pre>
<h1 id="logging-running-container"><a class="header" href="#logging-running-container">logging running container</a></h1>
<pre><code class="language-sh">docker logs my-radius
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="install-routerosiso-not-chr-on-qemu"><a class="header" href="#install-routerosiso-not-chr-on-qemu">install routerOS.iso (not chr) on qemu</a></h1>
<p>please download this <a href="https://download.mikrotik.com/routeros/7.19.3/mikrotik-7.19.3.iso">https://download.mikrotik.com/routeros/7.19.3/mikrotik-7.19.3.iso</a>, <a href="https://mikrotik.com/download">https://mikrotik.com/download</a></p>
<p>select x86</p>
<p>after that, run this command (dry run)</p>
<pre><code class="language-sh">qemu-img create -f qcow2 mikrotik-7.qcow2 4G
</code></pre>
<p>install</p>
<pre><code class="language-sh">qemu-system-x86_64 \
      -enable-kvm \
      -smp 4 -m 256M \
      -drive file=mikrotik-7.qcow2,format=qcow2 \
      -boot order=d \
      -cdrom ./iso/mikrotik-7.19.3.iso \
      -net user,hostfwd=tcp::8291-:8291,hostfwd=tcp::10022-:22 \
      -net nic
</code></pre>
<p>select wireless, and system</p>
<p>after that, run this</p>
<pre><code class="language-sh">wget https://gist.githubusercontent.com/fadhil-riyanto/d370c3551426ced874f7c0e0e6f62800/raw/9ef4886bcb5c49137b47a2ce60f49a840751e753/setup-network.sh &amp;&amp; chmod 777 setup-network.sh &amp;&amp; sudo sh setup-network.sh
</code></pre>
<p>now, we have virtual lan that uses tun-tap network. now run chr on <code>tap0</code></p>
<pre><code class="language-sh">qemu-system-x86_64 \
      -enable-kvm \
      -smp 4 -m 256M \
      -drive file=mikrotik-7.qcow2,format=qcow2 \
      -boot order=d \
      -netdev user,id=net0,hostfwd=tcp::8291-:8291,hostfwd=tcp::10022-:22 \
      -device virtio-net-pci,netdev=net0 \
      -netdev tap,id=net1,ifname=tap1,script=no,downscript=no \
      -device virtio-net-pci,netdev=net1,mac=02:11:2a:3b:aa:c4 \
      -nographic
</code></pre>
<h1 id="post-install"><a class="header" href="#post-install">post install</a></h1>
<p>do not forget to enable DHCP in order to get internet from qemu internal routes</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="database"><a class="header" href="#database">Database</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="psql-command"><a class="header" href="#psql-command">psql command</a></h1>
<h2 id="general"><a class="header" href="#general">General</a></h2>
<ul>
<li><code>\bind</code> [PARAM]...       set query parameters</li>
<li><code>\copyright</code>             show PostgreSQL usage and distribution terms</li>
<li><code>\crosstabview</code> [COLUMNS] execute query and display result in crosstab</li>
<li><code>\errverbose</code>            show most recent error message at maximum verbosity</li>
<li><code>\g</code> [(OPTIONS)] [FILE]  execute query (and send result to file or |pipe);
<code>\g</code> with no arguments is equivalent to a semicolon</li>
<li><code>\gdesc</code>                 describe result of query, without executing it</li>
<li><code>\gexec</code>                 execute query, then execute each value in its result</li>
<li><code>\gset</code> [PREFIX]         execute query and store result in psql variables</li>
<li><code>\gx</code> [(OPTIONS)] [FILE] as <code>\g</code>, but forces expanded output mode</li>
<li><code>\q</code>                     quit psql</li>
<li><code>\watch</code> [[i=]SEC] [c=N] [m=MIN]
execute query every SEC seconds, up to N times,
stop if less than MIN rows are returned</li>
</ul>
<h2 id="help"><a class="header" href="#help">Help</a></h2>
<ul>
<li><code>\?</code> [commands]          show help on backslash commands</li>
<li><code>\?</code> options             show help on psql command-line options</li>
<li><code>\?</code> variables           show help on special variables</li>
<li><code>\h</code> [NAME]              help on syntax of SQL commands, * for all commands</li>
</ul>
<h2 id="query-buffer"><a class="header" href="#query-buffer">Query Buffer</a></h2>
<ul>
<li><code>\e</code> [FILE] [LINE]       edit the query buffer (or file) with external editor</li>
<li><code>\ef</code> [FUNCNAME [LINE]]  edit function definition with external editor</li>
<li><code>\ev</code> [VIEWNAME [LINE]]  edit view definition with external editor</li>
<li><code>\p</code>                     show the contents of the query buffer</li>
<li><code>\r</code>                     reset (clear) the query buffer</li>
<li><code>\s</code> [FILE]              display history or save it to file</li>
<li><code>\w</code> FILE                write query buffer to file</li>
</ul>
<h2 id="inputoutput"><a class="header" href="#inputoutput">Input/Output</a></h2>
<ul>
<li><code>\copy</code> ...              perform SQL COPY with data stream to the client host</li>
<li><code>\echo</code> [-n] [STRING]    write string to standard output (-n for no newline)</li>
<li><code>\i</code> FILE                execute commands from file</li>
<li><code>\ir</code> FILE               as \i, but relative to location of current script</li>
<li><code>\o</code> [FILE]              send all query results to file or |pipe</li>
<li><code>\qecho</code> [-n] [STRING]   write string to \o output stream (-n for no newline)</li>
<li><code>\warn</code> [-n] [STRING]    write string to standard error (-n for no newline)</li>
</ul>
<h2 id="conditional"><a class="header" href="#conditional">Conditional</a></h2>
<ul>
<li><code>\if</code> EXPR               begin conditional block</li>
<li><code>\elif</code> EXPR             alternative within current conditional block</li>
<li><code>\else</code>                  final alternative within current conditional block</li>
<li><code>\endif</code>                 end conditional block</li>
</ul>
<h2 id="informational"><a class="header" href="#informational">Informational</a></h2>
<p>(options: S = show system objects, + = additional detail)</p>
<ul>
<li>\d[S+]                 list tables, views, and sequences</li>
<li>\d[S+]  NAME           describe table, view, sequence, or index</li>
<li>\da[S]  [PATTERN]      list aggregates</li>
<li>\dA[+]  [PATTERN]      list access methods</li>
<li>\dAc[+] [AMPTRN [TYPEPTRN]]  list operator classes</li>
<li>\dAf[+] [AMPTRN [TYPEPTRN]]  list operator families</li>
<li>\dAo[+] [AMPTRN [OPFPTRN]]   list operators of operator families</li>
<li>\dAp[+] [AMPTRN [OPFPTRN]]   list support functions of operator families</li>
<li>\db[+]  [PATTERN]      list tablespaces</li>
<li>\dc[S+] [PATTERN]      list conversions</li>
<li>\dconfig[+] [PATTERN]  list configuration parameters</li>
<li>\dC[+]  [PATTERN]      list casts</li>
<li>\dd[S]  [PATTERN]      show object descriptions not displayed elsewhere</li>
<li>\dD[S+] [PATTERN]      list domains</li>
<li>\ddp    [PATTERN]      list default privileges</li>
<li>\dE[S+] [PATTERN]      list foreign tables</li>
<li>\des[+] [PATTERN]      list foreign servers</li>
<li>\det[+] [PATTERN]      list foreign tables</li>
<li>\deu[+] [PATTERN]      list user mappings</li>
<li>\dew[+] [PATTERN]      list foreign-data wrappers</li>
<li>\df[anptw][S+] [FUNCPTRN [TYPEPTRN ...]]
list [only agg/normal/procedure/trigger/window] functions</li>
<li>\dF[+]  [PATTERN]      list text search configurations</li>
<li>\dFd[+] [PATTERN]      list text search dictionaries</li>
<li>\dFp[+] [PATTERN]      list text search parsers</li>
<li>\dFt[+] [PATTERN]      list text search templates</li>
<li>\dg[S+] [PATTERN]      list roles</li>
<li>\di[S+] [PATTERN]      list indexes</li>
<li>\dl[+]                 list large objects, same as \lo_list</li>
<li>\dL[S+] [PATTERN]      list procedural languages</li>
<li>\dm[S+] [PATTERN]      list materialized views</li>
<li>\dn[S+] [PATTERN]      list schemas</li>
<li>\do[S+] [OPPTRN [TYPEPTRN [TYPEPTRN]]]
list operators</li>
<li>\dO[S+] [PATTERN]      list collations</li>
<li>\dp[S]  [PATTERN]      list table, view, and sequence access privileges</li>
<li>\dP[itn+] [PATTERN]    list [only index/table] partitioned relations [n=nested]</li>
<li>\drds [ROLEPTRN [DBPTRN]] list per-database role settings</li>
<li>\drg[S] [PATTERN]      list role grants</li>
<li>\dRp[+] [PATTERN]      list replication publications</li>
<li>\dRs[+] [PATTERN]      list replication subscriptions</li>
<li>\ds[S+] [PATTERN]      list sequences</li>
<li>\dt[S+] [PATTERN]      list tables</li>
<li>\dT[S+] [PATTERN]      list data types</li>
<li>\du[S+] [PATTERN]      list roles</li>
<li>\dv[S+] [PATTERN]      list views</li>
<li>\dx[+]  [PATTERN]      list extensions</li>
<li>\dX     [PATTERN]      list extended statistics</li>
<li>\dy[+]  [PATTERN]      list event triggers</li>
<li>\l[+]   [PATTERN]      list databases</li>
<li>\sf[+]  FUNCNAME       show a function's definition</li>
<li>\sv[+]  VIEWNAME       show a view's definition</li>
<li>\z[S]   [PATTERN]      same as \dp</li>
</ul>
<h2 id="large-objects"><a class="header" href="#large-objects">Large Objects</a></h2>
<ul>
<li>\lo_export LOBOID FILE write large object to file</li>
<li>\lo_import FILE [COMMENT]
read large object from file</li>
<li>\lo_list[+]            list large objects</li>
<li>\lo_unlink LOBOID      delete a large object</li>
</ul>
<h2 id="formatting"><a class="header" href="#formatting">Formatting</a></h2>
<ul>
<li>\a                     toggle between unaligned and aligned output mode</li>
<li>\C [STRING]            set table title, or unset if none</li>
<li>\f [STRING]            show or set field separator for unaligned query output</li>
<li>\H                     toggle HTML output mode (currently off)</li>
<li>\pset [NAME [VALUE]]   set table output option
(border|columns|csv_fieldsep|expanded|fieldsep|
fieldsep_zero|footer|format|linestyle|null|
numericlocale|pager|pager_min_lines|recordsep|
recordsep_zero|tableattr|title|tuples_only|
unicode_border_linestyle|unicode_column_linestyle|
unicode_header_linestyle|xheader_width)</li>
<li>\t [on|off]            show only rows (currently off)</li>
<li>\T [STRING]            set HTML <table> tag attributes, or unset if none</li>
<li>\x [on|off|auto]       toggle expanded output (currently off)</li>
</ul>
<h2 id="connection"><a class="header" href="#connection">Connection</a></h2>
<ul>
<li>\c[onnect] {[DBNAME|- USER|- HOST|- PORT|-] | conninfo}
connect to new database (currently "fadev_infra")</li>
<li>\conninfo              display information about current connection</li>
<li>\encoding [ENCODING]   show or set client encoding</li>
<li>\password [USERNAME]   securely change the password for a user</li>
</ul>
<h2 id="operating-system"><a class="header" href="#operating-system">Operating System</a></h2>
<ul>
<li>\cd [DIR]              change the current working directory</li>
<li>\getenv PSQLVAR ENVVAR fetch environment variable</li>
<li>\setenv NAME [VALUE]   set or unset environment variable</li>
<li>\timing [on|off]       toggle timing of commands (currently off)</li>
<li>! [COMMAND]           execute command in shell or start interactive shell</li>
</ul>
<h2 id="variables"><a class="header" href="#variables">Variables</a></h2>
<ul>
<li>\prompt [TEXT] NAME    prompt user to set internal variable</li>
<li>\set [NAME [VALUE]]    set internal variable, or list all if no parameters</li>
<li>\unset NAME            unset (delete) internal variable</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="psql-snippet"><a class="header" href="#psql-snippet">psql snippet</a></h1>
<h2 id="psql"><a class="header" href="#psql">psql</a></h2>
<ul>
<li><code>\df *.*</code> Lists all relations</li>
<li><code>\l</code> Lists all database</li>
</ul>
<h2 id="command"><a class="header" href="#command">command</a></h2>
<ul>
<li><code>DROP TABLE table_name CASCADE;</code> used when you want to remove all object depend on them.</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="postgresql-database-creation-flow"><a class="header" href="#postgresql-database-creation-flow">PostgreSQL database creation flow</a></h1>
<p>in order to create database (for safety, I use postgres account). I use this step.</p>
<p>first, we need to login as <code>postgres</code> user, use this <code>sudo -u postgres psql</code>, then do</p>
<pre><code class="language-sql">CREATE DATABASE EXAMPLE_DB;
</code></pre>
<p>this is optional</p>
<pre><code class="language-sql">CREATE USER EXAMPLE_USER WITH ENCRYPTED PASSWORD 'Sup3rS3cret';
</code></pre>
<p>grant</p>
<pre><code class="language-sql">GRANT ALL PRIVILEGES ON DATABASE EXAMPLE_DB TO EXAMPLE_USER;
</code></pre>
<p>now, change the state using <code>\c EXAMPLE_DB postgres</code>, execute this command</p>
<pre><code class="language-sql">GRANT ALL ON SCHEMA public TO EXAMPLE_USER;
</code></pre>
<p>then, change ownership</p>
<pre><code class="language-sql">ALTER DATABASE my_database OWNER TO my_database_user;
</code></pre>
<p>notes: <a href="https://stackoverflow.com/questions/67276391/why-am-i-getting-a-permission-denied-error-for-schema-public-on-pgadmin-4">https://stackoverflow.com/questions/67276391/why-am-i-getting-a-permission-denied-error-for-schema-public-on-pgadmin-4</a></p>
<h1 id="reverse"><a class="header" href="#reverse">reverse</a></h1>
<p>first, we change to postgres account</p>
<pre><code class="language-sh">su postgres
</code></pre>
<p>list database: \l</p>
<p>remove:</p>
<pre><code class="language-sql">DROP DATABASE abc;
</code></pre>
<p>drop user, first list users first: <code>\du+</code></p>
<p>drop:</p>
<pre><code class="language-sql">DROP USER IF EXISTS foobar;
</code></pre>
<p>revoking access:</p>
<pre><code class="language-sql">REVOKE ALL PRIVILEGES ON SCHEMA public FROM foobar;

-- for tables, seq, and func
REVOKE ALL PRIVILEGES ON ALL TABLES IN SCHEMA public FROM foobar;
REVOKE ALL PRIVILEGES ON ALL SEQUENCES IN SCHEMA public FROM foobar;
REVOKE ALL PRIVILEGES ON ALL FUNCTIONS IN SCHEMA public FROM foobar;
</code></pre>
<p>check object ownership</p>
<pre><code class="language-sql">SELECT 
    n.nspname AS schema,
    c.relname AS object,
    c.relkind AS type
FROM 
    pg_class c
JOIN 
    pg_roles r ON c.relowner = r.oid
JOIN 
    pg_namespace n ON n.oid = c.relnamespace
WHERE 
    r.rolname = 'foobar';
</code></pre>
<p>or <code>\ddp  -- in psql</code></p>
<p><img src="database//assets/08cc43216f16468ffcbee888ebce378d43f37d2274255cbb1703717d8ed8d60e25cd23eacb92df00cc8b837a72d9949d4a78e490133b31616819c7e1.png" alt="image" /></p>
<h2 id="granting"><a class="header" href="#granting">granting</a></h2>
<p>granting all sequences</p>
<pre><code class="language-sql">GRANT ALL PRIVILEGES ON ALL SEQUENCES IN SCHEMA public TO radius;
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="how-to-use-sqlx-cli-tools-for-db-migration-such-laravel-migrations"><a class="header" href="#how-to-use-sqlx-cli-tools-for-db-migration-such-laravel-migrations">how to use SQLX cli tools for db migration such laravel migrations</a></h1>
<p>let's meet with this crate, <a href="https://crates.io/crates/sqlx-cli">https://crates.io/crates/sqlx-cli</a>, this tools allow you to use db migration such as laravel migration tools;</p>
<p>first, let's create env variable</p>
<pre><code>export DATABASE_URL=postgres://fadhil_riyanto:&lt;your_pass&gt;@localhost/&lt;target_db&gt;
</code></pre>
<p>then, the things that we do next is only</p>
<pre><code>sqlx migrate add -r &lt;name&gt;
</code></pre>
<p>running</p>
<pre><code>sqlx migrate run
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="postgresql-internal-server"><a class="header" href="#postgresql-internal-server">Postgresql internal (server)</a></h1>
<p>this thing explain the internal of pgsql system (not the source code I mean)</p>
<h2 id="difference-between-catalog-vs-schema"><a class="header" href="#difference-between-catalog-vs-schema">difference between catalog vs schema</a></h2>
<p>key point:</p>
<ul>
<li>
<p>schema is folder like, grouping table together, can be created using</p>
<pre><code class="language-sql">CREATE SCHEMA my_catalog;
CREATE TABLE my_catalog.metadata_table (...);
</code></pre>
</li>
<li>
<p>catalog is system schema, can't be created manually, part of internal pgsql system</p>
</li>
<li>
<p>view is a resulted table from XYZ queries, example</p>
<pre><code class="language-sql">CREATE VIEW active_users AS 
	SELECT id, name, 
	FROM
		users 
	WHERE
		active = true;
</code></pre>
<p>then query it</p>
<pre><code class="language-sql">SELECT * FROM active_users;
</code></pre>
</li>
</ul>
<h2 id="pg_catalog-inside"><a class="header" href="#pg_catalog-inside">pg_catalog inside</a></h2>
<p>this is some stuff inside of pg catalog, you can do that using <code>\dt pg_catalog.*</code></p>
<ul>
<li>pg_aggregate: Stores information about aggregate functions (like <code>SUM</code>, <code>AVG</code>, etc.).</li>
<li>pg_am: Lists access methods for indexes (e.g., <code>btree</code>, <code>hash</code>).</li>
<li>pg_amop: Defines operators used in access methods.</li>
<li>pg_amproc: Defines support functions used in access methods.</li>
<li>pg_attrdef: Stores default values for columns.</li>
<li>pg_attribute: Contains column definitions for all tables.</li>
<li>pg_auth_members: Shows role memberships (who is a member of what).</li>
<li>pg_authid: Stores user/role definitions (superuser access required).</li>
<li>pg_cast: Contains rules for casting between data types.</li>
<li>pg_class: Contains all table-like objects (tables, views, indexes, sequences, etc.).</li>
<li>pg_collation: Defines collations (rules for string comparison).</li>
<li>pg_constraint: Stores constraints like PRIMARY KEY, UNIQUE, CHECK, and FOREIGN KEY.</li>
<li>pg_conversion: Defines character set conversions.</li>
<li>pg_database: Stores information about each database in the cluster.</li>
<li>pg_db_role_setting: Stores per-user/per-database configuration settings (GUCs).</li>
<li>pg_default_acl: Defines default privileges for newly created objects.</li>
<li>pg_depend: Stores dependency relationships between database objects.</li>
<li>pg_description: Stores comments/descriptions on database objects.</li>
<li>pg_enum: Stores values for <code>ENUM</code> data types.</li>
<li>pg_event_trigger: Stores event trigger definitions (triggers on DDL commands).</li>
<li>pg_extension: Tracks installed extensions (like <code>uuid-ossp</code>, <code>pgcrypto</code>, etc.).</li>
<li>pg_foreign_data_wrapper: Stores definitions of foreign data wrappers (FDW).</li>
<li>pg_foreign_server: Stores foreign servers used by FDWs.</li>
<li>pg_foreign_table: Stores metadata for foreign tables.</li>
<li>pg_index: Contains metadata about indexes (e.g., indexed columns).</li>
<li>pg_inherits: Stores table inheritance relationships.</li>
<li>pg_init_privs: Records original privileges on built-in objects.</li>
<li>pg_language: Stores information about supported procedural languages.</li>
<li>pg_largeobject: Stores the actual data of large objects (blobs).</li>
<li>pg_largeobject_metadata: Stores metadata about large objects.</li>
<li>pg_namespace: Lists all schemas in the database (IMPORTANT)</li>
<li>pg_opclass: Stores index operator classes (how a datatype is indexed).</li>
<li>pg_operator: Stores SQL operators (like <code>=</code>, <code>&lt;</code>, <code>+</code>, etc.).</li>
<li>pg_opfamily: Groups related operator classes.</li>
<li>pg_parameter_acl: Stores access control for configuration parameters (PostgreSQL 16+).</li>
<li>pg_partitioned_table: Stores metadata for partitioned tables.</li>
<li>pg_policy: Stores row-level security policies.</li>
<li>pg_proc: Contains all function and procedure definitions.</li>
<li>pg_publication: Stores logical replication publications.</li>
<li>pg_publication_namespace: Links publications to schemas.</li>
<li>pg_publication_rel: Links publications to individual tables.</li>
<li>pg_range: Stores definitions of range types (e.g., <code>int4range</code>).</li>
<li>pg_replication_origin: Tracks origins for logical replication.</li>
<li>pg_rewrite: Stores query rewrite rules (used in views, rules).</li>
<li>pg_seclabel: Stores security labels for database objects.</li>
<li>pg_sequence: Contains metadata for sequence generators.</li>
<li>pg_shdepend: Tracks dependencies involving shared objects (like roles, databases).</li>
<li>pg_shdescription: Stores comments on shared objects.</li>
<li>pg_shseclabel: Stores security labels on shared objects.</li>
<li>pg_statistic: Stores planner statistics for columns.</li>
<li>pg_statistic_ext: Stores extended planner statistics (multi-column, NDV, etc.).</li>
<li>pg_statistic_ext_data: Contains actual values for extended statistics.</li>
<li>pg_subscription: Defines logical replication subscriptions.</li>
<li>pg_subscription_rel: Lists tables included in subscriptions.</li>
<li>pg_tablespace: Lists all tablespaces (disk locations for data).</li>
<li>pg_transform: Stores type transformation functions for procedural languages.</li>
<li>pg_trigger: Stores triggers on tables.</li>
<li>pg_ts_config: Stores full-text search configurations.</li>
<li>pg_ts_config_map: Maps text search config tokens to dictionaries.</li>
<li>pg_ts_dict: Stores text search dictionaries.</li>
<li>pg_ts_parser: Defines tokenizers for full-text search.</li>
<li>pg_ts_template: Defines templates for building text search dictionaries.</li>
<li>pg_type: Stores all data types (built-in, custom, enum, composite). (IMPORTANT)</li>
<li>pg_user_mapping: Maps users to foreign servers.</li>
</ul>
<h3 id="pg_catalogpg_database-details"><a class="header" href="#pg_catalogpg_database-details">pg_catalog.pg_database details</a></h3>
<p>this docs can be found in <a href="https://www.postgresql.org/docs/16/catalog-pg-database.html">https://www.postgresql.org/docs/16/catalog-pg-database.html</a></p>
<div class="table-wrapper"><table><thead><tr><th>Column Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><strong><code>datname</code></strong></td><td><code>name</code></td><td>The name of the database.</td></tr>
<tr><td><strong><code>datdba</code></strong></td><td><code>oid</code></td><td>The OID of the role (user) that owns the database. Use <code>pg_get_userbyid(datdba)</code> to resolve it.</td></tr>
<tr><td><strong><code>encoding</code></strong></td><td><code>int</code></td><td>The character encoding of the database (e.g., UTF8 = 6). Use <code>pg_encoding_to_char(encoding)</code> to get the name.</td></tr>
<tr><td><strong><code>datlocprovider</code></strong></td><td><code>char</code></td><td>Locale provider used (<code>c</code> = libc, <code>i</code> = ICU).</td></tr>
<tr><td><strong><code>datistemplate</code></strong></td><td><code>bool</code></td><td>If <code>true</code>, the database can be used as a template for <code>CREATE DATABASE ... TEMPLATE</code>.</td></tr>
<tr><td><strong><code>datallowconn</code></strong></td><td><code>bool</code></td><td>If <code>false</code>, connections to this database are not allowed (except by superusers).</td></tr>
<tr><td><strong><code>datconnlimit</code></strong></td><td><code>int</code></td><td>The maximum number of concurrent connections allowed (-1 = no limit).</td></tr>
<tr><td><strong><code>datlastsysoid</code></strong></td><td><code>oid</code></td><td>The last system OID used in this database at creation (mainly historical).</td></tr>
<tr><td><strong><code>datfrozenxid</code></strong></td><td><code>xid</code></td><td>The transaction ID at which all tuples are known to be frozen (related to VACUUM).</td></tr>
<tr><td><strong><code>datminmxid</code></strong></td><td><code>xid</code></td><td>The minimum multixact ID that is still considered potentially unfrozen.</td></tr>
<tr><td><strong><code>dattablespace</code></strong></td><td><code>oid</code></td><td>OID of the default tablespace for the database. Use <code>pg_tablespace</code> to resolve.</td></tr>
<tr><td><strong><code>datcollate</code></strong></td><td><code>name</code></td><td>LC_COLLATE setting (how strings are sorted).</td></tr>
<tr><td><strong><code>datctype</code></strong></td><td><code>name</code></td><td>LC_CTYPE setting (how character classification works).</td></tr>
<tr><td><strong><code>daticulocale</code></strong></td><td><code>text</code></td><td>ICU locale (used if <code>datlocprovider = 'i'</code>).</td></tr>
<tr><td><strong><code>datcollversion</code></strong></td><td><code>text</code></td><td>Version of the collation used (important for collation versioning with ICU).</td></tr>
<tr><td><strong><code>datacl</code></strong></td><td><code>aclitem[]</code></td><td>Access privileges (GRANTs), stored as an array of ACL items.</td></tr>
</tbody></table>
</div>
<h2 id="management-script-collection"><a class="header" href="#management-script-collection">management script collection</a></h2>
<h4 id="--show-all-databases-in-current-user"><a class="header" href="#--show-all-databases-in-current-user">- show all databases (in current user)</a></h4>
<pre><code class="language-sql">SELECT * FROM pg_catalog.pg_database;`:
</code></pre>
<h4 id="--show-pg_catalogpg_tables-definition"><a class="header" href="#--show-pg_catalogpg_tables-definition">- show <code>pg_catalog.pg_tables</code> definition</a></h4>
<p>go back on top in order to see what actually view is</p>
<pre><code class="language-sql">SELECT pg_get_viewdef('pg_catalog.pg_tables', true);`: 
</code></pre>
<h4 id="--show-all-available-pgsql-datatype"><a class="header" href="#--show-all-available-pgsql-datatype">- show all available pgsql datatype</a></h4>
<pre><code class="language-sql">SELECT 
	*
FROM
	pg_catalog.pg_type;
</code></pre>
<h4 id="--lists-all-schema"><a class="header" href="#--lists-all-schema">- lists all schema</a></h4>
<pre><code class="language-sql">SELECT
    *
FROM
    pg_catalog.pg_namespace;
</code></pre>
<h4 id="--show-all-dbs-with-owner"><a class="header" href="#--show-all-dbs-with-owner">- show all dbs with owner</a></h4>
<pre><code class="language-sql">SELECT 
        x.oid as object_id,
        x.datname as db_name,
        CASE 
                WHEN pg_catalog.pg_get_userbyid(x.datdba) LIKE 'unknown (OID=%)' THEN 'UNKNOWN'
                ELSE pg_catalog.pg_get_userbyid(x.datdba)
        END as owner
FROM pg_catalog.pg_database as x;
</code></pre>
<p>cond: <a href="https://www.postgresql.org/docs/current/functions-conditional.html#FUNCTIONS-CASE">https://www.postgresql.org/docs/current/functions-conditional.html#FUNCTIONS-CASE</a></p>
<h4 id="--rename-db-as-postgres-user"><a class="header" href="#--rename-db-as-postgres-user">- RENAME db (as postgres user)</a></h4>
<pre><code class="language-sql">ALTER DATABASE xyz RENAME TO abc;
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="postgresql-ii-sql-language-docs-summary"><a class="header" href="#postgresql-ii-sql-language-docs-summary">Postgresql II SQL language docs summary</a></h1>
<p>this is incomplete documentation summary of postgresql (SQL section), see complete docs <a href="https://www.postgresql.org/docs/current/sql.html">here</a></p>
<h2 id="5-data-definition"><a class="header" href="#5-data-definition">5. Data Definition</a></h2>
<h3 id="52-default-values"><a class="header" href="#52-default-values">5.2. Default values</a></h3>
<p>When a new row is created and no values are specified for some of the columns, those columns will be filled with their respective default values. A data manipulation command can also request explicitly that a column be set to its default value, without having to know what that value is</p>
<p>example</p>
<pre><code class="language-sql">CREATE TABLE state (
	uid				integer,
	enable			bool DEFAULT false
)
</code></pre>
<h3 id="53-identity-column"><a class="header" href="#53-identity-column">5.3. Identity column</a></h3>
<div style="break-before: page; page-break-before: always;"></div><h1 id="system-table-in-pgsql-catalog"><a class="header" href="#system-table-in-pgsql-catalog">system table in pgsql (catalog)</a></h1>
<h3 id="pg_tables--docs"><a class="header" href="#pg_tables--docs">pg_tables | <a href="https://www.postgresql.org/docs/current/view-pg-tables.html">docs</a></a></h3>
<p>catalog pgsql yang isinya data ttg table (di db saat ini), contoh query nya</p>
<pre><code>SELECT
        *
FROM 
        pg_catalog.pg_tables as x
WHERE
        x.schemaname = 'public';
</code></pre>
<h3 id="pg_sequences"><a class="header" href="#pg_sequences">pg_sequences</a></h3>
<p>yg ini isinya sequence2 semua, mirip kayak serial datatype di pgsql
<img src="database//assets/94e4349ca37d30c1e51bc9e722767e2932e7c3d863bd4d0bfc941a764de78e033e68f4ecde81c5fa0152f9985d8f2d7e27502786debddaec09a57f68.png" alt="image" /></p>
<p>NOTES: <code>pg_sequence</code> adalah versi low levelnya, sedangkan <code>pg_sequences</code> adalah versi view dari join-an <code>pg_sequence</code> dan <code>pg_class</code>, bukti</p>
<pre><code class="language-sql">SELECT
        *
FROM
        pg_get_viewdef('pg_catalog.pg_sequences', true)
</code></pre>
<p>hasil</p>
<pre><code class="language-sql">SELECT 
        n.nspname AS schemaname, 
        c.relname AS sequencename, 
        pg_get_userbyid(c.relowner) AS sequenceowner, 
        s.seqtypid :: regtype AS data_type, 
        s.seqstart AS start_value, 
        s.seqmin AS min_value, 
        s.seqmax AS max_value, 
        s.seqincrement AS increment_by, 
        s.seqcycle AS cycle, 
        s.seqcache AS cache_size, 
        CASE WHEN has_sequence_privilege(c.oid, 'SELECT,USAGE' :: text) THEN pg_sequence_last_value(c.oid :: regclass) ELSE NULL :: bigint END AS last_value 
FROM 
        pg_sequence s 
        JOIN pg_class c ON c.oid = s.seqrelid 
        LEFT JOIN pg_namespace n ON n.oid = c.relnamespace 
WHERE 
        NOT pg_is_other_temp_schema(n.oid) 
        AND c.relkind = 'S' :: "char";

</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="pgsql-functions"><a class="header" href="#pgsql-functions">pgsql functions()</a></h1>
<h3 id="pg_get_viewdef"><a class="header" href="#pg_get_viewdef"><code>pg_get_viewdef</code></a></h3>
<p>see sql script for particular view, I call this as view reverser</p>
<p>example:</p>
<pre><code class="language-sql">SELECT
        *
FROM
        pg_get_viewdef('pg_catalog.pg_sequences', true)
</code></pre>
<p>ref:</p>
<ul>
<li><a href="https://pgpedia.info/p/pg_get_viewdef.html">https://pgpedia.info/p/pg_get_viewdef.html</a></li>
<li><a href="https://www.postgresql.org/docs/current/functions-info.html">https://www.postgresql.org/docs/current/functions-info.html</a></li>
</ul>
<h3 id="akan-ada-kelanjutan-disini"><a class="header" href="#akan-ada-kelanjutan-disini">akan ada kelanjutan disini.</a></h3>
<div style="break-before: page; page-break-before: always;"></div><h1 id="postgresql-database-hba"><a class="header" href="#postgresql-database-hba">postgresql database HBA</a></h1>
<p>HBA = host-based authentication</p>
<p>links:</p>
<ul>
<li><a href="https://www.postgresql.org/docs/current/client-authentication.html">https://www.postgresql.org/docs/current/client-authentication.html</a></li>
<li><a href="https://www.postgresql.org/docs/current/auth-pg-hba-conf.html">https://www.postgresql.org/docs/current/auth-pg-hba-conf.html</a></li>
</ul>
<p>order matters</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="postgresql-grant"><a class="header" href="#postgresql-grant">PostgreSQL grant</a></h1>
<p>reference: <a href="https://www.postgresql.org/docs/current/sql-grant.html">https://www.postgresql.org/docs/current/sql-grant.html</a>
buat dokumentasi tentang ini.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="dockerfile-boilerplate"><a class="header" href="#dockerfile-boilerplate">Dockerfile boilerplate</a></h1>
<p>this folder is a set of dockerfile boilerplate that I used to build something.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="php-83-debian-v11-bullseye-dev-env"><a class="header" href="#php-83-debian-v11-bullseye-dev-env">php-8.3 debian v11 (bullseye) dev-env</a></h1>
<p>CREATED: <code>Fri Jun  6 06:32:35 PM WIB 2025</code></p>
<pre><code class="language-docker">FROM debian:bullseye

ENV DEBIAN_FRONTEND=noninteractive
# initial, refresh repo first
RUN apt-get update

# this install base package that need in order to download gpg key (curl, and gnupg)
RUN apt-get install -y ca-certificates
RUN apt-get install -y apt-transport-https
RUN apt-get install -y lsb-release
RUN apt-get install -y gnupg
RUN apt-get install -y curl
RUN apt-get install -y git
RUN apt-get install -y unzip

# add ondrej\PPA
RUN curl -fsSL https://packages.sury.org/php/apt.gpg | gpg --dearmor -o /etc/apt/trusted.gpg.d/php.gpg
RUN echo "deb https://packages.sury.org/php/ $(lsb_release -sc) main" | tee /etc/apt/sources.list.d/php.list

# install actual package, php-xml &amp; php-mbstring is needed by composer. 
RUN apt-get update
RUN apt-get install -y nginx
RUN apt-get install -y php8.3
RUN apt-get install -y php8.3-curl
RUN apt-get install -y php8.3-xml
RUN apt-get install -y php8.3-mbstring

# download composer
RUN curl -sS https://getcomposer.org/installer -o composer-setup.php \
        &amp;&amp; php composer-setup.php --install-dir=/usr/local/bin --filename=composer \
        &amp;&amp; rm composer-setup.php

COPY . /app
WORKDIR /app

EXPOSE 4444

# install composer
RUN composer install
CMD [ "php", "-S", "0.0.0.0:4444", "-t", "public" ]
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="php8320-fpm-bullseye--nginx"><a class="header" href="#php8320-fpm-bullseye--nginx">php:8.3.20-fpm-bullseye + nginx</a></h1>
<pre><code class="language-dockerfile">FROM php:8.3.20-fpm-bullseye 

RUN apt-get update &amp;&amp; apt-get install -y libpq-dev
RUN docker-php-ext-install pdo pdo_pgsql

COPY . /app
WORKDIR /app

COPY ./docker/fpm/www.conf /usr/local/etc/php-fpm.d/www.conf
# karna php-fpm running pakai user www-data
RUN chown -R www-data:www-data /app/storage


CMD [ "php-fpm" ]
</code></pre>
<p>default.conf (nginx)</p>
<pre><code class="language-dockerfile">server {
    listen       80;
    server_name  localhost;

    access_log  off;
    root /app/public;

    location / {
        try_files $uri $uri/ /index.php?$query_string;
    }

    error_page   500 502 503 504  /50x.html;
    location = /50x.html {
        root   /usr/share/nginx/html;
    }


    location ~ \.php$ {

        fastcgi_pass   php:9000; 
        fastcgi_param  SCRIPT_FILENAME $document_root$fastcgi_script_name;
        fastcgi_param  DOCUMENT_ROOT $document_root;
        include        fastcgi_params;
    }
}

</code></pre>
<p>www.conf</p>
<pre><code class="language-conf">
[www]
access.log = /dev/null

user = www-data
group = www-data

listen = 0.0.0.0:9000

pm = dynamic
pm.max_children = 5
pm.start_servers = 2
pm.min_spare_servers = 1
pm.max_spare_servers = 3
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="php8320-bullseye-dev-env"><a class="header" href="#php8320-bullseye-dev-env">php:8.3.20-bullseye dev env</a></h1>
<p>this is also works for laravel</p>
<pre><code class="language-php">FROM php:8.3.20-bullseye

RUN apt-get update &amp;&amp; apt-get install -y \
        curl \ 
        libpq-dev \
        git \
        unzip
RUN docker-php-ext-install pdo pdo_pgsql

COPY . /app
WORKDIR /app

RUN curl -sS https://getcomposer.org/installer -o composer-setup.php \
        &amp;&amp; php composer-setup.php --install-dir=/usr/local/bin --filename=composer \
        &amp;&amp; rm composer-setup.php

RUN composer install

CMD [ "php", "-S", "0.0.0.0:10302", "-t", "public" ]
</code></pre>
<p>compose.yml</p>
<pre><code class="language-yml">volumes:
  storage:
  db_data:

networks:
  veth_network:
    driver: bridge

services:
  google_sso:
    image: php:8.3.20-bullseye
    build:
      context: .
      dockerfile: dev.backend.Dockerfile
    environment:
      - docker=true
      - DB_HOST=pgsql_db
      - DB_PORT=5432
      - DB_USERNAME=postgres
      - DB_PASSWORD=&lt;PASSWD&gt;
      - DB_DATABASE=google_sso_dev
      - G_SSO_NAME=google-sso-login
      - G_SSO_CLIENT_ID=ABC
      - G_SSO_CLIENT_SECRET=DEF
      - G_SSO_REDIRECT_URI=http://localhost:10302/auth/callback
    ports:
      - "10302:10302"
    networks:
      - veth_network
    volumes:
      - .:/app
      - storage:/app/storage
    depends_on:
      - pgsql_db

  pgsql_db:
    image: postgres:17.5-bullseye
    restart: always
    shm_size: 128mb
    environment:
      - POSTGRES_USER=postgres
      - POSTGRES_PASSWORD=&lt;PASSWD&gt;
      - POSTGRES_DB=google_sso_dev
    networks:
      - veth_network
    volumes:
      - db_data:/var/lib/postgresql/data
  
  adminer:
    image: adminer
    restart: always
    ports:
      - 8080:8080
    networks:
      - veth_network
    depends_on:
      - pgsql_db
</code></pre>
<p>CATATAN unik: ketika ping <code>pgsql_db</code> dari xxx container, ia otomatis resolve dns nya.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="php-web"><a class="header" href="#php-web">PHP (web)</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="laravel-service-container"><a class="header" href="#laravel-service-container">laravel service container</a></h1>
<p>date: Sun Jun  8 11:47:02 PM WIB 2025</p>
<p>links</p>
<ul>
<li><a href="https://laravel.com/docs/12.x/container#introduction">https://laravel.com/docs/12.x/container#introduction</a></li>
</ul>
<h2 id="making"><a class="header" href="#making">making</a></h2>
<p>untuk membuat service container, katakanlah isi class ctx yang namanya Google\Client. dia mereturn $client. maka kita harus bikin</p>
<pre><code class="language-sh">php artisan make:provider GoogleApis
</code></pre>
<p>nama GoogleApis bebas. lalu cek di folder <code>./app/Providers/GoogleApis.php</code> harusnya ada, dan di file <code>./bootstrap/providers.php</code> akan ada</p>
<pre><code class="language-php">&lt;?php

return [
    App\Providers\AppServiceProvider::class,
    App\Providers\GoogleApis::class,
];

</code></pre>
<p>ada <code>App\Providers\GoogleApis::class</code> maksudnya.</p>
<h2 id="registering"><a class="header" href="#registering">registering</a></h2>
<p>dari service provider yang baru saja dibuat, akan ada 2 method, yaitu</p>
<ul>
<li><code>public function register(): void</code>: boot ini entry dari service, nilai ctx ctx dsb biasanya diload disini</li>
<li><code>public function boot(): void</code>: func ini dipanggil kalau semua service sudah jalan, misal service route di register, tapi method untuk nambahin route routenya. ada di boot</li>
</ul>
<p>general structure nya (file <code>./app/Providers/AppServiceProvider.php</code>)</p>
<pre><code class="language-php">&lt;?php

namespace App\Providers;

use Illuminate\Support\ServiceProvider;

class AppServiceProvider extends ServiceProvider
{
    /**
     * Register any application services.
     */
    public function register(): void
    {
        //
    }

    /**
     * Bootstrap any application services.
     */
    public function boot(): void
    {
        //
    }
}

</code></pre>
<h2 id="the-inside-of-register-function"><a class="header" href="#the-inside-of-register-function">the inside of register function</a></h2>
<p>docs tentang</p>
<ul>
<li>binding -&gt; <a href="https://laravel.com/docs/12.x/container#simple-bindings">https://laravel.com/docs/12.x/container#simple-bindings</a></li>
<li>singleton -&gt; <a href="https://laravel.com/docs/12.x/container#binding-a-singleton">https://laravel.com/docs/12.x/container#binding-a-singleton</a></li>
</ul>
<p>perbedaanya, <code>bind</code> auto buat fresh ctx tiap kali request datang, sedangkan <code>singleton</code> hanya buat sekali, contoh konkret <code>singleton</code> adalah ctx koneksi mongodb, kita cukup pakai sekali saja, untuk semua container</p>
<p>ini contoh googleclient</p>
<pre><code class="language-php">// this code is inside of register() func
$this-&gt;app-&gt;singleton(Client::class, function (Application $app) {
    $client = new Client();
    $client-&gt;setApplicationName(env("G_SSO_NAME"));
    $client-&gt;setClientId(env("G_SSO_CLIENT_ID"));
    $client-&gt;setClientSecret(env("G_SSO_CLIENT_SECRET"));
    $client-&gt;setRedirectUri(env("G_SSO_REDIRECT_URI"));
    $client-&gt;addScope([
        Service\Oauth2::USERINFO_EMAIL,
        Service\Oauth2::USERINFO_PROFILE
    ]);
    $client-&gt;setAccessType('offline');
    $client-&gt;setLoginHint('your_email@gmail.com');

    return $client;
});
</code></pre>
<p>catatan: <code>use Illuminate\Contracts\Foundation\Application</code> itu ctx bawaan laravel buat ngebind.</p>
<h2 id="how-to-use"><a class="header" href="#how-to-use">how to use</a></h2>
<p>lokasi: controller</p>
<p>kita tinggal panggil saja class (milik aslinya)</p>
<p>contoh</p>
<pre><code class="language-php">use Google\Client;

class Randomclass extends Controller

{
    /**

     * Create a new controller instance.

     */

    public function __construct(

        protected Client $client,

    ) {}

    public function use_it() {
    	$this-&gt;client-&gt;some_google_method();
        // $this-&gt;client was initialized
    }
}
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="laravel-12-custom-auth-guard--tables"><a class="header" href="#laravel-12-custom-auth-guard--tables">laravel 12 custom auth guard + tables</a></h1>
<p>Mon Jun  9 05:36:39 AM WIB 2025</p>
<p>di sini saya coba untuk membuat Auth::attempt <a href="https://laravel.com/docs/12.x/authentication#authenticating-users">https://laravel.com/docs/12.x/authentication#authenticating-users</a>, tapi bedanya, ia pakai totally different table. jadi tidak pakai table <code>users</code></p>
<h2 id="setup-model"><a class="header" href="#setup-model">setup model</a></h2>
<p>untuk setup nya, kita buat model dulu seperti biasa pakai <code>php artisan make:model Xyz</code>, disini saya buatnya <code>php artisan make:model GuestUser</code>. lalu cek bagian <code>./app/Models/GuestUser.php</code></p>
<p>normalnya class akan extends ke <code>Illuminate\Database\Eloquent\Model</code>, nah ini kita extends kan ke <code>Illuminate\Foundation\Auth\User</code>, dimana class itu kalau dirunut lagi, pasti juga nge-extends ke class Model</p>
<p>bukti</p>
<pre><code class="language-php">class User extends Model implements
    AuthenticatableContract,
    AuthorizableContract,
    CanResetPasswordContract
{
    use Authenticatable, Authorizable, CanResetPassword, MustVerifyEmail;
}

</code></pre>
<p>ok, sudah. saatnya kita pindah ke model yang baru saja dibuat, isi $fillable seperti column database, jangan lupa ganti extends nya dengan <code>extends Authenticatable</code></p>
<p>hasil akhir seperti ini kira2</p>
<pre><code class="language-php">&lt;?php

namespace App\Models;

use Illuminate\Database\Eloquent\Model;
use Illuminate\Foundation\Auth\User as Authenticatable;

class GuestUser extends Authenticatable
{
    protected $table = "guest_user";

    protected $fillable = [
        'name',
        'picture',
        'email',
        'password',
        'token',
        'g_auth_expires_in'
    ];
}

</code></pre>
<h2 id="registering-guard"><a class="header" href="#registering-guard">registering guard</a></h2>
<p>agar model kita bisa dibaca oleh <code>Auth</code> facade, maka kita harus registerkan dia dahulu di <code>./config/auth.php</code>, isi dahulu bagian <code>providers</code>. contoh</p>
<pre><code class="language-php">/*
    |--------------------------------------------------------------------------
    | User Providers
    |--------------------------------------------------------------------------
    |
    | All authentication guards have a user provider, which defines how the
    | users are actually retrieved out of your database or other storage
    | system used by the application. Typically, Eloquent is utilized.
    |
    | If you have multiple user tables or models you may configure multiple
    | providers to represent the model / table. These providers may then
    | be assigned to any extra authentication guards you have defined.
    |
    | Supported: "database", "eloquent"
    |
    */

    'providers' =&gt; [
        'users' =&gt; [
            'driver' =&gt; 'eloquent',
            'model' =&gt; env('AUTH_MODEL', App\Models\User::class),
        ],
        'guest_users' =&gt; [
            'driver' =&gt; 'eloquent',
            'model' =&gt; env('AUTH_MODEL', App\Models\GuestUser::class),
        ],

        // 'users' =&gt; [
        //     'driver' =&gt; 'database',
        //     'table' =&gt; 'users',
        // ],
    ],
</code></pre>
<p>make sense kan? <code>guest_users</code> provider, ia memiliki model App\Models\GuestUser::class (note, <code>::class</code> akan return str),</p>
<p>setelah itu, lihat bagian atasnya, ada guards, disini kita akan naming guardsnya dan juga memberi info provider model mana yang akan dikasih, contoh</p>
<pre><code class="language-php">/*
    |--------------------------------------------------------------------------
    | Authentication Guards
    |--------------------------------------------------------------------------
    |
    | Next, you may define every authentication guard for your application.
    | Of course, a great default configuration has been defined for you
    | which utilizes session storage plus the Eloquent user provider.
    |
    | All authentication guards have a user provider, which defines how the
    | users are actually retrieved out of your database or other storage
    | system used by the application. Typically, Eloquent is utilized.
    |
    | Supported: "session"
    |
    */

    'guards' =&gt; [
        'web' =&gt; [
            'driver' =&gt; 'session',
            'provider' =&gt; 'users',
        ],
        'guest' =&gt; [
            'driver' =&gt; 'session',
            'provider' =&gt; 'guest_users',
        ],
        
    ],
</code></pre>
<p>JFYI: <code>Auth::attempt()</code> secara default pakai guards <code>web</code>, nah kita sekarang juga bisa pakai custom, seperti ini <code>Auth::guard("guest")-&gt;attempt()</code> secara explicit kita tell laravel untuk pakai guard <code>guest</code></p>
<h2 id="session"><a class="header" href="#session">session</a></h2>
<p>general login flow</p>
<pre><code class="language-php">if (Auth::guard("guest")-&gt;attempt($packed_arr)) {

    $retq = GuestUser::where("email", $packed_arr["email"])-&gt;first();
    $retq = Auth::guard("guest")-&gt;login($retq);

    return redirect('/dashboard/index');
} else {
    dd("login failed");
}
</code></pre>
<p><code>Auth::guard("guest")-&gt;attempt()</code> return boolean, true jika auth benar. <code>Auth::guard("guest")-&gt;login($retq);</code>  ubah state internalnya bahwa dia sudah login, lalu redirect (penting, jika tidak diredirect, nanti session akan stuck)</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="laravel-socialite-setup"><a class="header" href="#laravel-socialite-setup">laravel Socialite setup</a></h1>
<p>Mon Jun  9 05:49:13 AM WIB 2025</p>
<h2 id="setup"><a class="header" href="#setup">setup</a></h2>
<p>lihat <code>config/services.php</code>, disana hanya ada slack, maka kita tambahin</p>
<pre><code class="language-php">    'google' =&gt; [
        'client_id' =&gt; env('G_SSO_CLIENT_ID'),
        'client_secret' =&gt; env('G_SSO_CLIENT_SECRET'),
        'redirect' =&gt; env('G_SSO_REDIRECT_URI'),
        'name' =&gt; env('G_SSO_NAME'),
    ],
</code></pre>
<h2 id="usage-1"><a class="header" href="#usage-1">usage</a></h2>
<p>dapatkan link permintaan akses, pakai</p>
<pre><code class="language-php">return Socialite::driver('google')-&gt;redirect();
</code></pre>
<p>ketika user sudah klik continue &amp; accept share datanya, akan dikirimkan callback, pasang ini ke callback</p>
<pre><code class="language-php">$user = Socialite::driver('google')-&gt;user();
dd($user);
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="laravel-pgsql-migration-setup"><a class="header" href="#laravel-pgsql-migration-setup">laravel pgsql migration setup</a></h1>
<p>Mon Jun  9 05:56:55 AM WIB 2025</p>
<p>PGSQL datatype to laravel mapping function: <a href="https://api.laravel.com/docs/12.x/Illuminate/Database/Schema/Blueprint.html">https://api.laravel.com/docs/12.x/Illuminate/Database/Schema/Blueprint.html</a></p>
<p>buat migrationnya dengan</p>
<pre><code class="language-sh">php artisan make:migration create_table_abc
</code></pre>
<p>run</p>
<pre><code class="language-sh">php artisan migrate
</code></pre>
<p>rollback terbaru</p>
<pre><code class="language-sh">php artisan migrate --rollback 1
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="jwt"><a class="header" href="#jwt">JWT</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="laravel-named-routes"><a class="header" href="#laravel-named-routes">laravel named routes</a></h1>
<p>ref: <a href="https://laravel.com/docs/12.x/routing#named-routes">https://laravel.com/docs/12.x/routing#named-routes</a></p>
<p>examples</p>
<pre><code class="language-php">Route::prefix('auth')-&gt;group(function () {
    Route::prefix('google')-&gt;group(function () {
        Route::get('/redirect', [Controllers\GoogleAuthController::class, 'redirect'])
            -&gt;name("auth.google.redirect");
        Route::get('/callback', [Controllers\GoogleAuthController::class, 'callback'])
            -&gt;name("auth.google.callback");;
    });

    /* .. */
});
</code></pre>
<p>acces it (in blade)</p>
<pre><code class="language-php">&lt;h1&gt;{{ route("auth.google.callback"); }}&lt;/h1&gt;
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="installing-tymonjwt-auth-with-custom-guard"><a class="header" href="#installing-tymonjwt-auth-with-custom-guard">installing tymon/jwt-auth with custom guard</a></h1>
<p>now, we will install this package as is with custom guard. so we do not use <code>web</code> guard.</p>
<h1 id="installing"><a class="header" href="#installing">installing</a></h1>
<p>read <a href="https://jwt-auth.readthedocs.io/en/develop/laravel-installation/">https://jwt-auth.readthedocs.io/en/develop/laravel-installation/</a> please</p>
<p>do the step until reached <code>php artisan jwt:secret</code>, skip lumen Installation please</p>
<h1 id="quickstart"><a class="header" href="#quickstart">quickstart</a></h1>
<p>please read <a href="php//php/custom_auth_guard_w_tables.html">php/custom_auth_guard_w_tables.md</a> first, then replace this</p>
<pre><code class="language-php">'guest' =&gt; [
    'driver' =&gt; 'jwt',
    'provider' =&gt; 'guest_users',
],
</code></pre>
<p>in your <code>./config/auth.php</code> file, just like this</p>
<p><img src="php//assets/054150e05a7b1c8c584febefb9460cd7ae34110ff589e5c8cac4c20e89f137da080cb3fe84711c582f0f04f39d99e3a0caaf7d5c95f96858e2afdc0f.png" alt="image" /></p>
<p>then, make sure your custom guard class is implement <code>Tymon\JWTAuth\Contracts\JWTSubject</code>, you can see the location of models class</p>
<p>example, in <code>./config/auth.php</code></p>
<p><img src="php//assets/ae5832b0d60ad775cb9f2abfd1f69d844be87529528c2a9c1895f11c10ec88d26d15e2c2ad8e6295c020333d0f9f8a2fc800018d94171df3564f0097.png" alt="image" /></p>
<p>just make it like this</p>
<p><img src="php//assets/ae3db2de9d514e1eb4c3ca63b13344280f8133638bb908d07ab1622b6073fcc57336f374fcfadf7d0da5e3bfe65f38fb255e16abece6ad2bd2c05c4c.png" alt="image" /></p>
<h1 id="middleware--routing-config"><a class="header" href="#middleware--routing-config">middleware &amp; routing config</a></h1>
<p>this section you only need to do</p>
<pre><code class="language-php">Route::get('/callback', [Controllers\Guest\GoogleAuthController::class, 'callback'])
            -&gt;name("auth.google.callback")
            -&gt;middleware("guest");
</code></pre>
<p>change with your own routing</p>
<h1 id="poc-1"><a class="header" href="#poc-1">PoC</a></h1>
<p>FIRST, we use <code>callback</code> method, so the inside of <code>callback</code> method body should look like this</p>
<pre><code class="language-php">packed_arr = [
    "email" =&gt; $email,
    "password" =&gt; "password"
];

$token = Auth::guard("guest")-&gt;attempt($packed_arr);

if ($token) {
    return  $this-&gt;respondWithToken($token);
} else {
    return response()-&gt;json(['error' =&gt; 'Invalid credentials'], 401);
}
</code></pre>
<p><code>respondWithToken</code> method</p>
<pre><code class="language-php">protected function respondWithToken($token)
    {
        return response()-&gt;json([
            'access_token' =&gt; $token,
            'token_type' =&gt; 'bearer',
            'expires_in' =&gt; Auth::guard("guest")-&gt;factory()-&gt;getTTL() * 60
        ]);
    }
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="other"><a class="header" href="#other">Other</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="bookmarks-highly-useful-link"><a class="header" href="#bookmarks-highly-useful-link">bookmarks highly useful link</a></h1>
<h2 id="this-section-is-derived-from-my-original-channel-xorriso"><a class="header" href="#this-section-is-derived-from-my-original-channel-xorriso">this section is derived from my original channel <a href="https://t.me/xorriso">@xorriso</a></a></h2>
<h3 id="httpsxenbitsxenorgdocs46-testingmiscpvhhtml"><a class="header" href="#httpsxenbitsxenorgdocs46-testingmiscpvhhtml"><a href="https://xenbits.xen.org/docs/4.6-testing/misc/pvh.html">https://xenbits.xen.org/docs/4.6-testing/misc/pvh.html</a></a></h3>
<p><code>"PVH is to make use of the hardware virtualization extensions present in modern x86 CPUs in order to improve performance."</code></p>
<h3 id="httpswikixenprojectorgwikilinux_pvh"><a class="header" href="#httpswikixenprojectorgwikilinux_pvh"><a href="https://wiki.xenproject.org/wiki/Linux_PVH">https://wiki.xenproject.org/wiki/Linux_PVH</a></a></h3>
<p><code>Where one will select Processor type and features ---&gt; Linux guest support ---&gt;Support for running as a PVH guest</code></p>
<h3 id="httpsgithubcomgoldside543goldspace"><a class="header" href="#httpsgithubcomgoldside543goldspace"><a href="https://github.com/Goldside543/goldspace">https://github.com/Goldside543/goldspace</a></a></h3>
<h3 id="httpsmongocorglibmongoccurrentmongoc_client_newhtml"><a class="header" href="#httpsmongocorglibmongoccurrentmongoc_client_newhtml"><a href="https://mongoc.org/libmongoc/current/mongoc_client_new.html">https://mongoc.org/libmongoc/current/mongoc_client_new.html</a></a></h3>
<pre><code>kesimpulan: mongoc_client_new return null on error, but not even the string are correct
no connection checked.

jangan ngeharap mongoc_client_new ngeluarin null
</code></pre>
<h3 id="httpsfacultycsniueduhutchinscsci480signalshtm"><a class="header" href="#httpsfacultycsniueduhutchinscsci480signalshtm"><a href="https://faculty.cs.niu.edu/~hutchins/csci480/signals.htm">https://faculty.cs.niu.edu/~hutchins/csci480/signals.htm</a></a></h3>
<p>daftar exit code</p>
<h3 id="httpsgitkernelorgpubscmlinuxkernelgittorvaldslinuxgittreearchx86entrysyscallssyscall_64tbl"><a class="header" href="#httpsgitkernelorgpubscmlinuxkernelgittorvaldslinuxgittreearchx86entrysyscallssyscall_64tbl"><a href="https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/tree/arch/x86/entry/syscalls/syscall_64.tbl">https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/tree/arch/x86/entry/syscalls/syscall_64.tbl</a></a></h3>
<p><code>list syscall</code></p>
<h3 id="httpswwwbitsinthewindcomabout-dacpublicationsunix-systems-programming"><a class="header" href="#httpswwwbitsinthewindcomabout-dacpublicationsunix-systems-programming"><a href="https://www.bitsinthewind.com/about-dac/publications/unix-systems-programming">https://www.bitsinthewind.com/about-dac/publications/unix-systems-programming</a></a></h3>
<p><code>system programming</code></p>
<h3 id="httpslwnnetarticles205126"><a class="header" href="#httpslwnnetarticles205126"><a href="https://lwn.net/Articles/205126/">https://lwn.net/Articles/205126/</a></a></h3>
<p><code>In recent times, Al's work has resulted in a long series of patches merged into the mainline, almost all of which have been marked as "endianness annotations." These patches mostly change the declared types for various functions, variables, and structure members. The new types may be unfamiliar to many, since they are relatively new - though not that new; they were introduced in 2.6.9. These types are __le16, __le32, __le64, __be16, __be32, and __be64. </code></p>
<h3 id="httpsgithubcomaugusttandocumentsblobmasterunix20network20programmingvolume12c3rdpdf"><a class="header" href="#httpsgithubcomaugusttandocumentsblobmasterunix20network20programmingvolume12c3rdpdf"><a href="https://github.com/AugustTan/documents/blob/master/UNIX%20Network%20Programming(Volume1%2C3rd).pdf">https://github.com/AugustTan/documents/blob/master/UNIX%20Network%20Programming(Volume1%2C3rd).pdf</a></a></h3>
<h3 id="httpsicsucieduaburtsev143a2017falllectures"><a class="header" href="#httpsicsucieduaburtsev143a2017falllectures"><a href="https://ics.uci.edu/~aburtsev/143A/2017fall/lectures/">https://ics.uci.edu/~aburtsev/143A/2017fall/lectures/</a></a></h3>
<p><code>Gas kuliah online tiada kata untuk tidak belajar, di topik ini Pak aburtsev membahas sistem operasi, sistem locknya, memory managemen, kernel, boot step nya, dll</code></p>
<h3 id="httposblogstephenmarzcomindexhtml"><a class="header" href="#httposblogstephenmarzcomindexhtml"><a href="http://osblog.stephenmarz.com/index.html">http://osblog.stephenmarz.com/index.html</a></a></h3>
<h3 id="httpsc-aresorgdocshtmlexamples"><a class="header" href="#httpsc-aresorgdocshtmlexamples"><a href="https://c-ares.org/docs.html#examples">https://c-ares.org/docs.html#examples</a></a></h3>
<p>dokumentasi C-ares (async dns resolver)</p>
<h3 id="httpsgithubcomtorvaldslinuxblobd683b96b072dc4680fc74964eca77e6a23d1fa6edriverscharrandomcl55"><a class="header" href="#httpsgithubcomtorvaldslinuxblobd683b96b072dc4680fc74964eca77e6a23d1fa6edriverscharrandomcl55"><a href="https://github.com/torvalds/linux/blob/d683b96b072dc4680fc74964eca77e6a23d1fa6e/drivers/char/random.c#L55">https://github.com/torvalds/linux/blob/d683b96b072dc4680fc74964eca77e6a23d1fa6e/drivers/char/random.c#L55</a></a></h3>
<p>"Computers are very predictable devices.  Hence it is extremely hard to produce truly random numbers on a computer"</p>
<h3 id="httpsstackoverflowcomquestions17898989what-is-global-start-in-assembly-language"><a class="header" href="#httpsstackoverflowcomquestions17898989what-is-global-start-in-assembly-language"><a href="https://stackoverflow.com/questions/17898989/what-is-global-start-in-assembly-language">https://stackoverflow.com/questions/17898989/what-is-global-start-in-assembly-language</a></a></h3>
<p>If you want to use a different entry point name other than _start (which is the default), you can specify -e parameter to ld like</p>
<p><code>ld -e my_entry_point -o output_filename object_filename</code></p>
<h3 id="inline-asm-gcc"><a class="header" href="#inline-asm-gcc">inline ASM GCC</a></h3>
<ul>
<li><a href="https://gcc.gnu.org/onlinedocs/gcc/Extended-Asm.html">https://gcc.gnu.org/onlinedocs/gcc/Extended-Asm.html</a></li>
<li><a href="https://gcc.gnu.org/onlinedocs/gcc/Extended-Asm.html#AssemblerTemplate">https://gcc.gnu.org/onlinedocs/gcc/Extended-Asm.html#AssemblerTemplate</a></li>
<li><a href="https://splichal.eu/gccsphinx-final/html/gcc/extensions-to-the-c-language-family/how-to-use-inline-assembly-language-in-c-code.html#inputoperands">https://splichal.eu/gccsphinx-final/html/gcc/extensions-to-the-c-language-family/how-to-use-inline-assembly-language-in-c-code.html#inputoperands</a></li>
</ul>
<h3 id="httpwwwucwczhubickapapersamd64node1html"><a class="header" href="#httpwwwucwczhubickapapersamd64node1html"><a href="http://www.ucw.cz/~hubicka/papers/amd64/node1.html">http://www.ucw.cz/~hubicka/papers/amd64/node1.html</a></a></h3>
<p>movabs is ATT-syntax for mov al/ax/eax/rax, byte/[d|q]word ptr [&lt;64-bit absolute address&gt;] or mov byte/[d|q]word ptr[&lt;64-bit absolute address&gt;], al/ax/eax/rax</p>
<p>tambahan:
movabs is used for absolute data moves, to either load an arbitrary 64-bit constant into a register or to load data in a register from a 64-bit address.</p>
<h3 id="httpselectronicsreferencecomassembly-languageassembly-language-registers"><a class="header" href="#httpselectronicsreferencecomassembly-languageassembly-language-registers"><a href="https://electronicsreference.com/assembly-language/assembly-language-registers/">https://electronicsreference.com/assembly-language/assembly-language-registers/</a></a></h3>
<h3 id="bookmark-movabs"><a class="header" href="#bookmark-movabs">bookmark movabs</a></h3>
<ul>
<li>http://www.ucw.cz/~hubicka/papers/amd64/node1.html</li>
<li>https://gcc.gnu.org/bugzilla/show_bug.cgi?id=82339</li>
<li>https://cs4157.github.io/www/2024-1/lect/13-x86-assembly.html</li>
</ul>
<h3 id="memory-layout-linux"><a class="header" href="#memory-layout-linux">memory layout linux</a></h3>
<ul>
<li><a href="https://www.kernel.org/doc/html/v5.8/x86/x86_64/mm.html">https://www.kernel.org/doc/html/v5.8/x86/x86_64/mm.html</a></li>
</ul>
<h2 id="this-section-is-pure-form-created-when-i-use-mdbook"><a class="header" href="#this-section-is-pure-form-created-when-i-use-mdbook">this section is pure form, created when I use mdbook</a></h2>
<h3 id="getopt-example"><a class="header" href="#getopt-example">getopt example</a></h3>
<ul>
<li><a href="https://www.gnu.org/software/libc/manual/html_node/Example-of-Getopt.html">https://www.gnu.org/software/libc/manual/html_node/Example-of-Getopt.html</a></li>
</ul>
<h3 id="manage-email-using-lei"><a class="header" href="#manage-email-using-lei">manage email using LEI</a></h3>
<ul>
<li>
<p><a href="https://people.kernel.org/monsieuricon/lore-lei-part-1-getting-started">https://people.kernel.org/monsieuricon/lore-lei-part-1-getting-started</a></p>
</li>
<li>
<p><a href="https://docs.kernel.org/maintainer/feature-and-driver-maintainers.html">https://docs.kernel.org/maintainer/feature-and-driver-maintainers.html</a></p>
</li>
</ul>
<h3 id="intel-sgx"><a class="header" href="#intel-sgx">intel SGX</a></h3>
<p><a href="https://docs.kernel.org/arch/x86/sgx.html">https://docs.kernel.org/arch/x86/sgx.html</a></p>
<h3 id="system-v-abi"><a class="header" href="#system-v-abi">system V abi</a></h3>
<ul>
<li><a href="https://refspecs.linuxfoundation.org/LSB_2.1.0/LSB-Core-generic/LSB-Core-generic/normativerefs.html#STD.ABIUPDATE">https://refspecs.linuxfoundation.org/LSB_2.1.0/LSB-Core-generic/LSB-Core-generic/normativerefs.html#STD.ABIUPDATE</a></li>
</ul>
<h3 id="elf-structure-types"><a class="header" href="#elf-structure-types">ELF Structure types</a></h3>
<ul>
<li><a href="https://refspecs.linuxfoundation.org/LSB_2.1.0/LSB-Core-generic/LSB-Core-generic/elftypes.html">https://refspecs.linuxfoundation.org/LSB_2.1.0/LSB-Core-generic/LSB-Core-generic/elftypes.html</a></li>
</ul>
<h3 id="elf-cheatsheet"><a class="header" href="#elf-cheatsheet">ELF cheatsheet</a></h3>
<ul>
<li><a href="https://gist.github.com/x0nu11byt3/bcb35c3de461e5fb66173071a2379779">https://gist.github.com/x0nu11byt3/bcb35c3de461e5fb66173071a2379779</a></li>
<li><a href="https://www.uclibc.org/docs/elf-64-gen.pdf">https://www.uclibc.org/docs/elf-64-gen.pdf</a></li>
</ul>
<h3 id="amd--clang"><a class="header" href="#amd--clang">AMD &amp; clang</a></h3>
<ul>
<li><a href="https://rocm.docs.amd.com/projects/llvm-project/en/latest/LLVM/clang/html/ClangFormatStyleOptions.html">https://rocm.docs.amd.com/projects/llvm-project/en/latest/LLVM/clang/html/ClangFormatStyleOptions.html</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="resume-alpro"><a class="header" href="#resume-alpro">Resume alpro</a></h1>
<h2 id="flowchart"><a class="header" href="#flowchart">flowchart</a></h2>
<p>Apa itu flowchart? simplenya, flowchat itu semacam bentuk gambar atau visual dari suatu langkah langkah algoritma. dan tentunya karna ini algoritma, maka ada step step seperti jika x maka y, lalu panah panah dari atas ke bawah, lalu input, dll. contoh flowchart cara memperbiaki lampu</p>
<p><img src="other//assets/LampFlowchart.svg" alt="gambar" /></p>
<h2 id="class"><a class="header" href="#class">Class</a></h2>
<pre><code>Apa itu class? class adalah cara kita mengatur kode agar scope nya bisa dipecah, misal func a isinya ada 1000 line, nah agar mudah mendebugnya, kita bisa pecah ke method method yang sangat banyak, dan juga kita tidak perlu lagi pusing dengan banyak variabel, kita cukup memakai satu varlable, lalu gunakan di seluruh class yang dinamai "property"

contoh simple, pakai property untuk nyimpan-tampilkan data,
</code></pre>
<pre><code class="language-cpp">#include &lt;string&gt;
#include &lt;iostream&gt;

using namespace std;

class abc {
    string nama;
public:
    void set_nama(string nama) {
        this-&gt;nama = nama;
    }

    void get_nama() {
        cout &lt;&lt; this-&gt;nama &lt;&lt; endl;
    }
};

int main() {
    abc abc;
    abc.set_nama("fadhil");
    abc.get_nama();
}
</code></pre>
<h2 id="enkapsulasi-encapsulation"><a class="header" href="#enkapsulasi-encapsulation">Enkapsulasi (encapsulation)</a></h2>
<p>Trik atau cara agar kita bisa memberi aturan ke class/property apakah ia bisa terlihat (public)? atau tidak (private/protected) ke class.</p>
<p>Intinya, bagaimana cara kita agar method atau property, tidak bisa secara sembarang diakses oleh kode lain. misal kita ada class trigonometri, dan method hitung sin, tetapi didalam hitung sin tersebut, ada method kecil kecil lagi yang banyak, tetapi fungsinya seperti hanya untuk ngebantu fungsi sin menjalankan tugasnya, nah fungsi2 yang kecil tadi itu nanti dibuat private, sedangkan fungsi sin yg dipakai dimana mana, dibuat public.</p>
<p>contoh kecil</p>
<pre><code class="language-cpp">#include &lt;string&gt;
#include &lt;iostream&gt;

using namespace std;

class abc {
    string nama;
private:
    void print_perkenalan() {
        cout &lt;&lt; "perkenalkan nama saya ";
    }

public:
    void set_nama(string nama) {
        this-&gt;nama = nama;
    }

    void get_nama() {
        this-&gt;print_perkenalan();
        cout &lt;&lt; this-&gt;nama &lt;&lt; endl;
    }
};

int main() {
    abc abc;
    abc.set_nama("fadhil");
    abc.get_nama();
}
</code></pre>
<p>terlihat public, private? nah itu adalah contoh encapsulation.</p>
<p>nah, <code>print_perkenalan</code> (hanya contoh) bertindak seolah olah dia hanya internal function dari suatu class yg besar. dan yang dipanggil dimana mana adalah get nama, dimana dibaliknya dia manggil banyak func yang lain.</p>
<p>dan <code>print_perkenalan</code> tidak boleh diakses langsung. termasuk property <code>nama</code> juga tidak boleh diakses langsung</p>
<h2 id="sorting"><a class="header" href="#sorting">Sorting</a></h2>
<h3 id="bubble-sort"><a class="header" href="#bubble-sort">Bubble Sort</a></h3>
<p>Konsepnya, dengan cara melempar lempar data array, sampai dia urut, BigO nya <code>O(n^2)</code>. cara kerja nya yaitu dengan cara menukar-nukar posisi array sekarang dengan array didepannya, jika array saat ini &gt; dari array didepannya, maka tukar posisinya</p>
<p>misal ada data simple seperti ini</p>
<pre><code class="language-txt">2  3  1  (awal mulanya)
2  1  3  (3 ditukar karna 3 &gt; 1)
1  2  3 (2 ditukar karna 2 &gt; 1)
1  2  3  (selesai)
</code></pre>
<h3 id="selection-sort"><a class="header" href="#selection-sort">Selection Sort</a></h3>
<p>TL;DR, menemukan data yg lebih kecil dari nilai minimum saat ini, tunggu loopnya yang didalam selesai baru di swap.</p>
<pre><code class="language-txt">contoh kita akan sorting

2  9  4   1  (belum diapa-apakan)
2  9  4   1  (minimum index ke 0, yaitu 2)
2  9  4   1  (bandingkan 9 dgn index ke 0 yaitu 2, 9 &lt; 2 false)
2  9  4   1  (bandingkan 4 dgn index ke 0, yaitu 2, 4 &lt; 2, false)
2  9  4   1  (bandingkan 1 dgn index ke 0, yaitu 2, 1 &lt; 2, true, maka tukar)
1  9  4   2  (set minimum di index  ke 1 sekarang, yaitu 9)
1  9  4   2  (bandingkan 4 dgn index ke 1, 4 &lt; 9, true, maka kita biarkan karna loop belum selesai, tapi set minimum ke 4)
1  9  4   2  (cek apakah 2 &lt; 4, ya, set minimum ke 2)
1  2  4   9  (tukar)
1  2  4   9  (set minimum ke index ke 3, yaitu 4, apakah 9 &lt; 4, tidak)
--end---
</code></pre>
<h3 id="insertion-sort"><a class="header" href="#insertion-sort">insertion sort</a></h3>
<p>Konsepnya, misal lagi menyusun kartu dari satu per satu. Jadi kamu ambil satu kartu, terus kamu bandingin ke kiri, kalau dia lebih kecil dari yang di kiri-nya, tukar posisinya. Terus begitu sampai semua kartu (data) urut</p>
<p>contoh</p>
<pre><code class="language-txt">5 3 4 1 (unchanged)
3 5 4 1 (3 dimasukkan ke kiri 5 karena 3 &lt; 5)
3 4 5 1 (4 dimasukkan, dia lebih kecil dari 5, jadi tukar)
1 3 4 5 (1 dimasukkan paling kiri, karena dia lebih kecil dari semuanya)
</code></pre>
<h3 id="merge-sort"><a class="header" href="#merge-sort">merge sort</a></h3>
<p>misal ada data, terus di bagi-bagi tumpukan data jadi kecil-kecil dulu sampai tinggal satuan, baru nanti disusun lagi sambil dibandingin dan digabungin pelan-pelan sampai jadi urut.
Cara kerjanya pakai prinsip divide and conquer
Jadi data dibelah-belah jadi dua terus, sampai tinggal 1-an, lalu disatukan lagi sambil diurutin.</p>
<p>contoh gifnya (google)
<img src="other//assets/merge-sort-400.gif"></p>
<h3 id="sequential-search"><a class="header" href="#sequential-search">sequential search</a></h3>
<p>nah, ini search paling gampang wkwkwk, intinya loop terus array nya, jika ketemu idx nya pakai if else, maka break loopnya &amp; end</p>
<h3 id="binary-searching"><a class="header" href="#binary-searching">binary searching</a></h3>
<p>cara mencarinya data dibagi 2 ditengah tengah, lalu setelah dibagi 2, akan ada low (pojok kiri), mid (tengah tengah), high (pojok kanan). lalu cek saja pastikan data yg dicari == mid</p>
<p>jika tidak, maka cek statusnya dia kurang dari mid atau lebih, jika lebih, cari bagian kanan, jika kurang, cari bagian kiri. proses ini diulang terus dan tiap2 menemukan low dan high baru, maka mid pasti berubah.</p>
<h3 id="single-linked-list"><a class="header" href="#single-linked-list">single linked list</a></h3>
<p>misal, ini PSEUDOCODE</p>
<pre><code class="language-txt">struct node {
    data_asli,
    pointer_ke_struct_node_lain_sebut_saja_n
}
</code></pre>
<p>misal, kita define struct node sebagai a, maka kita ambil addr nya, lalu define lagi b, dimana b berisi data dan juga pointer ke a, lalu misal define lagi c, isinya pointer ke b.</p>
<p>maka secara harfiah, c -&gt; b -&gt; a
nah, untuk pengecekan, loop lalu deference terus saja untuk pointernya, jadi yg awalnya di c, setelah deference pointer milik b, posisi sekarang di b, lalu deference pointer next nya, alhasil kita dapat a, dan agar bisa stop. maka bagian palig akhir harus dikasih tanda, contoh disini tandanya bisa pakai nullptr.</p>
<p>intinya jika pas di deference isinya nullptr, maka sudah selesai</p>
<h2 id="sinle-linked-list-circular"><a class="header" href="#sinle-linked-list-circular">sinle linked list circular</a></h2>
<p>sama saja seperti single linked list, hanya aja dibagian akhir daripada diisi nullptr, kita isi pointer balik ke awal. alhasil dia seperti memutar.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="resume-alpro-double-linkedlists"><a class="header" href="#resume-alpro-double-linkedlists">Resume alpro double linkedlists</a></h1>
<p>langsung saja ini kodenya, 3 kode bebas, disini saya wrap di func saja karna agar tidak perlu buat banyak file.</p>
<p>penjelasan kode ADA DIBAGIAN BAWAH SNIPPET KODE ini.</p>
<pre><code class="language-cpp">#include &lt;cstddef&gt;
#include &lt;iostream&gt;

using namespace std;

struct Node {
  int data;
  Node *prev;
  Node *next;
};

Node *create_node(int data) {
  Node *newly_created_node = new Node;

  newly_created_node-&gt;data = data;
  newly_created_node-&gt;next = nullptr;
  newly_created_node-&gt;prev = nullptr;

  return newly_created_node;
}

void print(Node *head) {
  Node *current = head;
  cout &lt;&lt; "Informasi tentang setiap node:" &lt;&lt; endl;
  while (current != nullptr) {
    cout &lt;&lt; "Alamat: " &lt;&lt; current &lt;&lt; endl;
    cout &lt;&lt; "Nilai: " &lt;&lt; current-&gt;data &lt;&lt; endl;
    cout &lt;&lt; "Alamat prev: " &lt;&lt; current-&gt;prev &lt;&lt; endl;
    cout &lt;&lt; "Alamat next: " &lt;&lt; current-&gt;next &lt;&lt; endl &lt;&lt; endl;
    current = current-&gt;next;
  }
  cout &lt;&lt; "---------------------------------------" &lt;&lt; endl;
}

void insert_last(Node *&amp;head, int data) {
  Node *newly_created_node = create_node(data);
  if (head == nullptr) {
    head = newly_created_node;
  } else {
    Node *current = head;

    while (current-&gt;next != nullptr) {
      current = current-&gt;next;
    }

    current-&gt;next = newly_created_node;
    newly_created_node-&gt;prev = current;
  }
}

void insertFirst(Node *&amp;head, int data) {
  Node *newNode = create_node(data);
  if (head == nullptr) {
    head = newNode;
  } else {
    newNode-&gt;next = head;
    head-&gt;prev = newNode; 
    head = newNode;
  }
}

void delete_first(Node *&amp;head) {

  if (head == nullptr) {
    printf("node kosong\n");
  }

  Node *temp = head;
  head = head-&gt;next;

  if (head != nullptr) {
    head-&gt;prev = nullptr;
  }

  delete temp;
}

int main() {
  Node *head = nullptr;

  head = create_node(7);
  insert_last(head, 1);
  insert_last(head, 10);
  delete_first(head);
  insertFirst(head, 99);

  print(head);
}
</code></pre>
<h3 id="func-create_node"><a class="header" href="#func-create_node">func <code>create_node</code></a></h3>
<p>Walau bukan bagian dari tugas, saya sekalian jelaskan saja. intinya func ini membuat node baru, yang isinya prev dan next, diisi nullptr (alias nullpointer), dan datanya.</p>
<p>jadi maksud func ini, kita bikin node yang bener2 kosong tanpa terhubung ke siapapun. lalu return value nya.</p>
<h3 id="func-insert_last"><a class="header" href="#func-insert_last">func <code>insert_last</code></a></h3>
<p>Cara kerjanya spt ini.</p>
<ul>
<li>kita buat dulu node nya (node yg tidak terhubung dgn siapapun pakai create_node)</li>
<li>lalu cek, misalkan head yg dari func <code>main</code> itu masih nullptr (karna emang defaultnya nullptr), maka pertanda linked listsnya masih kosong, maka kita bisa timpa saja.</li>
<li>jika tidak? kita simpan dulu node saat ini, anggap saja namanya current</li>
<li>sudah kesimpan kan? current kita arahkan ke <code>current-&gt;next</code>, alhasil dia ngakses pointer selanjutnya, lalu cek apakah dia nullptr atau bukan (sbg penanda)</li>
<li>misal iya, maka saatnya berhenti, lalu sambung, intinya karna dibelakang nullptr, maka untuk nyambungnya, nullptr kita ganti saja pakai address node yang barusan dibuat.</li>
<li>agar bisa nyambung kebelaknng, maka prev (previus miliknya new node) kita timpa pakai current, kenapa? node yg terbaru itu prev nya masih nullptr, agar nyambung, maka kita harus isi dengan node sebelumnya yg sudah disimpan.</li>
</ul>
<p>nb: <code>Node *&amp;head</code> artinya nge-deferensi pointer, sekaligus kalau ada perubahan data, sekalian di update, jadi misal ubah data di func delete_last, maka kalau dibaca oleh insert_first, data yg kita share tetep singkron</p>
<h3 id="func-insertfirst"><a class="header" href="#func-insertfirst">func <code>insertFirst</code></a></h3>
<p>nah, ini func paling easy wkwk, karna head guarantee akan selalu point ke depan, maka untuk nyispin data didepan sangatlah easy.</p>
<p>buat node baru, lalu node baru (next nya) diisi head.
untuk prev (milik nya node lama) kita addr node baru.</p>
<h3 id="func-delete_first"><a class="header" href="#func-delete_first">func <code>delete_first</code></a></h3>
<p>konsepnya mirip dengan insert first, hanya saja</p>
<ul>
<li>karna head selalu point ke depan, maka kita perlu simpan head (yang sekarang), lalu saatnya pindah state ke node sebelahnya (kekanan)</li>
<li>lalu lanjut mark bahwa head-&gt;prev itu nullptr, artinya headnya pindah.</li>
<li>ok sudah, nah, head yang tadi disimpan, bisa di hapus pakai <code>delete</code></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="rumus-sector-disk-linux"><a class="header" href="#rumus-sector-disk-linux">Rumus sector disk Linux</a></h1>
<p>rumus sector linux</p>
<p>\( x \times 512 = (n \times 1024 \times 1024 \times 1024) \)</p>
<p>dan untuk \( n \) sesuaikan dengan kebutuhan.</p>
<p>disk sector mulai dari 2048. maka misal, x adalah 3145728, command parted nya
parted /dev/sda --script mkpart P1 ext4 2048s 3145728s
misal ingin menambah sekitar 500 MB, maka offset terakhir ditambah 1, misal</p>
<pre><code class="language-sh">parted /dev/sda --script mkpart P2 ext4 3145729s 4194304s
</code></pre>
<p>link referensi</p>
<ul>
<li><a href="https://wiki.archlinux.org/title/Parted#UEFI/GPT_examples">https://wiki.archlinux.org/title/Parted#UEFI/GPT_examples</a></li>
<li><a href="https://ioflood.com/blog/parted-linux-command/">https://ioflood.com/blog/parted-linux-command/</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="regex-notes"><a class="header" href="#regex-notes">Regex notes</a></h1>
<h2 id="letter--digits"><a class="header" href="#letter--digits">letter &amp; digits</a></h2>
<ul>
<li><code>\D+</code>: Matching all non digits, then  grouping</li>
</ul>
<h1 id="match-any-using-"><a class="header" href="#match-any-using-">match any using <code>.</code></a></h1>
<h2 id="the--match-all-chars-except-r-or-n"><a class="header" href="#the--match-all-chars-except-r-or-n">the <code>.</code> match all chars, except \r or \n</a></h2>
<p>example:
regexp: <code>r".+"</code></p>
<p>It will match anything as long as there is at least one character present. no empty string such ""</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="template-workspace-json-vscode"><a class="header" href="#template-workspace-json-vscode">template workspace json vscode</a></h1>
<pre><code class="language-json">{
  "folders": [
    {
      "path": "rpc"
    },
    {
      "path": "scraperlib"
    },
    {
      "path": "offlinelook"
    }
  ]
}
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="protobuf"><a class="header" href="#protobuf">Protobuf</a></h1>
<p>protobuf ini intinya format pertukaran data, mirip json, tapi dia pakai schema (mirip graphql), agak kaku, dan ada method2</p>
<p>baca spec: <a href="https://protobuf.dev/programming-guides/proto3/">https://protobuf.dev/programming-guides/proto3/</a></p>
<p>ini termasuk prelude nya</p>
<pre><code class="language-protobuf">syntax = "proto3";

// this is namefile 
package grpc.fadhil;
</code></pre>
<p>lalu ini anggap saja seperti struct, jika di C biasanya sent data over file pakai struct.</p>
<pre><code class="language-protobuf">message Message1 {}

message Message2 {
  Message1 foo = 1;
}

</code></pre>
<p>baru kita define semacam namespace yang didalamnya hold func func yang akan dicall oleh grpc</p>
<pre><code class="language-protobuf">service SearchService {
  rpc Search(SearchRequest) returns (SearchResponse);
}
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="subnetting"><a class="header" href="#subnetting">Subnetting</a></h1>
<p>pertama tama, range ip dahulu</p>
<ul>
<li>
<p>A: 1 - 127</p>
</li>
<li>
<p>B: 128 - 191</p>
</li>
<li>
<p>C: 192 - AKHIR</p>
</li>
<li>
<p><code>0b00000000</code> -&gt; 0 (katakanlah octet ke 4, cidr 24)</p>
</li>
<li>
<p><code>0b10000000</code> -&gt; 0 (cidr 25, 128 hosts)							// 2 network</p>
</li>
<li>
<p><code>0b11000000</code> -&gt; 0 (cidr 26, 128 + 64)								// 4 network</p>
</li>
<li>
<p><code>0b11100000</code> -&gt; 0 (cidr 27, 128 + 64 + 32)						// 8 network</p>
</li>
<li>
<p><code>0b11110000</code> -&gt; 0 (cidr 28, 128 + 64 + 32 + 16)					// 16 network</p>
</li>
<li>
<p><code>0b11111000</code> -&gt; 0 (cidr 29, 128 + 64 + 32 + 16 + 8)				// 32 network</p>
</li>
<li>
<p><code>0b11111100</code> -&gt; 0 (cidr 30, 128 + 64 + 32 + 16 + 8 + 4)			// 64 network</p>
</li>
<li>
<p><code>0b11111110</code> -&gt; 0 (cidr 31, 128 + 64 + 32 + 16 + 8 + 4 + 2)		// 128 network</p>
</li>
<li>
<p><code>0b11111111</code> -&gt; 0 (cidr 32, 128 + 64 + 32 + 16 + 8 + 4 + 2 + 1)	// 256 network</p>
</li>
</ul>
<p>seperti yg terlihat, bahwa <code>128 + 64 + 32 + 16 + 8 + 4 + 2 + 1</code> = <code>255</code></p>
<h2 id="contoh-19216810024"><a class="header" href="#contoh-19216810024">contoh 192.168.10.0/24:</a></h2>
<p>ada network 192.168.10.0/24, kita ingin bagi jadi 4 jaringan. maka 256 / 4 = 64 hosts, dan ini akan</p>
<ul>
<li>subnet nya: 255.255.255.192</li>
<li>64 hosts: 64 hosts usable, 1 untuk broadcast, 1 untuk network</li>
</ul>
<p>pembagian nya</p>
<ul>
<li>network 1:  192.168.10.0, broadcast: 192.168.10.63, range ip yang usable: 192.168.10.1 - 192.168.10.62</li>
<li>network 2:  192.168.10.64, broadcast: 192.168.10.127, range ip yang usable: 192.168.10.65 - 192.168.10.126</li>
<li>network 3:  192.168.10.128, broadcast: 192.168.10.191, range ip yang usable: 192.168.10.129 - 192.168.10.190</li>
<li>network 4:  192.168.10.192, broadcast: 192.168.10.255, range ip yang usable: 192.168.10.193 - 192.168.10.254</li>
</ul>
<h2 id="oprekan-hitung2-an"><a class="header" href="#oprekan-hitung2-an">oprekan hitung2 an:</a></h2>
<p>origin: pakai acuan ip kelas c</p>
<p>jumlah hosts, misal cidr 24, itu max nya 256 kalau 0b11111111, kenapa 0b10000000 itu 128, dan kenapa 0b11000000 itu 192</p>
<p>ok, lalu kenapa jika cidr /26, itu 255.255.255.192, punya 64 hosts, 4 network. semua ini didapat dari
(max int case ini 8 bit) / maxint - pad network</p>
<p>ini start dari /24</p>
<ul>
<li><code>0b00000000</code> -&gt; 0 (katakanlah octet ke 4, cidr 24)				// 1 network</li>
<li><code>0b10000000</code> -&gt; 0 (cidr 25, 128 hosts)							// 2 network</li>
<li><code>0b11000000</code> -&gt; 0 (cidr 26, 128 + 64)								// 4 network</li>
<li><code>0b11100000</code> -&gt; 0 (cidr 27, 128 + 64 + 32)						// 8 network</li>
<li><code>0b11110000</code> -&gt; 0 (cidr 28, 128 + 64 + 32 + 16)					// 16 network</li>
<li><code>0b11111000</code> -&gt; 0 (cidr 29, 128 + 64 + 32 + 16 + 8)				// 32 network</li>
<li><code>0b11111100</code> -&gt; 0 (cidr 30, 128 + 64 + 32 + 16 + 8 + 4)			// 64 network</li>
<li><code>0b11111110</code> -&gt; 0 (cidr 31, 128 + 64 + 32 + 16 + 8 + 4 + 2)		// 128 network</li>
<li><code>0b11111111</code> -&gt; 0 (cidr 32, 128 + 64 + 32 + 16 + 8 + 4 + 2 + 1)	// 256 network</li>
</ul>
<p>start dari /16</p>
<ul>
<li><code>0b0000000000000000</code> -&gt; 0 (cidr 16, 65535)								// 1 net, 65535 hosts</li>
<li><code>0b1000000000000000</code> -&gt; 0 (cidr 17, 65535 + )							// 2 net, 32767 hosts</li>
<li><code>0b1100000000000000</code> -&gt; 0 (cidr 26, 128 + 64)								// 4 net</li>
<li><code>0b1110000000000000</code> -&gt; 0 (cidr 27, 128 + 64 + 32)						// 8 net</li>
<li><code>0b1111000000000000</code> -&gt; 0 (cidr 28, 128 + 64 + 32 + 16)					// 16 net</li>
<li><code>0b1111100000000000</code> -&gt; 0 (cidr 29, 128 + 64 + 32 + 16 + 8)				// 32 net</li>
<li><code>0b1111110000000000</code> -&gt; 0 (cidr 30, 128 + 64 + 32 + 16 + 8 + 4)			// 64 net</li>
<li><code>0b1111111000000000</code> -&gt; 0 (cidr 31, 128 + 64 + 32 + 16 + 8 + 4 + 2)		// 128 net</li>
<li><code>0b1111111100000000</code> -&gt; 0 (cidr 32, 128 + 64 + 32 + 16 + 8 + 4 + 2 + 1)	// 256 net</li>
</ul>
<p>-- stagging (perhitungan ip cidr 16 keatas)
max int 16 bit: 65536</p>
<ul>
<li>/16 : <code>0b0000000000000000</code> = 0</li>
<li>/17 : <code>0b1000000000000000</code> = 32768, maka 65536 / 32768 = 2, alias 2 network, 32768 hosts</li>
<li>/18 : <code>0b1100000000000000</code> = 49152, maka 65536 / (65536 - 49152)  = 4 network, 16384 hosts,</li>
<li>/19 : <code>0b1110000000000000</code> = 57344, maka 65536 / (65536 - 57344)  = 8 network, 8192 hosts,</li>
<li>/20 : <code>0b1111000000000000</code> = 61440, maka 65536 / (65536 - 61440)  = 16 network, 4096 hosts,</li>
<li>/21 : <code>0b1111100000000000</code> = 61440, maka 65536 / (65536 - 61440)  = 32 network, 2048 hosts,</li>
<li>/22 : <code>0b1111110000000000</code> = 64512, maka 65536 / (65536 - 64512)  = 64 network, 1024 hosts,</li>
<li>/23 : <code>0b1111111000000000</code> = 64512, maka 65536 / (65536 - 64512)  = 128 network, 512 hosts,</li>
<li>/24 : <code>0b1111111100000000</code> = 64512, maka 65536 / (65536 - 64512)  = 256 network, 256 hosts,</li>
</ul>
<p>-- stagging cidr 8 keatas
max int int 24 bit: 16777216</p>
<ul>
<li>
<p>/9 : <code>0b100000000000000000000000</code> = 16777216 / (16777216 - 8388608) = 2 network, 8388608 hosts</p>
</li>
<li>
<p>/10: <code>0b110000000000000000000000</code> = 16777216 / (16777216 - 12582912)= 4 network, 4194304 hosts</p>
</li>
<li>
<p>/11: <code>0b111000000000000000000000</code> = 16777216 / (16777216 - 14680064)= 8 network, 2097152 hosts</p>
</li>
<li>
<p>/12: <code>0b111100000000000000000000</code> = 16777216 / (16777216 - 15728640)= 16 network, 1048576 hosts</p>
</li>
<li>
<p>/13: <code>0b111110000000000000000000</code> = 16777216 / (16777216 - 16252928)= 32 network, 524288 hosts</p>
</li>
<li>
<p>/14: <code>0b111111000000000000000000</code> = 16777216 / (16777216 - 16515072) = 64 network, 262144 hosts</p>
</li>
<li>
<p>/15: <code>0b111111100000000000000000</code> = 16777216 / (16777216 - 16646144) = 128 network, 131072 hosts</p>
</li>
<li>
<p>/16: <code>0b111111110000000000000000</code> = 16777216 / (16777216 - 16711680) = 256 network, 65536 hosts</p>
</li>
<li>
<p>/17: <code>0b111111111000000000000000</code> = 16777216 / (16777216 - 16744448) = 512 network, 32768 hosts</p>
</li>
<li>
<p>/18: <code>0b111111111100000000000000</code> = 16777216 / (16777216 - 16760832) = 1024 network, 16384 hosts</p>
</li>
<li>
<p>/19: <code>0b111111111110000000000000</code> = 16777216 / (16777216 - 16769024) = 2048 network, 8192 hosts</p>
</li>
<li>
<p>/20: <code>0b111111111111000000000000</code> = 16777216 / (16777216 - 16773120) = 4096 network, 4096 hosts</p>
</li>
<li>
<p>/21: <code>0b111111111111100000000000</code> = 16777216 / (16777216 - 16775168) = 8192 network, 2048 hosts</p>
</li>
<li>
<p>/9 : 0b100000000000000000000000:</p>
</li>
</ul>
<h1 id="kumpulan-rumus-rumus"><a class="header" href="#kumpulan-rumus-rumus">kumpulan rumus rumus</a></h1>
<h2 id="subnet"><a class="header" href="#subnet">subnet</a></h2>
<p>rumusnya: \( 2^{jumlah \space angka \space 1 \space di \space setiap \space padding \space subnet}\)</p>
<h3 id="contoh-1"><a class="header" href="#contoh-1">contoh</a></h3>
<ul>
<li>prefix /19, pad terdekatnya /16, maka dari 16 ke 19 ada 3 angka 1 (<code>0b11100000</code>), maka jumlah subnet yang akan terbentuk adalah 2^3 = 8 subnet</li>
<li>prefix /26, pad terdekatnya 24, maka dari 24 ke 26 ada 2 angka 1 (<code>0b11000000</code>), maka jumlah subnetnya 2^2 = 4</li>
</ul>
<h2 id="jumlah-hosts"><a class="header" href="#jumlah-hosts">jumlah hosts</a></h2>
<p>rumusnya: \( 2^{jumlah \space angka \space 0 \space dari \space 32} \)</p>
<h3 id="contoh-2"><a class="header" href="#contoh-2">contoh</a></h3>
<ul>
<li>prefix /19, 32 - 19 = 13 angka 0, maka \( 2^{13} = 8192 \space hosts \)</li>
<li>prefix /26, 32 - 26 = 6 angka 0, maka \( 2^{6} = 64 \space hosts \)</li>
<li>prefix /8, 32 - 8 = 24 angka 0, maka \( 2^{24} = 16777216 \space hosts \)</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="inter-vlan-routing"><a class="header" href="#inter-vlan-routing">Inter-VLAN routing</a></h1>
<p>how to config vlan inter-VLAN routing</p>
<p>topology:</p>
<ul>
<li>VNET1:192.168.10.0/24 (vlan 10)</li>
<li>PC1: 192.168.10.2</li>
<li>PC2: 192.168.10.3</li>
<li>VNET2:192.168.20.0/24 (vlan 20)</li>
<li>PC3: 192.168.20.2</li>
<li>PC4: 192.168.20.3</li>
<li>ROUTER IP (fa0/0.10): 192.168.10.1</li>
<li>ROUTER IP (fa0/0.20): 192.168.20.1</li>
</ul>
<h1 id="scripts"><a class="header" href="#scripts">SCRIPTS</a></h1>
<h2 id="management"><a class="header" href="#management">management</a></h2>
<h3 id="--show-vlan-brief-show-all-configured-vlan"><a class="header" href="#--show-vlan-brief-show-all-configured-vlan">- <code>show vlan brief</code>: show all configured vlan</a></h3>
<h2 id="setup-vlan-tanpa-setup-ip-dulu"><a class="header" href="#setup-vlan-tanpa-setup-ip-dulu">setup vlan (tanpa setup ip dulu)</a></h2>
<pre><code class="language-sh">Switch&gt;enable
Switch#conf t
Enter configuration commands, one per line.  End with CNTL/Z.
Switch(config)#vlan 10
Switch(config-vlan)#name SALES
Switch(config-vlan)#ex
Switch(config)#vlan 20
Switch(config-vlan)#name IT
</code></pre>
<h2 id="lalu-setup-mode"><a class="header" href="#lalu-setup-mode">lalu setup mode</a></h2>
<ul>
<li>trunk: untuk switch ke router</li>
<li>access: untuk switch ke PC</li>
</ul>
<p>setup untuk vlan 10 dan 10, masing2 dengan network 192.168.10.0/24 dan 192.168.20.0/24</p>
<p>script:</p>
<pre><code class="language-sh">Switch#conf t
Enter configuration commands, one per line.  End with CNTL/Z.
Switch(config)#int fa0/1
Switch(config-if)#switchport mode access
Switch(config-if)#switchport access vlan 10
Switch(config-if)#ex
Switch(config)#int fa0/2
Switch(config-if)#switchport mode access
Switch(config-if)#switchport access vlan 10
Switch(config-if)#ex
Switch(config)#int fa0/3
Switch(config-if)#switchport mode access
Switch(config-if)#switchport access vlan 20
Switch(config-if)#ex
Switch(config)#int fa0/4
Switch(config-if)#switchport mode access
Switch(config-if)#switchport access vlan 20
Switch(config-if)#ex
Switch(config)#
</code></pre>
<p>alternative script</p>
<pre><code class="language-sh">Switch(config-if)#int range fa0/1-4
Switch(config-if-range)#switchport mode access
</code></pre>
<h2 id="config-untuk-port-fa05-ke-router-pakai-mode-trunk"><a class="header" href="#config-untuk-port-fa05-ke-router-pakai-mode-trunk">config untuk port fa0/5 ke router (pakai mode trunk)</a></h2>
<pre><code class="language-sh">Switch(config)#int fa0/5
Switch(config-if)#switchport mode trunk
Switch(config-if)#
</code></pre>
<h1 id="inter-vlan-routing-1"><a class="header" href="#inter-vlan-routing-1">inter-VLAN routing</a></h1>
<h2 id="enable-port-fa00-tanpa-assign-ip-dahulu"><a class="header" href="#enable-port-fa00-tanpa-assign-ip-dahulu">enable port Fa0/0 (tanpa assign ip dahulu)</a></h2>
<pre><code class="language-sh">Router(config)#int fa0/0
Router(config-if)#no shut

Router(config-if)#
%LINK-5-CHANGED: Interface FastEthernet0/0, changed state to up

%LINEPROTO-5-UPDOWN: Line protocol on Interface FastEthernet0/0, changed state to up
</code></pre>
<h2 id="assign-ip-untuk-masing2-vlan"><a class="header" href="#assign-ip-untuk-masing2-vlan">assign ip untuk masing2 vlan</a></h2>
<pre><code class="language-sh">Router(config)#interface FastEthernet0/0
Router(config-if)#int fa0/0.10
Router(config-subif)#
%LINK-5-CHANGED: Interface FastEthernet0/0.10, changed state to up

%LINEPROTO-5-UPDOWN: Line protocol on Interface FastEthernet0/0.10, changed state to up

Router(config-subif)#encapsulation dot1q 10 
Router(config-subif)#ip add 192.168.10.1 255.255.255.0
Router(config-subif)#ex
Router(config)#int fa0/0.20
Router(config-subif)#
%LINK-5-CHANGED: Interface FastEthernet0/0.20, changed state to up

%LINEPROTO-5-UPDOWN: Line protocol on Interface FastEthernet0/0.20, changed state to up

Router(config-subif)#encapsulation dot1q 20
Router(config-subif)#ip add 192.168.20.1 255.255.255.0
Router(config-subif)#
</code></pre>
<h2 id="hasil-output-show-vlan-brief"><a class="header" href="#hasil-output-show-vlan-brief">hasil output <code>show vlan brief</code></a></h2>
<pre><code class="language-sh">Switch&gt;show vlan brief

VLAN Name                             Status    Ports
---- -------------------------------- --------- -------------------------------
1    default                          active    Fa0/6, Fa0/7, Fa0/8, Fa0/9
                                                Fa0/10, Fa0/11, Fa0/12, Fa0/13
                                                Fa0/14, Fa0/15, Fa0/16, Fa0/17
                                                Fa0/18, Fa0/19, Fa0/20, Fa0/21
                                                Fa0/22, Fa0/23, Fa0/24, Gig0/1
                                                Gig0/2
10   SALES                            active    Fa0/1, Fa0/2
20   IT                               active    Fa0/3, Fa0/4
1002 fddi-default                     active    
1003 token-ring-default               active    
1004 fddinet-default                  active    
1005 trnet-default                    active    
Switch&gt;
</code></pre>
<h2 id="tambahan-2"><a class="header" href="#tambahan-2">tambahan</a></h2>
<ul>
<li>encapsulation dot1q: router on stick routing</li>
</ul>
<h3 id="advanced-switch-cisco-command"><a class="header" href="#advanced-switch-cisco-command">Advanced switch cisco command</a></h3>
<div style="break-before: page; page-break-before: always;"></div><h1 id="tealinux-qemu-promp--testing"><a class="header" href="#tealinux-qemu-promp--testing">Tealinux qemu promp &amp; testing</a></h1>
<h2 id="create-image-1"><a class="header" href="#create-image-1">create image</a></h2>
<p><code>qemu-img create -f qcow2 &lt;NAME&gt;.img 45G</code></p>
<ul>
<li>Change 45G with your desired size</li>
</ul>
<h2 id="running-system-on-bios-mode"><a class="header" href="#running-system-on-bios-mode">running system on BIOS mode</a></h2>
<p>this will open SSH connection on port 20022</p>
<h2 id="live"><a class="header" href="#live">live</a></h2>
<pre><code class="language-sh">qemu-system-x86_64 \
                -enable-kvm \
                -boot order=d \
                -cdrom tealinux-2025.02.16-x86_64.iso \
                -drive file=tealinux.img,format=qcow2 \
                -m 4G \
                -enable-kvm \
                -smp 4 \
                -net user,hostfwd=tcp::20022-:22 \
                -net nic
</code></pre>
<h2 id="non-live"><a class="header" href="#non-live">non-live</a></h2>
<pre><code class="language-sh">qemu-system-x86_64 \
                -enable-kvm \
                -boot order=d \
                -drive file=tealinux.img,format=qcow2 \
                -m 4G \
                -enable-kvm \
                -smp 4 \
                -net user,hostfwd=tcp::20022-:22 \
                -net nic
</code></pre>
<h2 id="running-on-uefi-mode"><a class="header" href="#running-on-uefi-mode">running on UEFI mode</a></h2>
<p>in order to running qemu on UEFI mode, we need <a href="https://archlinux.org/packages/extra/any/edk2-ovmf/">edk2-ovmf</a></p>
<p>get your ovmf vars by running <code>cp /usr/share/edk2/x64/OVMF_VARS.4m.fd .</code></p>
<h2 id="live-1"><a class="header" href="#live-1">live</a></h2>
<pre><code class="language-sh">qemu-system-x86_64 \
                -enable-kvm \
                -cdrom tealinux-2025.02.16-x86_64.iso \
                -boot order=d \
                -drive if=pflash,format=raw,readonly=on,file=/usr/share/edk2/x64/OVMF_CODE.4m.fd \
                -drive if=pflash,format=raw,file=OVMF_VARS.4m.fd \
                -drive file=tealinux.img,format=qcow2 \
                -m 4G \
                -enable-kvm \
                -smp 4 \
                -net user,hostfwd=tcp::20022-:22 \
                -net nic
</code></pre>
<h2 id="non-live-1"><a class="header" href="#non-live-1">non-live</a></h2>
<pre><code class="language-sh">qemu-system-x86_64 \
                -enable-kvm \
                -boot order=d \
                -drive if=pflash,format=raw,readonly=on,file=/usr/share/edk2/x64/OVMF_CODE.4m.fd \
                -drive if=pflash,format=raw,file=OVMF_VARS.4m.fd \
                -drive file=tealinux.img,format=qcow2 \
                -m 4G \
                -enable-kvm \
                -smp 4 \
                -net user,hostfwd=tcp::20022-:22 \
                -net nic
</code></pre>
<h2 id="windows"><a class="header" href="#windows">windows</a></h2>
<pre><code class="language-sh">qemu-system-x86_64 \
                -enable-kvm \
                -boot order=d \
                -cdrom Win10_22H2_English_x64v1.iso \
                -drive file=windows-tealinux-mbr.img,format=qcow2 \
                -m 4G \
                -enable-kvm \
                -smp 4 \
                -net user,hostfwd=tcp::20022-:22 \
                -net nic
</code></pre>
<p>uefi version</p>
<pre><code class="language-sh">qemu-system-x86_64 \
                 -enable-kvm \
                 -boot order=d \
                 -cdrom Win10_22H2_English_x64v1.iso \
                 -drive if=pflash,format=raw,readonly=on,file=/usr/share/edk2/x64/OVMF_CODE.4m.fd \
                 -drive if=pflash,format=raw,file=OVMF_VARS.4m.fd \
                 -drive file=tealinux.img,format=qcow2 \
                 -m 4G \
                 -enable-kvm \
                 -smp 4 \
                 -net user,hostfwd=tcp::20022-:22
</code></pre>
<p>note: bug unwrap error</p>
<pre><code class="language-sh">qemu-system-x86_64 \
                      -enable-kvm \
                      -boot order=d \
                      -cdrom tealinux-2025.02.16-x86_64.iso \
      -drive if=pflash,format=raw,readonly=on,file=/usr/share/edk2/x64/OVMF_CODE.4m.fd \
                      -drive if=pflash,format=raw,file=OVMF_VARS.4m.fd \
                      -drive file=tealinux.img,format=qcow2 \
                      -m 4G \
                      -enable-kvm \
                      -smp 4 \
                      -net user,hostfwd=tcp::20022-:22 \
      -net nic
</code></pre>
<h2 id="misc"><a class="header" href="#misc">misc</a></h2>
<h3 id="add-more-drive"><a class="header" href="#add-more-drive">add more drive</a></h3>
<p>in order add more drive, use this param</p>
<ul>
<li><code>-drive file=img1.img,format=qcow2</code></li>
<li><code>-drive file=img1.img,format=qcow2</code></li>
</ul>
<h2 id="forward-more-port"><a class="header" href="#forward-more-port">forward more port</a></h2>
<p>imagine you need to forward another port, not only ssh, the correct command is
<code>-net user,hostfwd=tcp::10022-:22,hostfwd=tcp::8080-:8080,hostfwd=tcp::5173-:5173</code></p>
<p>5173 is our port.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="tealinux-qemu-promp--testing-2"><a class="header" href="#tealinux-qemu-promp--testing-2">Tealinux qemu promp &amp; testing 2</a></h1>
<h2 id="windows-10-section"><a class="header" href="#windows-10-section">Windows 10 section</a></h2>
<p>this section show various command that windows related</p>
<h3 id="running-on-gpt"><a class="header" href="#running-on-gpt">running on GPT</a></h3>
<ul>
<li>live</li>
</ul>
<pre><code class="language-bash"># clone uefi vars
cp /usr/share/edk2/x64/OVMF_VARS.4m.fd .
mv OVMF_VARS.4m.fd OVMF_VARS_windows_gpt.4m.fd

# create image
qemu-img create -f qcow2 windows_10_gpt_no_fb.img 50G

# run iso
qemu-system-x86_64 \
	-enable-kvm \
	-cdrom Win10_22H2_English_x64v1.iso \
	-drive if=pflash,format=raw,readonly=on,file=/usr/share/edk2/x64/OVMF_CODE.4m.fd \
	-drive if=pflash,format=raw,file=OVMF_VARS_windows_gpt.4m.fd \
	-drive file=windows_10_gpt_no_fb.img,format=qcow2 \
	-m 4G \
	-smp 4

</code></pre>
<ul>
<li>non live</li>
</ul>
<pre><code class="language-bash"># run iso
qemu-system-x86_64 \
	-enable-kvm \
	-drive if=pflash,format=raw,readonly=on,file=/usr/share/edk2/x64/OVMF_CODE.4m.fd \
	-drive if=pflash,format=raw,file=OVMF_VARS.4m.fd \
	-drive file=windows_10_gpt_no_fb.img,format=qcow2 \
	-m 4G \
	-smp 4

</code></pre>
<p>notes:
run with vga</p>
<ul>
<li><code>-vga virtio</code></li>
</ul>
<h3 id="running-tealinux-alongside-windows"><a class="header" href="#running-tealinux-alongside-windows">running tealinux (alongside windows)</a></h3>
<pre><code class="language-bash">qemu-system-x86_64 \
	-enable-kvm \
	-cdrom tealinux-2025.02.16-x86_64.iso \
	-drive if=pflash,format=raw,readonly=on,file=/usr/share/edk2/x64/OVMF_CODE.4m.fd \
	-drive if=pflash,format=raw,file=OVMF_VARS_windows_gpt.4m.fd \
	-drive file=windows_10_gpt_no_fb.img,format=qcow2 \
	-m 4G \
	-smp 4
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="binary-operation"><a class="header" href="#binary-operation">binary operation</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="catatan-subnetting-from-scratch"><a class="header" href="#catatan-subnetting-from-scratch">catatan subnetting from scratch</a></h1>
<p>origin: pakai acuan ip kelas c</p>
<p>jumlah hosts, misal cidr 24, itu max nya 256 kalau 0b11111111, kenapa 0b10000000 itu 128, dan kenapa 0b11000000 itu 192</p>
<p>ok, lalu kenapa jika cidr /26, itu 255.255.255.192, punya 64 hosts, 4 network. semua ini didapat dari
(max int case ini 8 bit) / maxint - pad network</p>
<p>ini start dari /24</p>
<ul>
<li><code>0b00000000</code> -&gt; 0 (katakanlah octet ke 4, cidr 24)				// 1 network</li>
<li><code>0b10000000</code> -&gt; 0 (cidr 25, 128 hosts)							// 2 network</li>
<li><code>0b11000000</code> -&gt; 0 (cidr 26, 128 + 64)								// 4 network</li>
<li><code>0b11100000</code> -&gt; 0 (cidr 27, 128 + 64 + 32)						// 8 network</li>
<li><code>0b11110000</code> -&gt; 0 (cidr 28, 128 + 64 + 32 + 16)					// 16 network</li>
<li><code>0b11111000</code> -&gt; 0 (cidr 29, 128 + 64 + 32 + 16 + 8)				// 32 network</li>
<li><code>0b11111100</code> -&gt; 0 (cidr 30, 128 + 64 + 32 + 16 + 8 + 4)			// 64 network</li>
<li><code>0b11111110</code> -&gt; 0 (cidr 31, 128 + 64 + 32 + 16 + 8 + 4 + 2)		// 128 network</li>
<li><code>0b11111111</code> -&gt; 0 (cidr 32, 128 + 64 + 32 + 16 + 8 + 4 + 2 + 1)	// 256 network</li>
</ul>
<p>start dari /16</p>
<ul>
<li><code>0b0000000000000000</code> -&gt; 0 (cidr 16, 65535)								// 1 net, 65535 hosts</li>
<li><code>0b1000000000000000</code> -&gt; 0 (cidr 17, 65535 + )							// 2 net, 32767 hosts</li>
<li><code>0b1100000000000000</code> -&gt; 0 (cidr 26, 128 + 64)								// 4 net</li>
<li><code>0b1110000000000000</code> -&gt; 0 (cidr 27, 128 + 64 + 32)						// 8 net</li>
<li><code>0b1111000000000000</code> -&gt; 0 (cidr 28, 128 + 64 + 32 + 16)					// 16 net</li>
<li><code>0b1111100000000000</code> -&gt; 0 (cidr 29, 128 + 64 + 32 + 16 + 8)				// 32 net</li>
<li><code>0b1111110000000000</code> -&gt; 0 (cidr 30, 128 + 64 + 32 + 16 + 8 + 4)			// 64 net</li>
<li><code>0b1111111000000000</code> -&gt; 0 (cidr 31, 128 + 64 + 32 + 16 + 8 + 4 + 2)		// 128 net</li>
<li><code>0b1111111100000000</code> -&gt; 0 (cidr 32, 128 + 64 + 32 + 16 + 8 + 4 + 2 + 1)	// 256 net</li>
</ul>
<p>-- stagging (perhitungan ip cidr 16 keatas)
max int 16 bit: 65536</p>
<ul>
<li>/16 : 0b0000000000000000 = 0</li>
<li>/17 : 0b1000000000000000 = 32768, maka 65536 / 32768 = 2, alias 2 network, 32768 hosts</li>
<li>/18 : 0b1100000000000000 = 49152, maka 65536 / (65536 - 49152)  = 4 network, 16384 hosts,</li>
<li>/19 : 0b1110000000000000 = 57344, maka 65536 / (65536 - 57344)  = 8 network, 8192 hosts,</li>
<li>/20 : 0b1111000000000000 = 61440, maka 65536 / (65536 - 61440)  = 16 network, 4096 hosts,</li>
<li>/21 : 0b1111100000000000 = 61440, maka 65536 / (65536 - 61440)  = 32 network, 2048 hosts,</li>
<li>/22 : 0b1111110000000000 = 64512, maka 65536 / (65536 - 64512)  = 64 network, 1024 hosts,</li>
<li>/23 : 0b1111111000000000 = 64512, maka 65536 / (65536 - 64512)  = 128 network, 512 hosts,</li>
<li>/24 : 0b1111111100000000 = 64512, maka 65536 / (65536 - 64512)  = 256 network, 256 hosts,</li>
</ul>
<p>-- stagging cidr 8 keatas
max int int 24 bit: 16777216</p>
<ul>
<li>
<p>/9 : 0b100000000000000000000000 = 16777216 / (16777216 - 8388608) = 2 network, 8388608 hosts</p>
</li>
<li>
<p>/10: 0b110000000000000000000000 = 16777216 / (16777216 - 12582912)= 4 network, 4194304 hosts</p>
</li>
<li>
<p>/11: 0b111000000000000000000000 = 16777216 / (16777216 - 14680064)= 8 network, 2097152 hosts</p>
</li>
<li>
<p>/12: 0b111100000000000000000000 = 16777216 / (16777216 - 15728640)= 16 network, 1048576 hosts</p>
</li>
<li>
<p>/13: 0b111110000000000000000000 = 16777216 / (16777216 - 16252928)= 32 network, 524288 hosts</p>
</li>
<li>
<p>/14: 0b111111000000000000000000 = 16777216 / (16777216 - 16515072) = 64 network, 262144 hosts</p>
</li>
<li>
<p>/15: 0b111111100000000000000000 = 16777216 / (16777216 - 16646144) = 128 network, 131072 hosts</p>
</li>
<li>
<p>/16: 0b111111110000000000000000 = 16777216 / (16777216 - 16711680) = 256 network, 65536 hosts</p>
</li>
<li>
<p>/17: 0b111111111000000000000000 = 16777216 / (16777216 - 16744448) = 512 network, 32768 hosts</p>
</li>
<li>
<p>/18: 0b111111111100000000000000 = 16777216 / (16777216 - 16760832) = 1024 network, 16384 hosts</p>
</li>
<li>
<p>/19: 0b111111111110000000000000 = 16777216 / (16777216 - 16769024) = 2048 network, 8192 hosts</p>
</li>
<li>
<p>/20: 0b111111111111000000000000 = 16777216 / (16777216 - 16773120) = 4096 network, 4096 hosts</p>
</li>
<li>
<p>/21: 0b111111111111100000000000 = 16777216 / (16777216 - 16775168) = 8192 network, 2048 hosts</p>
</li>
<li>
<p>/9 : 0b100000000000000000000000:</p>
</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="set-path-fish-shell"><a class="header" href="#set-path-fish-shell">set PATH fish shell</a></h1>
<p>first, edit this</p>
<ul>
<li><code>nvim /home/$(whoami)/.config/fish/config.fish</code></li>
</ul>
<p>add this line before <code>if status is-interactive</code>
<code>set -gx PATH /new/path $PATH</code></p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="tree"><a class="header" href="#tree">Tree</a></h1>
<p>Apa itu tree? tree adalah struktur data, dimana bentuknya menyerupai tree (perumpamaan saja), aslinya structur data ini berbentuk mirip linkedlists-double hanya saja, perumpamaan cabang kiri (diganti dgn nama prev), cabang kanan (diganti dgn nama next)</p>
<h2 id="perbedaan"><a class="header" href="#perbedaan">Perbedaan</a></h2>
<ul>
<li>Linkedlists itu monoton, alias saling sambung menyambung dan flat.</li>
<li>sedangkan tree tidak ada aturan harus saling menyambung, bisa saja linkedlists nya seperti ini</li>
</ul>
<p><code>root -&gt; next -&gt; next -&gt; next</code> (dimana ini nanti akan membuat tree yang gambar visualnya bakal menjorok kekanan)</p>
<h2 id="jenis-jenis-transversal"><a class="header" href="#jenis-jenis-transversal">jenis jenis transversal</a></h2>
<ul>
<li>preorder (root, kiri, lalu ke-kanan)</li>
<li>inorder (kiri, root, lalu ke-kanan)</li>
<li>postorder (kiri, kanan, lalu ke-root)</li>
</ul>
<p>nb: tranversal adalah cara mengunjungi simpul (tepat satu kali saja)</p>
<h2 id="coding"><a class="header" href="#coding">coding</a></h2>
<p>sudah cukup hal non teknisnya, bagian ini akan membahas bagian koding</p>
<h2 id="struct"><a class="header" href="#struct">struct</a></h2>
<p>struct untuk tree sangat mirip dgn struct untuk linked-list-double. di kasus ini struct dibawah hanya bisa hold data char saja. bisa diganti juga dgn int. dan lain lain</p>
<pre><code class="language-c">struct ListNode {
        char val;
        ListNode *prev;
        ListNode *next;

        ListNode(char x) : val(x), prev(nullptr), next(nullptr) {}
};
</code></pre>
<p>terlihat? selain hold data <code>val</code> yang isinya char, kita ada opsi untuk hold pointer prev dan pointer next. dimana ini adalah kunci dari tree.</p>
<h2 id="contoh-meng-isinya"><a class="header" href="#contoh-meng-isinya">contoh meng-isinya</a></h2>
<p>ada tree seperti ini
<img src="other//assets/44cc7ec324a3454a5419ed656412246ae1548b060c631f05fac4829d3a41d4966443696f0942c5ec088680984a7e60565ebbd45e01d0298a1b7bc6b3.png" alt="image" /></p>
<p>ini contoh cara mengisinya</p>
<pre><code class="language-c">ListNode *head = new ListNode('A');
head-&gt;prev = new ListNode('B');
head-&gt;prev-&gt;prev = new ListNode('D');
head-&gt;prev-&gt;prev-&gt;next = new ListNode('G');

head-&gt;next = new ListNode('C');
head-&gt;next-&gt;next = new ListNode('F');
head-&gt;next-&gt;prev = new ListNode('E');
head-&gt;next-&gt;prev-&gt;prev = new ListNode('H');
head-&gt;next-&gt;prev-&gt;next = new ListNode('I');
</code></pre>
<p>kenapa tidak pakai val? karna ketika kita <code>new ListNode('H');</code>, secara otomatis kita mengisi val. val baru dipakai ketika mau diakses.</p>
<h2 id="contoh-cara-mengaksesnya"><a class="header" href="#contoh-cara-mengaksesnya">contoh cara mengaksesnya</a></h2>
<p>contoh singkat ada dibawah, contoh (komplit) nya silahkan <a href="https://drive.google.com/drive/folders/1lfvxDxCctEnp2Yg8H0ws7NgH1yMxDEZT?usp=sharing">klik disini</a></p>
<h3 id="inorder"><a class="header" href="#inorder">inorder</a></h3>
<pre><code class="language-c">cout &lt;&lt; "step 1: " &lt;&lt; head-&gt;prev-&gt;prev-&gt;next-&gt;val &lt;&lt;
" " &lt;&lt; head-&gt;prev-&gt;prev-&gt;val &lt;&lt;
" " &lt;&lt; head-&gt;prev-&gt;val &lt;&lt;
" " &lt;&lt; head-&gt;val &lt;&lt;
" " &lt;&lt; head-&gt;next-&gt;prev-&gt;prev-&gt;val &lt;&lt;
" " &lt;&lt; head-&gt;next-&gt;prev-&gt;val &lt;&lt;
 " " &lt;&lt; head-&gt;next-&gt;prev-&gt;next-&gt;val &lt;&lt;
 " " &lt;&lt; head-&gt;next-&gt;val &lt;&lt;
" " &lt;&lt; head-&gt;next-&gt;next-&gt;val &lt;&lt;
endl;
</code></pre>
<h3 id="postorder"><a class="header" href="#postorder">postorder</a></h3>
<pre><code class="language-c">cout &lt;&lt; "step 9: " &lt;&lt; head-&gt;prev-&gt;prev-&gt;next-&gt;val &lt;&lt; 
" " &lt;&lt; head-&gt;prev-&gt;prev-&gt;val &lt;&lt; 
" " &lt;&lt; head-&gt;prev-&gt;val &lt;&lt; 
" " &lt;&lt; head-&gt;next-&gt;prev-&gt;prev-&gt;val &lt;&lt; 
" " &lt;&lt; head-&gt;next-&gt;prev-&gt;next-&gt;val &lt;&lt; 
" " &lt;&lt; head-&gt;next-&gt;prev-&gt;val &lt;&lt; 
" " &lt;&lt; head-&gt;next-&gt;next-&gt;val &lt;&lt;
" " &lt;&lt; head-&gt;next-&gt;val &lt;&lt;
" " &lt;&lt; head-&gt;val &lt;&lt;

endl;
</code></pre>
<h3 id="preorder"><a class="header" href="#preorder">preorder</a></h3>
<pre><code class="language-c">cout &lt;&lt; "step 8: " &lt;&lt; head-&gt;val &lt;&lt; 
" " &lt;&lt; head-&gt;prev-&gt;val &lt;&lt; 
" " &lt;&lt; head-&gt;prev-&gt;prev-&gt;val &lt;&lt;
" " &lt;&lt; head-&gt;prev-&gt;prev-&gt;next-&gt;val &lt;&lt; 
" " &lt;&lt; head-&gt;next-&gt;val &lt;&lt; 
" " &lt;&lt; head-&gt;next-&gt;prev-&gt;val &lt;&lt;
" " &lt;&lt; head-&gt;next-&gt;prev-&gt;prev-&gt;val &lt;&lt;
" " &lt;&lt; head-&gt;next-&gt;prev-&gt;next-&gt;val &lt;&lt;
" " &lt;&lt; head-&gt;next-&gt;next-&gt;val &lt;&lt; endl;

</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="clang-format"><a class="header" href="#clang-format">clang-format</a></h1>
<p>here my clang format</p>
<pre><code>IndentWidth: 8
Cpp11BracedListStyle: false
</code></pre>
<p>filename: <code>.clang-format</code></p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="gallery"><a class="header" href="#gallery">Gallery</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="july-2025"><a class="header" href="#july-2025">july-2025</a></h1>
<h3 id="compiling-arm-gnu-abi"><a class="header" href="#compiling-arm-gnu-abi">compiling arm gnu abi</a></h3>
<p><img src="gallery//assets/15fd0bb09202c24cb3b940c8806134c187da160f89abf4cd8b3bbf4cca3ee74d20c17ca74aea0b44066d9a2d4ab90f58aea12e27324a1a61c72d8db0.png" alt="image" /></p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->


                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">

            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>

        <script src="ace.js"></script>
        <script src="editor.js"></script>
        <script src="mode-rust.js"></script>
        <script src="theme-dawn.js"></script>
        <script src="theme-tomorrow_night.js"></script>

        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->

        <script>
        window.addEventListener('load', function() {
            MathJax.Hub.Register.StartupHook('End', function() {
                window.setTimeout(window.print, 100);
            });
        });
        </script>

    </div>
    </body>
</html>
